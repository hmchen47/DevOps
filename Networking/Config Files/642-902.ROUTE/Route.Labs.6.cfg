
! #########################################################################
! Lab 6-1 Configuring BGP with Default Routing
!
! File: RTR.Lab.6-1.BGP.Default.Routing
!
! Procedures:
! 1. Prepare the routers  
! 2. Configuring the hostname and interface addresses
!   a. Assigning hostname and interface address
!   b. Verifying connectivity
! 3. Configuring BGP on the ISP routers
! 4. Configuring BGP on the ITA boundary router
!   a. Configuring the ITA riuter to run BGP with both Internet providers 
!   b. Verifying configuraion
! 5. Verifying BGP on the routers
!   a. Verifying BGP operation on ITA
!   b. Verifying the operation of ISP1
!   c. Shutdown the Loopback0 and verify on ISP1
!   d. Bring ISP1 back
!   e. Verifying BGP neighbor on ITA
! 6. Configuring route filters - block the BGP updates bwt ISPes
!   a. Checking routing table on ISP2
!   b. Configuring access list
!   c. Applying access list
!   d. Cheking routing table on ISP2
!   e. Reset ITA BGP table
! 7. Configuring primary adn backup routers using floating static routes
!   a. Verifying routing table on ITA
!   b. Configuring static routes to reflect the policy
!   c. Verifying default route
!   d. Configuring unadvertised loopback on ISP1
!   e. Verifying newly added network not shown
!   f. Verifying ISP1 loopback from ISP loopback
! 8. Configuring primary adn backup routes using a default network and
!     a static route
!   a. Removing floating static routes
!   b. Configuring on IPS1 to advertise 192.168.100.0/24 
!   c. Verifying routing table with 192.168.100.0/24
!   d. Reestablising a gateway of last resort on ITA
!   e. Verifying routing table on ITA
!   f. Making the ISP2 as backup 
!   g. Verifying the newly added route
!   h. Verifying connectivty on ITA
!
!
! 1. Prepare the routers  
! 2. Configuring the hostname and interface addresses
!   a. Assigning hostname and interface address
!   b. Verifying connectivity
!
! R1 - ISP1
hostname ISP1

int lo0
 desc IPS1 Internet Network
 ip add 10.1.1.1 255.255.255.0

int s0/0
 desc ISP1 -> ITA
 enc ppp
 ip add 10.0.0.1 255.255.255.252
 clock rate 128000
 no shut

! R2 - ITA
hostname ITA

int lo0
 desc Core router network link 1
 ip add 192.168.0.1 255.255.255.0

int lo1
 desc Core router network link 2
 ip add 192.168.1.1 255.255.255.0

int s0/0
 desc ITA -> ISP1
 enc ppp
 ip add 10.0.0.2 255.255.255.252
 no shut

int s0/1
 desc ITA -> ISP2
 enc ppp
 ip add 172.16.0.2 255.255.255.252
 clock rate 128000
 no shut

! R3 - ISP2
hostname ISP2

int lo0
 desc ISP2 Internet Network
 ip add 172.16.1.1 255.255.255.0

int s0/1
 desc IPS2 -> ITA
 enc ppp
 ip add 172.16.0.1 255.255.255.252
 no shut

! R2 - ITA
do pi 172.16.0.1

do pi 10.0.0.1
 

! 3. Configuring BGP on the ISP routers
!
! R1 - ISP1
router bgp 200
 nei 10.0.0.2 remote 100
 net 10.1.1.0 mask 255.255.255.0

! R3 - ISP2
router bgp 300
 nei 172.16.0.2 remote 100
 net 172.16.1.0 mask 255.255.255.0

! 4. Configuring BGP on the ITA boundary router
!   a. Configuring the ITA router to run BGP with both Internet providers 
!   b. Verifying configuration
!   c. verify connectivity
!
! a. R2 - ITA
router bgp 100
 nei 172.16.0.1 remote 300
 nei 10.0.0.1 remote 200
 net 192.168.0.0
 net 192.168.1.0

! b. R2 - ITA
do sh ip route

! c. R2 - ITA
end

tclsh 

foreach addr {
 10.0.0.1
 10.0.0.2
 10.1.1.1
 172.16.0.1
 172.16.0.2
 172.16.1.1
 192.168.0.1
 192.168.1.1
} {
 ping $addr
}

exit

conf t

! 5. Verifying BGP on the routers
!   a. Verifying BGP operation on ITA
!   b. Verifying the operation of ISP1
!   c. Shutdown the Loopback0 and verify on ISP1
!   d. Bring ISP1 back
!   e. Verifying BGP neighbor on ITA
!
! a.-b. R1, R3 --> table version, router ID & path
do sh ip bgp

! c. R2 - ISP1
int lo0
 shut

! d. R1 - ISP1
int lo0
 no shut

! e. R2 - ITA -> State with ISP2, up time interval
do sh ip bgp nei

! 6. Configuring route filters
!   a. Checking routing table on ISP2
!   b. Configuring access list
!   c. Applying access list
!   d. Cheking routing table on ISP2
!   e. Reset ITA BGP table
!
! a. R3 - ISP2 -> route to ISP1
do sh ip rou

! b. - c. R2 - ITA
access-list 1 per 192.168.0.0 0.0.1.255

router bgp 100
 nei 10.0.0.1 distribute-list 1 out
 nei 172.16.0.1 distribute-list 1 out

! d. R3 - ISP2 -> route 10.1.1.0 (ISP1)
do sh ip rou

! e. 
!
! R2 - ITA
do clear ip bgp *

! R1 & R3 - ISP2 & ISP3 
do sh ip rou

! 7. Configuring primary adn backup routers using floating static routes
!   a. Verifying routing table on ITA
!   b. Configuring static routes to reflect the policy
!   c. Verifying default route
!   d. Configuring unadvertised loopback on ISP1
!   e. Verifying newly added network not shown
!   f. Verifying ISP1 loopback from ISP loopback
!
! a, b, & c. R2 - ITA --> gateway
do sh ip rou

ip route 0.0.0.0 0.0.0.0 10.0.0.1 210
ip route 0.0.0.0 0.0.0.0 172.16.0.1 220

 do sh ip rou

! d. R1 - ISP1
int lo100
 ip add 192.168.100.1 255.255.255.0

! e, f.  R2 - ITA
do sh ip rou

do ping 192.168.100.1 so lo0

! 8. Configuring primary adn backup routes using a default network and
!     a static route
!   a. Removing floating static routes
!   b. Configuring on IPS1 to advertise 192.168.100.0/24 
!   c. Verifying routing table with 192.168.100.0/24
!   d. Reestablising a gateway of last resort on ITA
!   e. Verifying routing table on ITA
!   f. Making the ISP2 as backup 
!   g. Verifying the newly added route
!   h. Verifying connectivty on ITA
!
! a. R2 - ITA
no ip route 0.0.0.0 0.0.0.0 10.0.0.1 210
no ip route 0.0.0.0 0.0.0.0 172.16.0.1 220

! b. R1 - ISP1
router bgp 200
 net 192.168.100.0

! c-g. R2 - ITA -> gateway  & default route
do sh ip rou

ip default-network 192.168.100.0

do sh ip rou

ip route 0.0.0.0 0.0.0.0 172.16.0.1 220

do sh ip rou

do clear ip bgp 10.0.0.1
do sh ip rou

do sh ip rou

! h. R2 - ITA -> connectivity
end

tclsh 

foreach addr {
 10.0.0.1
 10.0.0.2
 10.1.1.1
 172.16.0.1
 172.16.0.2
 172.16.1.1
 192.168.0.1
 192.168.1.1
 192.168.100.1
} {
 ping $addr
}

exit


! #########################################################################
! Lab 6-2 Using the AS-Path Attribute
!
! File: RTR.Lab.6-2.BGP.Attribute.AS-Path
!
! Procedures:
! 1. Prepare the routers  
! 2. Configuring the hostname and interface addresses
!   a. Assigning hostname and interface address
!   b. Verifying connectivity
! 3. Configuring BGP 
!   a. Configuring BGP on all routers
!   b. Verifying BGP
! 4. Remove the private AS
!   a. Displaying touting tabel on SanJose 
!   b. Verifying connectivity to 10.3.3.1
!   c. Verifying connectivity to 10.3.3.1 from lo0
!   d. Verifying BGP
!   e. Stripping private AS from ISP
!   f. Reset entries and verifying connectivity
!   g. Verifying BGP on SanJose
! 5. Use the AS_PATH attribute to filter routes
!   a. Configuring access list for as-path
!   b. Applying filter-list
!   c. reset and verifying with routing table
!   d. Verifying routing tabel for CyustRtr
!   e. Verifying ISP filter
!   f. Verifying connectivity
!
!
! 1. Prepare the routers  
! 2. Configuring the hostname and interface addresses
!   a. Assigning hostname and interface address
!   b. Verifying connectivity
!
! R1
hostname SanJose

int lo0
 ip add 10.1.1.1 255.255.255.0

int s0/0
 enc ppp
 ip add 192.168.1.5 255.255.255.252
 clock rate 128000
 no shut

! R2 
hostname ISP

int lo0
 ip add 10.2.2.1 255.255.255.0

int s0/0
 enc ppp
 ip add 192.168.1.6 255.255.255.252
 no shut

int s0/1
 enc ppp
 ip add 172.24.1.17 255.255.255.252
 clock rate 128000
 no shut

! R3 
hostname CustRtr

int lo0
 ip add 10.3.3.1 255.255.255.0

int s0/1
 enc ppp
 ip add 172.24.1.18 255.255.255.252
 no shut

! b. R1 - R3
do pi x.x.x.x

! 3. Configuring BGP 
!   a. Configuring BGP on all routers
!   b. Verifying BGP
!
! R1 - SanJose
router bgp 100
 nei 192.168.1.6 remote 300
 net 10.1.1.0 mask 255.255.255.0

! R2 - ISP
router bgp 300
 nei 192.168.1.5 remote 100
 nei 172.24.1.18 remote 65000
 net 10.2.2.0 mask 255.255.255.0

! R3
router bgp 65000
 nei 172.24.1.17 remote 300
 net 10.3.3.0 mask 255.255.255.0

! R1-R3: Verify
do sh ip bgp nei

! 4. Remove the private AS - offcie should not see private ASN
!   a. Displaying touting tabel on SanJose 
!   b. Verifying connectivity to 10.3.3.1
!   c. Verifying connectivity to 10.3.3.1 from lo0
!   d. Verifying BGP
!   e. Stripping private AS from ISP
!   f. Reset entries and verifying connectivity
!   g. Verifying BGP on SanJose
!
! a-d. R1 - SanJose
do sh ip rou

do pi 10.3.3.1

do pi 10.3.3.1 so lo0

do sh ip bgp

! e. & f. R2 - ISP
router bgp 300
 nei 192.168.1.5 remove-private-as

do clear ip bgp * soft

! f. & g. R1 - SanJose
do pi 10.3.3.1 so lo0

do sh ip bgp

! 5. Use the AS_PATH attribute to filter routes
!   a. Configuring access list for as-path
!   b. Applying filter-list
!   c. reset and verifying with routing table
!   d. Verifying routing tabel for CyustRtr
!   e. Verifying ISP filter
!   f. Verifying connectivity
!
! a. - c. R2 - ISP
ip as-path access-list 1 deny ^100$
ip as-path access-list 1 permit .*

router bgp 300
 nei 172.24.1.18 filter-list 1 out

do clear ip bgp * soft

do sh ip rou

! d. R3 - CustRtr
do sh ip rou

! e. - f. R2 - ISP 
do sh ip bgp regexp ^100$

end

tclsh

foreach addr {
 10.1.1.1 
 10.2.2.1
 10.3.3.1
 192.168.1.5
 192.168.1.6
 172.24.1.17
 172.24.1.18
} {
 ping $addr
}

exit

!
! Running Configuration
!
! ISP
interface Loopback0
 ip address 10.2.2.1 255.255.255.0
!
interface Serial0/0
 ip address 192.168.1.6 255.255.255.252
 encapsulation ppp
 clock rate 2000000
!         
interface Serial0/1
 ip address 172.24.1.17 255.255.255.252
 encapsulation ppp
 clock rate 128000
!
router bgp 300
 no synchronization
 bgp log-neighbor-changes
 network 10.2.2.0 mask 255.255.255.0
 neighbor 172.24.1.18 remote-as 65000
 neighbor 172.24.1.18 filter-list 1 out
 neighbor 192.168.1.5 remote-as 100
 neighbor 192.168.1.5 remove-private-as
 no auto-summary
!
ip as-path access-list 1 deny ^100$
ip as-path access-list 1 permit .*

! SanJose
interface Loopback0
 ip address 10.1.1.1 255.255.255.0
!
interface Serial0/0
 ip address 192.168.1.5 255.255.255.252
 encapsulation ppp
 clock rate 128000
!
router bgp 100
 no synchronization
 bgp log-neighbor-changes
 network 10.1.1.0 mask 255.255.255.0
 neighbor 192.168.1.6 remote-as 300
 no auto-summary

! CustRtr
interface Loopback0
 ip address 10.3.3.1 255.255.255.0
!         
interface Serial0/1
 ip address 172.24.1.18 255.255.255.252
 encapsulation ppp
 clock rate 2000000
!
router bgp 65000
 no synchronization
 bgp log-neighbor-changes
 network 10.3.3.0 mask 255.255.255.0
 neighbor 172.24.1.17 remote-as 300
 no auto-summary

! #########################################################################
! Lab 6-3 Configuring IBGP & EBGP sessions, local preference
!                   and MED
!
! File: RTR.Lab.6-3.BGP.IBGP.EBGP
!
! Procedures:
! 1. Prepare the routers  
! 2. Configuring the hostname and interface addresses
!   a. Assigning hostname and interface address
!   b. Verifying connectivity
! 3. Configuring EIGRP 
! 4. Configuring IBGP and verifying BGP neighbors
!   a. Configuring IBGP on SanJose1 
!   b. Configuring IBGP on SanJose2
!   c. Verifying IBGP
! 5. Configuting EBGP and verifying BGP neighbors
!   a. Configuring EBGP on ISP with SanJose1 & SanJose2
!   b. Configuring EBGP on SanJose1
!   c. Verifying EBGP
!   d. Configuring EBGP on SanJose2
! 6. Viewing BGP sumamry output
! 7. Verifying which path the traffic takes
!   a. Resetting routes on ISP
!   b. Verifying connectivity ISP -> SanJose1
!   c. Verifying connectivity ISP -> SanJose2
!   d. Verifying BGP on ISP
!   e. Verifying connectivity on ISP with lo0
! 8. Configuring the BGP next-hop-self feature
!   a. Configuring on ISP to advertise routes
!   b. Verifying BGP on ISP
!   c. Verifying routing table on SanJose2
!   d. Displaying BGP on SanJose2
!   e. Configuring next-hop-self 
!   f. Resetting BGP enties
!   g. Verifying BGP on SanJose2
! 9. Setting BGP local preference
!   a. Configuring local preference 
!   b. Resettign BGP routes
!10. Set BGP MED
!   a. Recording connectivity 
!   b. Creating new policy
!   c. Restting BGP entries
!   d. Recoring connectivity and verifying BGP
! 11. Establishing a default network
!   a. Displaying routes
!   b. Configuring the default network
!   c. Verifying routes
!   d. Verifying connectivity   
!
!
! 1. Prepare the routers  
! 2. Configuring the hostname and interface addresses
!   a. Assigning hostname and interface address
!   b. Verifying connectivity
!
! R1
hostname ISP

int lo0
 ip add 192.168.100.1 255.255.255.0

int s0/0
 enc ppp
 ip add 192.168.1.5 255.255.255.252
 clock rate 128000
 no shut

int s0/1
 enc ppp
 ip add 192.168.1.1 255.255.255.252
 no shut

! R2 
hostname SanJose1

int lo0
 ip add 172.16.64.1 255.255.255.0

int s0/0
 enc ppp
 ip add 192.168.1.6 255.255.255.252
 no shut

int s0/1
 enc ppp
 ip add 172.16.1.1 255.255.255.252
 clock rate 128000
 no shut

! R3 
hostname SanJose2

int lo0
 ip add 172.16.32.1 255.255.255.0

int s0/0
 enc ppp
 ip add 192.168.1.2 255.255.255.252
 no shut

int s0/1
 enc ppp
 ip add 172.16.1.2 255.255.255.252
 no shut

! b. R1 - R3
do pi x.x.x.x

! 3. Configuring EIGRP 
!
! R2 - SanJose1
router eig 64512
 no au
 net 172.16.0.0

! R3 - SanJose2
router eig 64512
 no au
 net 172.16.0.0

! 4. Configuring IBGP and verifying BGP neighbors
!   a. Configuring IBGP on SanJose1 
!   b. Configuring IBGP on SanJose2
!   c. Verifying IBGP
!
! a. R2 - SanJose1
router bgp 64512
 nei 172.16.32.1 remote 64512
 nei 172.16.32.1 updat lo0

! b.- c. R3 - SanJose2
router bgp 64512
 nei 172.16.64.1 remote 64512
 nei 172.16.64.1 updat lo0

do sh ip bgp nei

! 5. Configuting EBGP and verifying BGP neighbors
!   a. Configuring EBGP on ISP with SanJose1 & SanJose2
!   b. Configuring EBGP on SanJose1
!   c. Verifying EBGP
!   d. Configuring EBGP on SanJose2
!
! a. R1 - ISP
router bgp 200
 nei 192.168.1.6 remote 64512
 nei 192.168.1.2 remote 64512
 net 192.168.100.0 mask 255.255.255.0

! b - c R2 - SanJose1
!  the static route with null0 is used for loop prevention
ip route 172.16.0.0 255.255.0.0 null0

router bgp 64512
 nei 192.168.1.5 remote 200
 net 172.16.0.0

do sh ip bgp nei

! d. R3 - SanJose2
ip route 172.16.0.0 255.255.0.0 null0

router bgp 64512
 nei 192.168.1.1 remote 200
 net 172.16.0.0 

! 6. Viewing BGP sumamry output
!
! R3 - SanJose2
do sh ip bgp sum

! 7. Verifying which path the traffic takes
!   a. Resetting routes on ISP
!   b. Verifying connectivity ISP -> SanJose1
!   c. Verifying connectivity ISP -> SanJose2
!   d. Verifying BGP on ISP
!   e. Verifying connectivity on ISP with lo0
!
! a. R2 & R3 - SanJose1 & SanJose2
do clear ip bgp *

! b-c. R1 - ISP
do pi 172.16.64.1

do pi 172.16.1.1

do pi 172.16.32.1

do pi 172.16.1.2

! d - e R1 - ISP
do sh ip bgp

do pi 172.16.1.1 so lo0
do pi 192.168.100.1 so lo0
do pi 172.16.1.1 so lo0
do pi 172.16.64.1 so lo0

! 8. Configuring the BGP next-hop-self feature
!   a. Configuring on ISP to advertise routes
!   b. Verifying BGP on ISP
!   c. Verifying routing table on SanJose2
!   d. Displaying BGP on SanJose2
!   e. Configuring next-hop-self 
!   f. Resetting BGP enties
!   g. Verifying BGP on SanJose2
!
! a - b. R1 - ISP
router bgp 200
 net 192.168.1.0 mask 255.255.255.252
 net 192.168.1.4 mask 255.255.255.252

do sh ip bgp

! c - d. R2 - SanJose1
do sh ip rou

do sh ip bgp

! e.  R2 - SanJose1
router bgp 64512
 nei 172.16.32.1 next-hop-self

! e.  R3 - SanJose2
router bgp 64512
 nei 172.16.64.1 next-hop-self

! f. R2 & R3
do clear ip bgp * soft

! g. R3 - SanJose2
do sh ip bgp

! 9. Setting BGP local preference
!   a. Configuring local preference 
!   b. Resettign BGP routes
!
! a. R2 - SanJose1
route-map PRIMARY_T1_IN per 10
 set local-preference 150

router bgp 64512
 nei 192.168.1.5 route-map PRIMARY_T1_IN in

! a. R3 - SanJose2
route-map SECONDARY_T1_IN per 10
 set local-preference 125

router bgp 64512
 nei 192.168.1.1 route-map SECONDARY_T1_IN in

! b. R2 & R3 - SanJose1 & SanJose2
do clear ip bgp * soft

do sh ip bgp

!10. Set BGP MED
!   a. Recording connectivity 
!   b. Creating new policy
!   c. Restting BGP entries
!   d. Recoring connectivity and verifying BGP
!
! a. R3 - SanJose2
ping
target: 192.168.100.1
extended: y
source: 172.16.32.1
record

! b. R2 - SanJose1
route-map PRIMARY_T1_MED_OUT per 10
 set metric 50

router bgp 64512
 nei 192.168.1.5 route-map PRIMARY_T1_MED_OUT out

! b. R3 - SanJose2
route-map SECONDARY_T1_MED_OUT per 10
 set metric 75

router bgp 64512
 nei 192.168.1.1 route-map SECONDARY_T1_MED_OUT out

! c. R2 & R3
do clear ip bgp * soft

do sh ip bgp

! d. R3 - SanJose2
ping
target: 192.168.100.1
extended: y
source: 172.16.32.1
record

! d. ISP
do sh ip bgp

! 11. Establishing a default network
!   a. Displaying routes on SanJose1
!   b. Configuring the default network
!   c. Verifying routes
!   d. Verifying connectivity   
!
! a - c. R2 - SanJose1
do sh ip rou

ip default-netwpork 192.168.100.0

do sh ip rou

! d. R1 - ISP
end

tclsh

foreach addr {
 192.168.100.1 
 172.16.64.1
 172.16.32.1
 192.168.1.1
 192.168.1.2
 192.168.1.5
 172.16.1.1
 172.16.1.2
} {
 ping $addr
}

!
! Running Configuration
!
! ISP
interface Loopback0
 ip address 192.168.100.1 255.255.255.0
!
interface Serial0/0
 ip address 192.168.1.5 255.255.255.252
 encapsulation ppp
 clock rate 128000
!         
interface Serial0/1
 ip address 192.168.1.1 255.255.255.252
 encapsulation ppp
 clock rate 2000000
!
router bgp 200
 no synchronization
 bgp log-neighbor-changes
 network 192.168.1.0 mask 255.255.255.252
 network 192.168.1.4 mask 255.255.255.252
 network 192.168.100.0
 neighbor 192.168.1.2 remote-as 64512
 neighbor 192.168.1.6 remote-as 64512
 no auto-summary

! SanJose1
interface Loopback0
 ip address 172.16.64.1 255.255.255.0
!
interface Serial0/0
 ip address 192.168.1.6 255.255.255.252
 encapsulation ppp
 clock rate 2000000
!         
interface Serial0/1
 ip address 172.16.1.1 255.255.255.252
 encapsulation ppp
 clock rate 128000
!
router eigrp 64512
 network 172.16.0.0
 no auto-summary
!
router bgp 64512
 no synchronization
 bgp log-neighbor-changes
 network 172.16.0.0
 neighbor 172.16.32.1 remote-as 64512
 neighbor 172.16.32.1 update-source Loopback0
 neighbor 172.16.32.1 next-hop-self
 neighbor 192.168.1.5 remote-as 200
 neighbor 192.168.1.5 route-map PRIMARY_T1_IN in
 neighbor 192.168.1.5 route-map PRIMARY_T1_MED_OUT out
 no auto-summary
!
ip default-network 192.168.100.0
ip forward-protocol nd
ip route 172.16.0.0 255.255.0.0 Null0
!
route-map PRIMARY_T1_IN permit 10
 set local-preference 150
!
route-map PRIMARY_T1_MED_OUT permit 10
 set metric 50


! SanJose2
interface Loopback0
 ip address 172.16.32.1 255.255.255.0
!
interface Serial0/0
 ip address 192.168.1.2 255.255.255.252
 encapsulation ppp
 clock rate 2000000
!
router eigrp 64512
 network 172.16.0.0
 no auto-summary
!
router bgp 64512
 no synchronization
 bgp log-neighbor-changes
 network 172.16.0.0
 neighbor 172.16.64.1 remote-as 64512
 neighbor 172.16.64.1 update-source Loopback0
 neighbor 172.16.64.1 next-hop-self
 neighbor 192.168.1.1 remote-as 200
 neighbor 192.168.1.1 route-map SECONDARY_T1_IN in
 neighbor 192.168.1.1 route-map SECONDARY_T1_MED_OUT out
 no auto-summary
!
ip forward-protocol nd
ip route 172.16.0.0 255.255.0.0 Null0
!
route-map SECONDARY_T1_IN permit 10
 set local-preference 125
!
route-map SECONDARY_T1_MED_OUT permit 10
 set metric 75


! #########################################################################
! Lab 6-4 BGP Route Reflectors and Route Filters
!
! File: RTR.Lab.6-4.BGP.RR.Filter
!
! Procedures:
! 1. Prepare the routers  
! 2. Configuring the hostname and interface addresses
!   a. Assigning hostname and interface address
!   b. Verifying connectivity
! 3. Configuring RIPv2
!   a. Configuring RIPv2 on all routers
!   b. Verifying routing table on R1
!   c. Verifying connectivity with tclsh 
! 4. Configuring IBGP peers and route relefctor
!   a. Configuring IBGP peers on SanJose2 
!   b. Configuring IBGP peers on SanJose1 
!   c. Configuring IBGP peers on SanJose3 
!   d. Verifying IBGP
! 5. Injecting a network into BGP
!   a. Configuring Lo0 and advertise intp BGP on SanJose3 &
!      Verifying on SanJose2
!   b. Configuring connectivity from SanJose2
!   c. Verifying routing table on Sanjose1
!   d. Configuring SanJose2 as RR
!   e. Verifying IBGP cluster on SanJose2
!   f. Verifying IBGP cluster on SanJose1
!   g. Verifying route reflection on SanJose1
!   h. Verifying connectivity on SanJose1
! 6. Injecting a summary address into BGP
!   a. Configuring SanJose3 to inject a summary address
!   b. Verifying the specific route on SanJose2
!   c. Verifying the specific route on SanJose1
!   d. Configuring route filter to prevent from sending 
!      192.133.219.0/24 to other client
!   e. Reseeting bgp entries and verifying bgp table
!   f. Verifying connectivity
!
!
! 1. Prepare the routers  
! 2. Configuring the hostname and interface addresses
!   a. Assigning hostname and interface address
!   b. Verifying connectivity
!
! R1 - SanJose1
hostname SanJose1

int s0/0
 enc ppp
 ip add 192.168.1.5 255.255.255.252
 clock rate 128000
 no shut

! R2 - SanJose2
hostname SanJose2

int lo0
 ip add 10.2.2.1 255.255.255.0
 
int s0/0
 enc ppp
 ip add 192.168.1.6 255.255.255.252
 no shut

int s0/1
 enc ppp
 ip add 172.24.1.17 255.255.255.0
 clock rate 128000
 no shut

! R3 - SanJose3
hostname SanJose3

int s0/1
 enc ppp
 ip add 172.24.1.18 255.255.255.0
 no shut

! 3. Configuring RIPv2
!   a. Configuring RIPv2 on all routers
!   b. Verifying routing table on R1
!   c. Verifying connectivity with tclsh 
! 
! R1 - SanJose1
router rip
 ver 2
 no au
 net 192.168.1.0

! R2 - SanJose2
router rip
 ver 2
 no au
 net 10.0.0.0
 net 172.24.0.0
 net 198.168.1.0 

! R3
router rip
 ver 2
 no au
 net 172.24.0.0

! b - c. R1 - SanJose1
do sh ip rou

end

tclsh

foreach addr {
 10.2.2.1
 192.168.1.5
 192.168.1.6
 172.24.1.17
 172.24.1.18
} {
 ping $addr
}

exit

conf t

! 4. Configuring IBGP peers and route relefctor
!   a. Configuring IBGP peers on SanJose2 
!   b. Configuring IBGP peers on SanJose1 
!   c. Configuring IBGP peers on SanJose3 
!   d. Verifying IBGP
!
! a. R2 - SanJose2
router bgp 100
 nei 192.168.1.5 remote 100
 nei 172.24.1.18 remote 100
 
! b. R1 - SanJose1
router bgp 100
 nei 192.168.1.6 remote 100

! c. R3 - SanJose3
router bgp 100
 nei 172.24.1.17 remote 100

! d. R2 - SanJose2
do sh ip bgp nei

! 5. Injecting a network into BGP
!   a. Configuring Lo0 and advertise intp BGP on SanJose3 &
!      Verifying on SanJose2
!   b. Configuring connectivity from SanJose2
!   c. Verifying routing table on Sanjose1
!   d. Configuring SanJose2 as RR
!   e. Verifying IBGP cluster on SanJose2
!   f. Verifying IBGP cluster on SanJose1
!   g. Verifying route reflection on SanJose1
!   h. Verifying connectivity on SanJose1
!
! a. R3 - SanJose3
int lo0
 ip add 198.133.219.1 255.255.255.0

router bgp 100
 net 198.133.219.0

! a. R2 - SanJose2
do sh ip rou

! b. R2 - SanJose2
do pi 192.133.219.1

! c. R1 - SanJose -> No route to 198.133.219.0
do sh ip rou

! d-e. R2 - SanJose2
router bgp 100
 nei 192.168.1.5 route-reflector-client
 nei 172.24.1.18 route-reflector-client

do sh ip pro

! f. R1 - SanJose1
do sh ip pro

! g-h. R1 - SanJose1
do sh ip rou

do pi 192.132.219.1 

! 6. Injecting a summary address into BGP
!   a. Configuring SanJose3 to inject a summary address
!   b. Verifying the specific route on SanJose2
!   c. Verifying the specific route on SanJose1
!   d. Configuring route filter to prevent from sending 
!      192.133.219.0/24 to other client
!   e. Reseeting bgp entries and verifying bgp table
!   f. Verifying connectivity!
!
! a. R3 - SanJose3
router bgp 100
 aggregate-address 198.0.0.0 255.0.0.0

! b. R2 - SanJose2
do sh ip bgp 198.0.0.0

! c. R1 - SanJose1
do sh ip rou

! d. R2 - SanJose2
ip prefix-list SUPERNETONLY per 198.0.0.0/8
router bgp 100
 nei 192.168.1.5 prefix-list SUPERNETONLY out

! e. R1 - SanJose1
do clear ip bgp * soft

do sh ip rou

! f. R1~R3 - SanJose1 ~ SanJose3
end

tclsh

foreach addr {
 10.2.2.1
 192.168.1.5
 192.168.1.6
 172.24.1.17
 172.24.1.18
} {
 ping $addr
}

exit

! 
! Running Configuration
!
! SanJose1
interface Serial0/0
 ip address 192.168.1.5 255.255.255.252
 encapsulation ppp
 clock rate 128000
!
router rip
 version 2
 network 192.168.1.0
 no auto-summary
!
router bgp 100
 no synchronization
 bgp log-neighbor-changes
 neighbor 192.168.1.6 remote-as 100
 no auto-summary

! SanJose2
interface Loopback0
 ip address 10.2.2.1 255.255.255.0
!
interface Serial0/0
 ip address 192.168.1.6 255.255.255.252
 encapsulation ppp
 clock rate 2000000
!         
interface Serial0/1
 ip address 172.24.1.17 255.255.255.0
 encapsulation ppp
 clock rate 128000
!
router rip
 version 2
 network 10.0.0.0
 network 172.24.0.0
 network 192.168.1.0
 no auto-summary
!
router bgp 100
 no synchronization
 bgp log-neighbor-changes
 neighbor 172.24.1.18 remote-as 100
 neighbor 172.24.1.18 route-reflector-client
 neighbor 192.168.1.5 remote-as 100
 neighbor 192.168.1.5 route-reflector-client
 neighbor 192.168.1.5 prefix-list SUPERNETONLY out
 no auto-summary

! SanJose3
interface Loopback0
 ip address 198.133.219.1 255.255.255.0
!
interface Serial0/1
 ip address 172.24.1.18 255.255.255.0
 encapsulation ppp
 clock rate 2000000
!
router rip
 version 2
 network 172.24.0.0
 no auto-summary
!
router bgp 100
 no synchronization
 bgp log-neighbor-changes
 network 198.133.219.0
 aggregate-address 198.0.0.0 255.0.0.0
 neighbor 172.24.1.17 remote-as 100
 no auto-summary



! #########################################################################
! Lab 6-5 BGP Case Study
!
! File: RTR.Lab.6-5.BGP.Case.Study
!
! Requirements:
!  1. Configuring the interfaces  
!  2. Configuring ITA with EIGRP AS 65001
!  3. Configuring TDP with EIGRP AS 65002
!  4. No autosummarization on EIGRP routers
!  5. Configurng BGP on ITA & DTP
!  6. Advertising 192.168.14.0/30 and 192.168.34.0/30 of EIGRP
!     on ITA & DPT
!  7. Configuring interfaces on border routers btw two EIGRP ASes 
!     w/o EIGRP packets through
!  8. Full-mesh configuration on both BGP ASes
!  9. Peering R1 & R2 with loopback
! 10. Advertisign all loopback interfaces into BGP, except for R2,
!     where lo2 is used
! 11. Creating static summary route on R2 for the rest of its loopback
!     interfaces and advertise this static route in BGP
! 12. R4 sending a summary route into ITA
! 13. R4 using the path to ITA via Ethernet btw R1 & R4 with MED
!     modification
! 14. Choosing link btw R1 & R4 for ITA AS to TDP with configuring 
!     local preference
!
! Step 1 - Basic Interface configuration
!
! R1
int lo1
 ip add 10.1.1.1 255.255.255.0

int s0/0
 enc ppp
 ip add 10.1.102.1 255.255.255.248
 no shut

int s0/1
 enc ppp
 ip add 10.1.103.1 255.255.255.248
 no shut

int f0/0
 ip add 192.168.14.1 255.255.255.252
 no shut

! R2
int lo2
 ip add 10.2.2.2 255.255.255.0

int lo200
 ip add 10.20.0.1 255.255.255.0

int lo201 
 ip add 10.20.1.1 255.255.255.0

int lo202 
 ip add 10.20.2.1 255.255.255.0

int lo203
 ip add 10.20.3.1 255.255.255.0

int s0/0
 enc ppp
 ip add 10.1.102.2 255.255.255.248
 no shut

int s0/1
 enc ppp
 ip add 10.1.203.2 255.255.255.248
 no shut

! R3
int lo03
 ip add 10.3.3.3 255.255.255.0

int s0/0
 enc ppp
 ip add 10.1.103.3 255.255.255.248
 no shut

int s0/1
 enc ppp
 ip add 10.1.203.3 255.255.255.248
 no shut

int s0/2
 enc ppp
 ip add 192.168.34.1 255.255.255.252
 no shut

! R4
int lo0
 ip add 172.16.0.1 255.255.252.0

int lo4
 ip add 172.16.4.1 255.255.252.0

int lo8
 ip add 172.16.8.1 255.255.252.0

int lo12
 ip add 172.16.12.1 255.255.252.0

int f0/0
 ip add 192.168.14.2 255.255.255.252
 no shut

int s0/0
 enc ppp
 ip add 192.168.34.2 255.255.255.252
 no shut

! Verify the connectivity of directly connected links


! Step 2 - EIGRP configuration
!
! R1
router eig 65001
 no au
 net 10.1.1.0 0.0.0.255
 net 10.1.102.0 0.0.0.7
 net 10.1.103.0 0.0.0.7
 net 192.168.14.0 0.0.0.3
 passive-interface f0/0

! R2
router eig 65001
 no au 
 net 10.2.2.0 0.0.0.255
 net 10.1.102.0 0.0.0.7
 net 10.1.203.0 0.0.0.7

! R3
router eig 65001
 no au
 net 10.3.3.0 0.0.0.255
 net 10.1.203.0 0.0.0.7
 net 10.1.103.0 0.0.0.7
 net 192.168.34.0 0.0.0.3
 passive-interface s0/2

! R4
router eig 65002
 no au
 net 192.168.34.0 0.0.0.3
 net 192.168.14.0 0.0.0.3
 net 192.168.14.0 0.0.0.3
 net 192.168.34.0 0.0.0.3
 passive-interface f0/0
 passive-interface s0/0

! Verify

! Step 3 - Configuring BGP
!
! R1
router bgp 65001
 nei 10.2.2.2 remote 65001
 nei 10.2.2.2 update lo1
 nei 10.1.103.3 remote 65001
 nei 10.1.103.3 next-hop-self
 nei 192.168.14.2 remote 65002
 net 10.1.1.0 mask 255.255.255.0

! R2
router bgp 65001
 nei 10.1.1.1 remote 65001
 nei 10.1.1.1 update lo2
 nei 10.1.203.3 remote 65001
 nei 10.1.203.3 next-hop-self
 net 10.2.2.0 mask 255.255.255.0

! R3
router bgp 65001
 nei 10.1.103.1 remote 65001
 nei 10.1.103.1 next-hop-self
 nei 10.1.203.2 remote 65001
 nei 10.1.203.2 next-hop-self
 nei 192.168.34.2 remote 65002
 net 10.3.3.0 mask 255.255.255.0 

! R4
router bgp 65002
 nei 192.168.14.1 remote 65001
 nei 192.168.34.1 remote 65001
 net 172.16.0.0 mask 255.255.252.0
 net 172.16.4.0 mask 255.255.252.0
 net 172.16.8.0 mask 255.255.252.0
 net 172.16.12.0 mask 255.255.252.0

! Step 4 - Summarization networks on R2 & R4
!
! R2
router bgp 65001
 net 10.20.0.0 mask 255.255.252.0

ip route 10.20.0.0 255.255.252.0 null0

! R4
router bgp 65001
 aggregate-address 172.16.0.0 255.255.240 summary-only 

! Step 5 - Configuring R1 & R3 to control the traffic flow
!          via R1-R4 link with MED and local preference
! R1
route-map ITA_MED_OUT per 10
 set metric 50

route-map ITA_LOACLPREF_IN per 10
 set local-preference 400

router bgp 65001
 nei 192.168.14.2 route-map ITA_MED_OUT out
 nei 192.168.14.2 route-map ITA_LOCALPREF_IN in

! R4
route-map ITA_MED_OUT per 10
 set metric 100

route-map ITA_LOACLPREF_IN per 10
 set local-preference 100

router bgp 65001
 nei 192.168.14.2 route-map ITA_MED_OUT out
 nei 192.168.14.2 route-map ITA_LOCALPREF_IN in


! Connectivity Verifyication
end

tclsh

foreach addr {
 10.1.1.1
 10.2.2.2
 10.20.0.1
 10.20.1.1
 10.20.2.1
 10.20.3.1
 10.3.3.3
 172.16.0.1
 172.16.4.1
 172.16.8.1
 172.16.12.1
 10.1.102.1
 10.1.102.2
 10.1.103.1
 10.1.103.3
 10.1.203.2
 10.1.203.3
 192.168.14.1
 192.168.14.2
 192.168.34.1
 192.168.34.2
} {
 ping $addr source lo4
}

exit

! Running Configuration
!
! R1
interface Loopback1
 ip address 10.1.1.1 255.255.255.0
!
interface Serial0/0
 ip address 10.1.102.1 255.255.255.248
 encapsulation ppp
 clock rate 2000000
!
interface Serial0/1
 ip address 10.1.103.1 255.255.255.248
 encapsulation ppp
 clock rate 2000000
!
router eigrp 65001
 passive-interface FastEthernet0/0
 network 10.1.1.0 0.0.0.255
 network 10.1.102.0 0.0.0.7
 network 10.1.103.0 0.0.0.7
 network 192.168.14.0 0.0.0.3
 no auto-summary
!
router bgp 65001
 no synchronization
 bgp log-neighbor-changes
 network 10.1.1.0 mask 255.255.255.0
 neighbor 10.1.103.3 remote-as 65001
 neighbor 10.1.103.3 next-hop-self
 neighbor 10.2.2.2 remote-as 65001
 neighbor 10.2.2.2 update-source Loopback1
 neighbor 192.168.14.2 remote-as 65002
 neighbor 192.168.14.2 route-map ITA_LOCALPREF_IN in
 neighbor 192.168.14.2 route-map ITA_MED_OUT out
 no auto-summary
!
ip forward-protocol nd
!
route-map ITA_LOACLPREF_IN permit 10
 set local-preference 400
!
route-map ITA_MED_OUT permit 10
 set metric 50

! R2
interface Loopback2
 ip address 10.2.2.2 255.255.255.0
!
interface Loopback200
 ip address 10.20.0.1 255.255.255.0
!
interface Loopback201
 ip address 10.20.1.1 255.255.255.0
!
interface Loopback202
 ip address 10.20.2.1 255.255.255.0
!
interface Loopback203
 ip address 10.20.3.1 255.255.255.0
!
interface Serial0/0
 ip address 10.1.102.2 255.255.255.248
 encapsulation ppp
 clock rate 2000000
!
interface Serial0/1
 ip address 10.1.203.2 255.255.255.248
 encapsulation ppp
 clock rate 2000000
!
router eigrp 65001
 network 10.1.102.0 0.0.0.7
 network 10.1.203.0 0.0.0.7
 network 10.2.2.0 0.0.0.255
 no auto-summary
!         
router bgp 65001
 no synchronization
 bgp log-neighbor-changes
 network 10.2.2.0 mask 255.255.255.0
 network 10.20.0.0 mask 255.255.252.0
 neighbor 10.1.1.1 remote-as 65001
 neighbor 10.1.1.1 update-source Loopback2
 neighbor 10.1.203.3 remote-as 65001
 neighbor 10.1.203.3 next-hop-self
 no auto-summary
!
ip forward-protocol nd
ip route 10.20.0.0 255.255.252.0 Null0
!
ip prefix-list R2_SUPPERNET seq 5 permit 10.20.0.0/23
ip prefix-list R2_SUPPERNET seq 10 permit 10.20.0.0/22

! R3
interface Loopback3
 ip address 10.3.3.3 255.255.255.0
!
interface Serial0/0
 ip address 10.1.103.3 255.255.255.248
 encapsulation ppp
 clock rate 2000000
!         
interface Serial0/1
 ip address 10.1.203.3 255.255.255.248
 encapsulation ppp
 clock rate 2000000
!
interface Serial0/2
 ip address 192.168.34.1 255.255.255.252
 encapsulation ppp
 clock rate 2000000
!
router eigrp 65001
 passive-interface Serial0/2
 network 10.1.103.0 0.0.0.7
 network 10.1.203.0 0.0.0.7
 network 10.3.3.0 0.0.0.255
 network 192.168.34.0 0.0.0.3
 no auto-summary
!
router bgp 65001
 no synchronization
 bgp log-neighbor-changes
 network 10.3.3.0 mask 255.255.255.0
 neighbor 10.1.103.1 remote-as 65001
 neighbor 10.1.103.1 next-hop-self
 neighbor 10.1.203.2 remote-as 65001
 neighbor 10.1.203.2 next-hop-self
 neighbor 192.168.34.2 remote-as 65002
 no auto-summary
!
route-map ITA_LOACLPREF_IN permit 10
 set local-preference 100
!
route-map ITA_MED_OUT permit 10
 set metric 100

! R4
interface Loopback0
 ip address 172.16.0.1 255.255.252.0
!
interface Loopback4
 ip address 172.16.4.1 255.255.252.0
!
interface Loopback8
 ip address 172.16.8.1 255.255.252.0
!
interface Loopback12
 ip address 172.16.12.1 255.255.252.0
!
interface FastEthernet0/0
 ip address 192.168.14.2 255.255.255.252
 duplex auto
 speed auto
!
interface Serial0/0
 ip address 192.168.34.2 255.255.255.252
 encapsulation ppp
 clock rate 2000000
!
router eigrp 65002
 passive-interface FastEthernet0/0
 passive-interface Serial0/0
 network 192.168.14.0 0.0.0.3
 network 192.168.34.0 0.0.0.3
 no auto-summary
!
router bgp 65002
 no synchronization
 bgp log-neighbor-changes
 network 172.16.0.0 mask 255.255.252.0
 network 172.16.4.0 mask 255.255.252.0
 network 172.16.8.0 mask 255.255.252.0
 network 172.16.12.0 mask 255.255.252.0
 aggregate-address 172.16.0.0 255.255.240.0 summary-only
 neighbor 192.168.14.1 remote-as 65001
 neighbor 192.168.34.1 remote-as 65001
 no auto-summary

! Solution from Instruction Book
!
! R1
hostname R1
!
interface Loopback1
 ip address 10.1.1.1 255.255.255.0
!
interface FastEthernet0/0
 ip address 192.168.14.1 255.255.255.252
 no shutdown
!
interface Serial0/0/0
 ip address 10.1.102.1 255.255.255.248
 clock rate 64000
 bandwidth 64
 no shutdown
!
interface Serial0/0/1
 ip address 10.1.103.1 255.255.255.248
 bandwidth 64
 no shutdown
!
router eigrp 65001
 network 10.0.0.0
 network 192.168.14.0
 passive-interface FastEthernet0/0
 no auto-summary
!
router bgp 65001
 no synchronization
 network 10.1.1.0 mask 255.255.255.0
 neighbor 10.1.103.3 remote-as 65001
 neighbor 10.2.2.2 remote-as 65001
 neighbor 10.2.2.2 update-source Loopback1
 neighbor 192.168.14.2 remote-as 65002
 neighbor 192.168.14.2 route-map IN-FROM-TDP in
 neighbor 192.168.14.2 route-map OUT-TO-TDP out
 no auto-summary
!
route-map OUT-TO-TDP permit 10
 set metric 10
!
route-map IN-FROM-TDP permit 10
 set local-preference 200
end

! R2
interface Loopback2
 ip address 10.2.2.2 255.255.255.0
!
interface Loopback200
 ip address 10.20.0.1 255.255.255.0
!
interface Loopback201
 ip address 10.20.1.1 255.255.255.0
!
interface Loopback202
 ip address 10.20.2.1 255.255.255.0
!
interface Loopback203
 ip address 10.20.3.1 255.255.255.0
!
interface Serial0/0/0
 ip address 10.1.102.2 255.255.255.248
 bandwidth 64
 no shutdown
!
interface Serial0/0/1
 ip address 10.1.203.2 255.255.255.248
 clock rate 64000
 bandwidth 64
 no shutdown
!
router eigrp 65001
 network 10.0.0.0
 no auto-summary
!
router bgp 65001
 no synchronization
 network 10.2.2.0 mask 255.255.255.0
 network 10.20.0.0 mask 255.255.252.0
 neighbor 10.1.1.1 remote-as 65001
 neighbor 10.1.1.1 update-source Loopback2
 neighbor 10.1.203.3 remote-as 65001
 no auto-summary
!
ip route 10.20.0.0 255.255.252.0 Null0
end

! R3
hostname R3
!
interface Loopback3
 ip address 10.3.3.3 255.255.255.0
!
interface Serial0/0/0
 ip address 10.1.103.3 255.255.255.248
 clock rate 64000
 bandwidth 64
 no shutdown
!
interface Serial0/0/1
 ip address 10.1.203.3 255.255.255.248
 bandwidth 64
 no shutdown
!
interface Serial0/1/0
 ip address 192.168.34.1 255.255.255.252
 clock rate 64000
 bandwidth 64
 no shutdown
!
router eigrp 65001
 network 10.0.0.0
 network 192.168.34.0
 passive-interface Serial0/1/0
 no auto-summary
!
router bgp 65001
 no synchronization
 network 10.3.3.0 mask 255.255.255.0
 neighbor 10.1.103.1 remote-as 65001
 neighbor 10.1.203.2 remote-as 65001
 neighbor 192.168.34.2 remote-as 65002
 neighbor 192.168.34.2 route-map IN-FROM-TDP in
 neighbor 192.168.34.2 route-map OUT-TO-TDP out
 no auto-summary
!
route-map OUT-TO-TDP permit 10
 set metric 20
 route-map IN-FROM-TDP permit 10
 set local-preference 100
end

! R4
hostname R4
!
interface Loopback0
 ip address 172.16.0.1 255.255.252.0
!
interface Loopback4
 ip address 172.16.4.1 255.255.252.0
!
interface Loopback8
 ip address 172.16.8.1 255.255.252.0
!
interface Loopback12
 ip address 172.16.12.1 255.255.252.0
!
interface FastEthernet0/0
 ip address 192.168.14.2 255.255.255.252
 no shutdown
!
interface Serial0/0/0
 ip address 192.168.34.2 255.255.255.252
 bandwidth 64
 no shutdown
!
router eigrp 65002
 network 172.16.0.0
 network 192.168.14.0
 network 192.168.34.0
 passive-interface FastEthernet0/0
 passive-interface Serial0/0/0
 no auto-summary
!
router bgp 65002
 no synchronization
 network 172.16.0.0 mask 255.255.252.0
 network 172.16.4.0 mask 255.255.252.0 
 network 172.16.8.0 mask 255.255.252.0 
 network 172.16.12.0 mask 255.255.252.0
 aggregate-address 172.16.0.0 255.255.240.0 summary-only
 neighbor 192.168.14.1 remote-as 65001
 neighbor 192.168.34.1 remote-as 65001
 no auto-summary
end

!############### EXAMPLES ############################################

!#####################################################################
! Chapter 6 Example BGP network with IBGP & EBGP neighbor 
!             relationships
!
! File: RTR.Ch6-ex.BGP.w.IBGP&EBGP.neighbor-01
!
! Procedures:
!  1. Basic configuration for interfaces and EIGRP
!  2. Configuring Router A for BGP
!  3. Configuring Router B for BGP
!  4. Configuring Router C for BGP
!  5. Verifying BGP neighbors
!
!
! 1. Basic configuration for interfaces and EIGRP
!
! A
int f0/0
 ip add 10.1.1.2 255.255.255.0
 no shut

int f0/1
 ip add 192.168.1.2 255.255.255.0
 no shut

router  eigrp 100
 no au
 net 10.1.1.0 0.0.0.255
 net 192.168.1.0 0.0.0.255

! B
int f0/0
 ip add 10.2.2.2 255.255.255.0
 no shut

router  eigrp 100
 no au
 net 10.2.2.0 0.0.0.255

! C
int f0/0
 ip add 192.168.1.0 255.255.255.0
 no shut

! D
int f0/0
 ip add 10.1.1.1 255.255.255.0
 no shut

int f0/1
 ip add 10.2.2.1 255.255.255.0
 no shut

router  eigrp 100
 no au
 net 10.1.1.0 0.0.0.255
 net 10.2.2.0 0.0.0.255

! 2. Configuring Router A for BGP
!
! A
router bgp 65101
 neighbor 10.2.2.2 remote-as 65101
 neighbor 192.168.1.1 remote-as 65102

! 3. Configuring Router B for BGP
!
! B
router bgp 65101
 nei 10.1.1.2 remote 65101

! 4. Configuring Router C for BGP
!
router bgp 65102
 nei 192.168.1.2 remote 65101

! 5. Verifying BGP neighbors
!
! A, B, & C
do sh ip bgp

do sh ip bgp summary

!#####################################################################
! Chapter 6 Example BGP Loopback Address
!
! File: RTR.Ch6-ex.BGP.Loopback.Addr-01
!
! Procedures:
!  1. Basic configuration for interfaces and EIGRP
!  2. Configuring Router R1 for BGP
!  3. Configuring Router R2 for BGP
!  4. Configuring Router R3 for BGP
!  5. Configuring Router R4 fro BGP
!  6. Verifying BGP neighbors
!
!
! 1. Basic configuration for interfaces and EIGRP
!
! R1
int f0/1
 ip add 172.16.1.1 255.255.255.0
 no shut

! R2
int lo0
 ip add 192.168.2.2 255.255.255.0
 no shut

int f0/0
 ip add 172.16.1.2 255.255.255.0
 no shut

int f1/0
 no switch
 ip add 10.1.1.1 255.255.255.0
 no shut

int f1/1
 no switch
 ip add 10.2.2.1 255.255.255.0
 no shut

int ran f1/2 - 15
 shut

router eig 100
 no au
 net 10.1.1.0 0.0.0.255
 net 10.2.2.0 0.0.0.255
 net 192.168.2.0 0.0.0.255

! R3
int lo0
 ip add 192.168.3.3 255.255.255.0
 no shut

int f0/0
 ip add 192.168.1.2 255.255.255.0
 no shut

int f1/0
 no switch
 ip add 10.1.1.2 255.255.255.0
 no shut

int f1/1
 no switch
 ip add 10.2.2.2 255.255.255.0
 no shut

int ran f1/2 - 15
 shut

router eig 100
 no au
 net 10.1.1.0 0.0.0.255
 net 10.2.2.0 0.0.0.255
 net 192.168.3.0 0.0.0.255

! R4
int f0/0
 ip add 192.168.1.1 255.255.255.0
 no shut

! 2. Configuring Router R1 for BGP
!
router bgp 65100
 nei 172.16.1.2 remote 65101

! 3. Configuring Router R2 for BGP
!
router bgp 65101
 nei 172.16.1.1 remote 65100
 nei 192.168.3.3 remote 65101
 nei 192.168.3.3 update-source lo0

! 4. Configuring Router R3 for BGP
!
router bgp 65101
 nei 192.168.1.1 remote 65102
 nei 192.168.2.2 remote 65101
 nei 192.168.2.2 update-source lo0

! 5. Configuring Router R4 fro BGP
!
router bgp 65102
 nei 192.168.1.2 remote 65101

! 6. Verifying BGP neighbors
!
! R2/R3
do sh ip bgp nei
do sh ip bgp sum

int f1/0
 shut

do sh ip bgp nei
do sh ip bgp sum

no shut
int lo0
 shut

do sh ip bgp nei
do sh ip bgp sum

no shut

!#####################################################################
! Chapter 6 Example EBGP Multihop
!
! File: RTR.Ch6-ex.EBGP.Multihop-01
!
! Procedures:
!  1. Basic configuration for interfaces and static routes
!  2. Configuring Router R1 for BGP
!  3. Configuring Router R2 for BGP
!  4. Verifying BGP neighbors
!
!
! 1. Basic configuration for interfaces and static routes
!
! A
int lo0
 ip add 192.168.2.2 255.255.255.0

int f0/0
 ip add 192.168.1.17 255.255.255.240
 no shut

int f0/1
 ip add 192.168.1.33 255.255.255.240
 no shut

! B
int lo0
 ip add 192.168.3.3 255.255.255.0
 
int e0/0
 ip add 192.168.1.18 255.255.255.240
 no shut

int e0/1
 ip add 192.168.1.34 255.255.255.240
 no shut

! 2. Configuring Router R1 for BGP
!
router bgp 65102
 nei 192.168.3.3 remote 65101
 nei 192.168.3.3 update lo0
 nei 192.168.3.3 ebgp-multihop 2

ip route 192.168.3.3 255.255.255.255 192.168.1.18
ip route 192.168.3.3 255.255.255.255 192.168.1.34

! 3. Configuring Router R2 for BGP
!
router bgp 65101
 nei 192.168.2.2 remote 65102
 nei 192.168.2.2 update lo0
 nei 192.168.2.2 ebgp-multihop 2

ip route 192.168.2.2 255.255.255.255 192.168.1.17
ip route 192.168.2.2 255.255.255.255 192.168.1.33

! 4. Verifying BGP neighbors
!
do sh ip bgp nei

! when shut down one of the interface, the traffic cannot pass through


!#####################################################################
! Chapter 6 Example Changing BGP Nexthop Attribute
!
! File: RTR.Ch6-ex.BGP.Nexthop.Attr-01
!
! Procedures:
!  1. Basic configuration for interfaces and EIGRP
!  2. Configuring Router R1 for BGP
!  3. Configuring Router R2 for BGP and Nexthop
!  4. Configuring Router R3 for BGP and nexthop
!  5. Configuring Router R4 for BGP
!  6. Verifying BGP neighbors
!
!
! 1. Basic configuration for interfaces and EIGRP
!
! R1
int lo0 
 ip add 192.168.15.1 255.255.255.0

! Otehr configuration same as the Example Loopback Addr

! 2. Configuring Router R1 for BGP
!
router bgp 65100
 nei 172.16.1.2 remote 65101
 net 192.168.15.0 mask 255.255.255.0

! 3. Configuring Router R2 for BGP and Nexthop
!
router bgp 65101
 nei 172.16.1.1 remote 65100
 nei 192.168.3.3 remote 65101
 nei 192.168.3.3 update lo0
 nei 192.168.3.3 next-hop-self
 net 192.168.2.0 mask 255.255.255.0

! 4. Configuring Router R3 for BGP and nexthop
!
router bgp 56101
 nei 192.168.1.1 remote 65102
 nei 192.168.2.2 remote 65101
 nei 192.168.2.2 update lo0
 nei 192.168.2.2 next-hops-self
 net 192.168.3.0 mask 255.255.255.0

! 5. Configuring Router R4 for BGP
!
router bgp 65102
 nei 192.168.1.2 remote 65101

! 6. Verifying BGP neighbors
!
do sh ip bgp

do sh ip rou


!#####################################################################
! Chapter 6 Example BGP Neighbor Authentication
!
! File: RTR.Ch6-ex.BGP.Neighbor.Authen-01
!
! Procedures:
!  1. Basic configuration for interfaces
!  2. Configuring Router R1 for BGP
!  3. Configuring Router R2 for BGP and Nexthop
!  4. Verifying BGP neighbors
!
! 1. Basic configuration for interfaces
!
! R1
int lo0
 ip add 172.16.1.1 255.255.255.0

int f0/0
 ip add 10.64.0.1 255.255.255.0
 no shut
 
!R2
int lo0
 ip add 172.16.2.1 255.255.255.0

int f0/0
 ip add 10.64.0.2 255.255.255.0
 no shut

! 2. Configuring Router R1 for BGP
!
do deb ip bgp

router eigrp 65000
 nei 10.64.0.2 remote 65500
 nei 10.64.0.2 password cisco123
 net 172.16.1.0 mask 255.255.255.0

! 3. Configuring Router R2 for BGP and Nexthop
!
do deb ip bgp
router eigrp 65000
 nei 10.64.0.1 remote 65500
 nei 10.64.0.1 password cisco123
 net 172.16.2.0 mask 255.255.255.0

! 4. Verifying BGP neighbors
!
dp sh ip bgp


!#####################################################################
! Chapter 6 Example Basic BGP Configuration
!
! File: RTR.Ch6-ex.BGP.Basic-01
!
! Procedures:
!  1. Basic configuration for interfaces
!  2. Configuring Router R1 for BGP
!  3. Configuring Router R2 for BGP
!  4. Verifying BGP neighbors
!
! 1. Basic configuration for interfaces
!
! R1
int f0/0
 ip add 10.1.1.1 255.255.255.252

! R2
int f0/0
 ip add 10.1.1.2 255.255.255.252

! 2. Configuring Router R1 for BGP
!
router bgp 64520
 nei 10.1.1.2 remote 65000

! 3. Configuring Router R2 for BGP
!
router bgp 65000
 nei 10.1.1.1 remote 64520
 nei 10.1.1.0 mask 255.255.255.0

! 4. Verifying BGP neighbors
!
do sh ip bgp 
do sh ip bgp sum


!#####################################################################
! Chapter 6 Example Basic BGP Configuration
!
! File: RTR.Ch6-ex.BGP.Basic-02
!
! Procedures:
!  1. Basic configuration for interfaces
!  2. Configuring Router R1 for BGP
!  3. Configuring Router R2 for BGP
!  4. Configuring Router R3 for BGP
!  5. Verifying BGP neighbors
!
!  1. Basic configuration for interfaces
!
! R1
int s0/0
 enc ppp
 ip add 10.2.2.1 255.255.255.0
 no shut

! R2
int lo0 
 ip add 10.4.4.4 255.255.255.0

int s0/0
 enc ppp
 ip add 10.2.2.2 255.255.255.0
 clock rate 2000000
 no shut

int s0/1
 enc ppp
 ip add 10.1.1.1 255.255.255.0
 clock rate 2000000
 no shut

! R3
int lo0
 ip add 10.5.5.5 255.255.255.0

int s0/0
 enc ppp
 ip add 10.1.1.2 255.255.255.0
 no shut

!  2. Configuring Router R1 for BGP
!
router bgp 65010
 nei 10.2.2.2 remote 65010

!  3. Configuring Router R2 for BGP
!
router bgp 65010
 nei 10.2.2.1 remote 65010
 nei 10.1.1.2 remote 65020
 net 10.4.4.0 mask 255.255.255.0
 net 10.2.2.0 mask 255.255.255.0

!  4. Configuring Router R3 for BGP
!
router bgp 65020
 nei 10.1.1.1 remote 65010
 net 10.5.5.0 mask 255.255.255.0

!  5. Verifying BGP neighbors
!
do sh ip bgp
do sh ip bgp sum
do sh ip bgp nei


!#####################################################################
! Chapter 6 Example Peer Group
!
! File: RTR.Ch6-ex.BGP.Peer.Group-01
!
! Procedures:
!  1. Basic configuration for interfaces
!  2. Configuring BGP on R3, R4 & R6 w/o peer group
!  3. Configuring BGP on R1, R2 & R3 w/ peer group
!  4. Verifying BGP neighbors
!
!  1. Basic configuration for interfaces
!
! R1
int lo 0
 ip add 192.168.1.1 255.255.255.0
 ip ospf 1 area 0

int s0/0
 enc ppp
 ip add 172.15.15.1 255.255.255.0
 no shut

int f0/0
 ip add 172.16.13.1 255.255.255.0
 ip ospf 1 area 0
 no shut

! R2
int lo0
 ip add 192.168.2.1 255.255.255.0
 ip ospf 1 area 0

int s0/0
 enc ppp
 ip add 172.15.25.2 255.255.255.0
 no shut

int f0/0
 ip add 172.16.23.2 255.255.255.0
 ip ospf 1 area 0
 no shut

! R3
int lo0
 ip add 192.168.3.1 255.255.255.0
 ip ospf 1 area 0

int f0/0
 ip add 172.16.23.3 255.255.255.0
 ip ospf 1 area 0
 no shut

int f0/1
 ip add 172.16.13.3 255.255.255.0
 ip ospf 1 area 0
 no shut

int f1/0
 ip add 172.16.34.3 255.255.255.0
 ip ospf 1 area 0
 no shut

! R4
int lo0 
 ip add 192.168.4.1 255.255.255.0
 ip ospf 1 area 0

int f0/0
 ip add 172.16.34.4 255.255.255.0
 ip ospf 1 area 0
 no shut

int s0/0
 enc ppp
 ip add 172.15.46.4 255.255.255.0
 no shut

! R5
int lo0
 ip add 192.168.5.1 255.255.255.0

int s0/0
 enc ppp
 ip add 172.15.15.5 255.255.255.0
 no shut

int s0/1
 enc ppp
 ip add 172.15.25.5 255.255.255.0
 no shut

! R6
int lo0
 ip add 192.168.6.1 255.255.255.0

int s0/0
 enc ppp
 ip add 172.15.46.6 255.255.255.0
 no shut

!  2. Configuring BGP on R3, R4 & R6 w peer group
!
! R3
router bgp 65100
 nei 192.168.1.1 remote 65100
 nei 192.168.1.1 update lo0
 nei 192.168.1.1 next-hop-self

 nei 192.168.2.1 remote 65100
 nei 192.168.2.1 update lo0
 nei 192.168.2.1 next-hop-self

 nei 192.168.4.1 remote 65100
 nei 192.168.4.1 update lo0
 nei 192.168.4.1 next-hop-self

 net 192.168.3.0 mask 255.255.255.0

! R4
router bgp 65100
 nei 192.168.1.1 remote 65100
 nei 192.168.1.1 update lo0
 nei 192.168.1.1 next-hop-self
 nei 192.168.1.1 distribute-list NO_PRIVATE out

 nei 192.168.2.1 remote 65100
 nei 192.168.2.1 update lo0
 nei 192.168.2.1 next-hop-self
 nei 192.168.2.1 distribute-list NO_PRIVATE out

 nei 192.168.3.1 remote 65100
 nei 192.168.3.1 update lo0
 nei 192.168.3.1 next-hop-self
 nei 192.168.2.1 distribute-list NO_PRIVATE out

 nei 192.168.6.1 remote 65102
 nei 192.168.6.1 update lo0
 nei 192.168.6.1 ebgp-multihop 2
 nei 192.168.2.1 distribute-list NO_PRIVATE out

 net 192.168.4.0 mask 255.255.255.0

ip access ext NO_PRIVATE
 10 deny ip 10.0.0.0 0.255.255.255 any
 20 deny ip  172.16.0.0 0.31.255.255 any
 30 deny ip 192.168.0.0 0.0.255.255 any
 40 per ip any any

ip route 192.168.6.1 255.255.255.255 17.15.46.6

! R6
router bgp 65102
 nei 192.168.4.1 remote 65100
 nei 192.168.4.1 update lo0
 nei 192.168.4.1 ebgp 2

 net 192.168.6.0 mask 255.255.255.0

ip route 192.168.4.1 255.255.255.255 17.15.46.4


!  3. Configuring BGP on R1, R2 & R5 w/ peer group
!
! R1
router bgp 65100
 nei INTERNAL peer-group
 nei INTERNAL remote 65100
 nei INTERNAL update lo0
 nei INETRNAL next-hop-self
 nei INTERNAL distribute-list NO_PRIVATE out
 
 nei 192.168.4.1 peer-group INTERNAL
 nei 192.168.2.1 peer-group INTERNAL
 nei 192.168.3.1 peer-greoup INTERNAL

 nei 192.168.5.1 remote 65101
 nei 192.168.5.1 update lo0
 nei 192.168.5.1 ebgp 2

 net 192.168.1.0 mask 255.255.255.0

ip access ext NO_PRIVATE
 10 deny ip 10.0.0.0 0.255.255.255 any
 20 deny ip 172.16.0.0 0.31.255.255 any
 30 deny ip 192.168.0.0 0.0.255.255 any
 40 per ip any any

ip route 192.168.5.1 255.255.255.255 17.15.15.5

! R2
router bgp 65100
 nei INTERNAL peer-group
 nei INTERNAL remote 65100
 nei INTERNAL update lo0
 nei INETRNAL next-hop-self
 
 nei 192.168.1.1 peer-group INTERNAL
 nei 192.168.3.1 peer-group INTERNAL
 nei 192.168.4.1 peer-greoup INTERNAL

 nei 192.168.5.1 remote 65101
 nei 192.168.5.1 update lo0
 nei 192.168.5.1 ebgp 2

 net 192.168.2.0 mask 255.255.255.0

ip route 192.168.5.1 255.255.255.255 17.15.25.2

! R5
router bgp 65101
 nei AS65100_EDGE1 remote 65100
 nei AS65100_EDGE1 update lo0
 nei AS65100_EDGE1 ebgp 2

 nei 192.168.1.1 peer-group AS65000_EDGE1
 nei 192.168.2.1 peer-group AS65000_EDGE1

ip route 192.168.2.1 255.255.255.255 17.15.15.1
ip route 192.168.3.1 255.255.255.255 17.15.25.2


!  4. Verifying BGP neighbors
!

! 
! Running Configuration
!
! R1
interface Loopback0
 ip address 192.168.1.1 255.255.255.0
 ip ospf 1 area 0
!
interface FastEthernet0/0
 ip address 172.16.13.1 255.255.255.0
 ip ospf 1 area 0
 duplex auto
 speed auto
!
interface Serial0/0
 ip address 172.15.15.1 255.255.255.0
 encapsulation ppp
 clock rate 2000000
!
router bgp 65100
 no synchronization
 bgp log-neighbor-changes
 network 192.168.1.0
 neighbor INTERNAL peer-group
 neighbor INTERNAL remote-as 65100
 neighbor INTERNAL update-source Loopback0
 neighbor INTERNAL next-hop-self
 neighbor INTERNAL distribute-list NO_PRIVATE out
 neighbor 192.168.2.1 peer-group INTERNAL
 neighbor 192.168.3.1 peer-group INTERNAL
 neighbor 192.168.4.1 peer-group INTERNAL
 neighbor 192.168.5.1 remote-as 65101
 neighbor 192.168.5.1 ebgp-multihop 2
 neighbor 192.168.5.1 update-source Loopback0
 no auto-summary
!
ip forward-protocol nd
ip route 192.168.5.1 255.255.255.255 172.15.15.5
!
ip access-list extended NO_PRIVATE
 deny   ip 10.0.0.0 0.255.255.255 any
 deny   ip 172.0.0.0 0.31.255.255 any
 deny   ip 192.168.0.0 0.0.255.255 any
 permit ip any any

! R2
interface Loopback0
 ip address 192.168.2.1 255.255.255.0
 ip ospf 1 area 0
!
interface FastEthernet0/0
 ip address 172.16.23.2 255.255.255.0
 ip ospf 1 area 0
 duplex auto
 speed auto
!
interface Serial0/0
 ip address 172.15.25.2 255.255.255.0
 encapsulation ppp
 clock rate 2000000
!
router bgp 65100
 no synchronization
 bgp log-neighbor-changes
 network 192.168.2.0
 neighbor INTERNAL peer-group
 neighbor INTERNAL remote-as 65100
 neighbor INTERNAL update-source Loopback0
 neighbor INTERNAL next-hop-self
 neighbor INTERNAL distribute-list NO_PRIVATE out
 neighbor 192.168.1.1 peer-group INTERNAL
 neighbor 192.168.3.1 peer-group INTERNAL
 neighbor 192.168.4.1 peer-group INTERNAL
 neighbor 192.168.5.1 remote-as 65101
 neighbor 192.168.5.1 ebgp-multihop 2
 neighbor 192.168.5.1 update-source Loopback0
 no auto-summary
!
ip forward-protocol nd
ip route 192.168.5.1 255.255.255.255 172.15.25.5
!
ip access-list extended NO_PRIVATE
 deny   ip 10.0.0.0 0.255.255.255 any
 deny   ip 172.0.0.0 0.31.255.255 any
 deny   ip 192.168.0.0 0.0.255.255 any
 permit ip any any

! R3
interface Loopback0
 ip address 192.168.3.1 255.255.255.0
 ip ospf 1 area 0
!
interface FastEthernet0/0
 ip address 172.16.23.3 255.255.255.0
 ip ospf 1 area 0
 duplex auto
 speed auto
!
interface FastEthernet0/1
 ip address 172.16.13.3 255.255.255.0
 ip ospf 1 area 0
 duplex auto
 speed auto
!
interface FastEthernet1/0
 ip address 172.16.34.3 255.255.255.0
 ip ospf 1 area 0
 speed auto
 full-duplex
!
router bgp 65100
 no synchronization
 bgp log-neighbor-changes
 network 192.168.3.0
 neighbor 192.168.1.1 remote-as 65100
 neighbor 192.168.1.1 update-source Loopback0
 neighbor 192.168.1.1 next-hop-self
 neighbor 192.168.2.1 remote-as 65100
 neighbor 192.168.2.1 update-source Loopback0
 neighbor 192.168.2.1 next-hop-self
 neighbor 192.168.4.1 remote-as 65100
 neighbor 192.168.4.1 update-source Loopback0
 neighbor 192.168.4.1 next-hop-self
 no auto-summary

! R4
interface Loopback0
 ip address 192.168.4.1 255.255.255.0
 ip ospf 1 area 0
!
interface FastEthernet0/0
 ip address 172.16.34.4 255.255.255.0
 ip ospf 1 area 0
 speed auto
 half-duplex
!
interface Serial0/0
 ip address 172.15.46.4 255.255.255.0
 encapsulation ppp
 clock rate 2000000
!
interface FastEthernet0/1
 no ip address
 shutdown
 duplex auto
 speed auto
!
router ospf 1
 log-adjacency-changes
!
router bgp 65100
 no synchronization
 bgp log-neighbor-changes
 network 192.168.4.0
 neighbor 192.168.1.1 remote-as 65100
 neighbor 192.168.1.1 update-source Loopback0
 neighbor 192.168.1.1 next-hop-self
 neighbor 192.168.1.1 distribute-list NO_PRIVATE out
 neighbor 192.168.2.1 remote-as 65100
 neighbor 192.168.2.1 update-source Loopback0
 neighbor 192.168.2.1 next-hop-self
 neighbor 192.168.2.1 distribute-list NO_PRIVATE out
 neighbor 192.168.3.1 remote-as 65100
 neighbor 192.168.3.1 update-source Loopback0
 neighbor 192.168.3.1 next-hop-self
 neighbor 192.168.3.1 distribute-list NO_PRIVATE out
 neighbor 192.168.6.1 remote-as 65102
 neighbor 192.168.6.1 ebgp-multihop 2
 neighbor 192.168.6.1 update-source Loopback0
 no auto-summary
!
ip forward-protocol nd
ip route 192.168.6.1 255.255.255.255 172.15.46.6
!
ip access-list extended NO_PRIVATE
 deny   ip 10.0.0.0 0.255.255.255 any
 deny   ip 172.0.0.0 0.31.255.255 any
 deny   ip 192.168.0.0 0.0.255.255 any
 permit ip any any

! R5
interface Loopback0
 ip address 192.168.5.1 255.255.255.0
!
interface Serial0/0
 ip address 172.15.15.5 255.255.255.0
 encapsulation ppp
 clock rate 2000000
!         
interface Serial0/1
 ip address 172.15.25.5 255.255.255.0
 encapsulation ppp
 clock rate 2000000
!
router bgp 65101
 no synchronization
 bgp log-neighbor-changes
 network 192.168.5.0
 neighbor AS65100_EDGE1 peer-group
 neighbor AS65100_EDGE1 remote-as 65100
 neighbor AS65100_EDGE1 ebgp-multihop 2
 neighbor AS65100_EDGE1 update-source Loopback0
 neighbor 192.168.1.1 peer-group AS65100_EDGE1
 neighbor 192.168.2.1 peer-group AS65100_EDGE1
 no auto-summary
!
ip forward-protocol nd
ip route 192.168.1.1 255.255.255.255 172.15.15.1
ip route 192.168.2.1 255.255.255.255 172.15.25.2

! R6
interface Loopback0
 ip address 192.168.6.1 255.255.255.0
!
interface Serial0/0
 ip address 172.15.46.6 255.255.255.0
 encapsulation ppp
 clock rate 2000000
!         
router bgp 65102
 no synchronization
 bgp log-neighbor-changes
 network 192.168.6.0
 neighbor 192.168.4.1 remote-as 65100
 neighbor 192.168.4.1 ebgp-multihop 2
 neighbor 192.168.4.1 update-source Loopback0
 no auto-summary
!
ip forward-protocol nd
ip route 192.168.4.1 255.255.255.255 172.15.46.4


!#####################################################################
! Chapter 6 Example IBGP and EBGP
!
! File: RTR.Ch6-ex.BGP.IBGP.EBGP-01
!
! Procedures:
!  1. Basic configuration for interfaces
!  2. Configuring BGP on R1
!  3. Configuring BGP on R2
!  3. Configuring BGP on R3
!  4. Verifying BGP neighbors
!
!  1. Basic configuration for interfaces
!
! R1
int lo1
 ip add 172.16.10.1 255.255.255.0

int s0/0
 enc ppp
 ip add 10.1.1.1 255.255.255.0
 no shut

! R2
int lo0
 ip add 192.168.2.2 255.255.255.255

int lo1
 ip add 172.16.20.1 255.255.255.0

int s0/0
 enc ppp
 ip add 10.1.1.2 255.255.255.0
 no shut

int f0/0
 ip add 192.168.1.2 255.255.255.0
 no shut

int f0/1
 ip add 192.168.4.2 255.255.255.0
 no shut

! R3
int lo0
 ip add 192.168.3.3 255.255.255.255

int lo1
 ip add 172.16.30.1 255.255.255.0

int f0/0
 ip add 192.168.1.3 255.255.255.0
 no shut

int f0/1
 ip add 192.168.4.3 255.255.255.0
 no shut

!  2. Configuring BGP on R1
!
router bgp 64520
 nei 10.1.1.2 remote 65000
 net 172.13.10.0 mask 255.255.255.0

!  3. Configuring BGP on R2
!
router bgp 65000
 nei 192.168.3.3 remote 65000
 nei 192.168.3.3 update lo0
 nei 192.168.3.3 next-hop-self
 
 nei 10.1.1.1 remote 64520
 
 net 172.16.20.0 mask 255.255.255.0
 net 192.168.1.0 mask 255.255.255.0
 net 192.168.4.0 mask 255.255.255.0

!  3. Configuring BGP on R3
!
router bgp 65000
 nei 192.168.2.2 remote 65000
 nei 192.168.2.2 update lo0
 nei 192.168.2.2 next-hop-self
 
 net 172.16.30.0 mask 255.255.255.0
 net 192.168.1.0 mask 255.255.255.0
 net 192.168.4.0 mask 255.255.255.0

!  4. Verifying BGP neighbors
!


!#####################################################################
! Chapter 6 Example BGP with CPE & PE Connections
!
! File: RTR.Ch6-ex.BGP.CPE.PE-01
!
! Procedures:
!  1. Basic configuration for interfaces
!  2. Configuring BGP on R1
!  3. Configuring BGP on R2
!  3. Configuring BGP on R3
!  4. Verifying BGP neighbors
!

! Incomplete Might come back later to complete

!#####################################################################
! Chapter 6 Example Modifying BGP Weight Attribute
!
! File: RTR.Ch6-ex.BGP.Attr.Weight-01
!
! Procedures:
!  1. Basic configuration for interfaces
!  2. Configuring BGP on R2-4 
!  3. Configuring BGP on R1 to alert traffic for R3 via R2
!  4. Verifying BGP neighbors
!
! 1. Basic configuration for interfaces
!
! R1
int lo0
 ip add 192.168.1.1 255.255.255.0

int s0/0
 enc ppp
 ip add 172.16.12.1 255.255.255.248
 no shut

int s0/1
 enc ppp
 ip add 172.16.14.1 255.255.255.248
 no shut

! R2
int lo0
 ip add 192.168.2.1 255.255.255.248

int s0/0
 enc ppp
 ip add 172.16.12.2 255.255.255.248
 no shut

int s0/1
 enc ppp
 ip add 172.16.23.2 255.255.255.248
 no shut

! R3
int lo0
 ip add 192.168.3.1 255.255.255.0

int s0/0
 enc ppp
 ip add 172.16.23.3 255.255.255.248
 no shut

int s0/1
 enc ppp
 ip add 172.16.34.3 255.255.255.248
 no shut

! R4
int lo0
 ip add 192.168.4.1 255.255.255.0

int s0/0
 enc ppp
 ip add 172.16.34.4 255.255.255.248
 no shut

int s0/1
 enc ppp
 ip add 172.16.14.4 255.255.255.248
 no shut

! 2. Configuring BGP on R2-4 
!
! R2
router bgp 65030
 nei 192.168.1.1 remote 65040
 nei 192.168.1.1 update lo0
 nei 192.168.1.1 ebgp 2
 nei 192.168.3.1 remote 65020
 nei 192.168.3.1 update lo0
 nei 192.168.3.1 ebgp 2

 net 192.168.2.0 mask 255.255.255.0

ip route 192.168.1.1 255.255.255.255 172.16.12.1
ip route 192.168.3.1 255.255.255.255 172.16.23.3

! R3
router bgp 65020
 nei 192.168.2.1 remote 65030
 nei 192.168.2.1 update lo0
 nei 192.168.2.1 ebgp 2
 nei 192.168.4.1 remote 65010
 nei 192.168.4.1 update lo0
 nei 192.168.4.1 ebgp 2

 net 192.168.3.0 mask 255.255.255.0

ip route 192.168.2.1 255.255.255.255 172.16.23.2
ip route 192.168.4.1 255.255.255.255 172.16.34.4

! R4
router bgp 65010
 nei 192.168.3.1 remote 65020
 nei 192.168.3.1 update lo0
 nei 192.168.3.1 ebgp 2
 nei 192.168.1.1 remote 65040
 nei 192.168.1.1 update lo0
 nei 192.168.1.1 ebgp 2

 net 192.168.4.0 mask 255.255.255.0

ip route 192.168.1.1 255.255.255.255 172.16.14.1
ip route 192.168.3.1 255.255.255.255 172.16.34.3

! 3. Configuring BGP on R1 to alert traffic for R3 via R2
!
! R1
router bgp 65040
 nei 192.168.2.1 remote 65030
 nei 192.168.2.1 update lo0
 nei 192.168.2.1 ebgp 2
 nei 192.168.4.1 remote 65010
 nei 192.168.4.1 update lo0
 nei 192.168.4.1 ebgp 2

 net 192.168.1.0 mask 255.255.255.0

 nei 192.168.2.1 route-map SET_WEIGHT in

ip route 192.168.2.1 255.255.255.255 172.16.12.2
ip route 192.168.4.1 255.255.255.255 172.16.14.4

route-map SET_WEIGHT permit 10
 match as-path 10
 set weight 150

route-map SET_WEIGHT permit 20
 set weight 100

ip as-path access-list 10 permit _65020$

! 4. Verifying BGP neighbors
!
do sh pi 192.168.3.1 so 192.168.1.1

do sh ip bgp

do sh ip bgp sum

!#####################################################################
! Chapter 6 Example Modifying BGP Local Preference Attribute with
!            Path Manipulation
!
! File: RTR.Ch6-ex.BGP.Attr.Local.Preference-01
!
! Procedures:
!  1. Basic configuration for interfaces
!  2. Configuring BGP on all routers 
!  3. Verifying BGP on R1
!  4. Configuring BGP on R1 to alter ISP2 traffic via ISP1
!  5. Verifying BGP on R1
!
! 1. Basic configuration for interfaces
!
! R1
int lo0
 ip add 192.168.1.1 255.255.255.0
 ip ospf 1 area 0

int s0/0
 enc ppp
 ip add 192.168.28.2 255.255.255.252
 no shut

int f0/0
 ip add 192.168.13.1 255.255.255.252
 ip ospf 1 area 0
 no shut

! R2
int lo0
 ip add 192.168.2.2 255.255.255.0
 ip ospf 1 area 0

int s0/0
 enc ppp
 ip add 172.20.50.2 255.255.255.252
 no shut

int f0/0
 ip add 192.168.23.2 255.255.255.252
 ip ospf 1 area 0
 no shut

! R3
int lo0
 ip add 192.168.3.3 255.255.255.0
 ip ospf 1 area 0

int f0/0
 ip add 192.168.23.1 255.255.255.252
 ip ospf 1 area 0
 no shut

int f0/1
 ip add 192.168.13.2 255.255.255.252
 ip ospf 1 area 0
 no shut

! ISP1
int s0/0
 enc ppp
 ip add 192.168.28.1 255.255.255.252
 no shut

int s0/1
 enc ppp
 ip add 192.168.38.2 255.255.255.252
 no shut

! ISP2
int lo0
 ip add 172.30.0.1 255.255.0.0

int s0/0
 enc ppp
 ip add 172.20.51.2 255.255.255.252
 no shut

int s0/1
 enc ppp
 ip add 172.20.50.1 255.255.255.252
 no shut

! ISPx
int lo0
 ip add 172.24.0.1 255.255.0.0

int s0/0
 enc ppp
 ip add 172.20.52.1 255.255.255.252
 no shut

int s0/1
 enc ppp
 ip add 172.20.51.1 255.255.255.252
 no shut

! ISPy
int lo0
 ip add 172.16.0.1 255.255.0.0
 
int s0/0
 enc ppp
 ip add 192.168.38.1 255.255.255.252
 no shut

int s0/1
 enc ppp
 ip add 172.20.52.2 255.255.255.252
 no shut

! Verifying connectivity

! 2. Configuring BGP on all routers 
!
! R1
router bgp 65001
 nei 192.168.28.1 remote 65002
 nei 192.168.13.2 remote 65001
 nei 192.168.23.2 remote 65001
 nei 192.168.28.1 next-hop-self
 nei 192.168.13.2 next-hop-self
 nei 192.168.23.2 next-hop-self
 net 192.168.1.0 mask 255.255.255.0

! R2
router bgp 65001
 nei 172.20.50.1 remote 65005
 nei 192.168.23.1 remote 65001
 nei 192.168.13.1 remote 65001
 nei 172.20.50.1 next-hop-self
 nei 192.168.23.1 next-hop-self
 nei 192.168.13.1 next-hop-self
 net 192.168.2.0 mask 255.255.255.0

! R3
router bgp 65001
 nei 192.168.13.1 remote 65001
 nei 192.168.23.2 remote 65001
 nei 192.168.13.1 next-hop-self
 nei 192.168.23.2 next-hop-self
 net 192.168.3.0 mask 255.255.255.0

! ISP1
router bgp 65002
 nei 192.168.38.1 remote 65003
 nei 192.168.28.2 remote 65001
 
! ISP2
router bgp 65005
 nei 172.20.50.2 remote 65001
 nei 172.20.51.1 remote 65004
 net 172.30.0.0 mask 255.255.0.0

! ISPx
router bgp 65004
 nei 172.20.52.2 remote 65003
 nei 172.20.51.2 remote 65005
 net 172.24.0.0 mask 255.255.0.0

! ISPy
router bgp 65003
 nei 192.168.38.2 remote 65002
 nei 172.20.52.1 remote 65004
 net 172.16.0.0 mask 255.255.0.0

! 3. Verifying BGP on R1
!
do sh ip bgp 


! 4. Configuring BGP on R1 to alter ISP2 traffic via ISP1
!
! R1
router bgp 65001
 nei 192.168.28.1 route-map SET_LOCALPREF in

route-map SET_LOCALPREF permit 10
 match ip addr 65
 set local-preference 400

route-map SET_LOCAL_PREF permit 20

access-list 65 permit 172.24.0.0 0.0.255.255

! 5. Verifying BGP neighbors on R1
!
do sh ip bgp



!#####################################################################
! Chapter 6 Example Modifying BGP Local Preference Attribute 
!
! File: RTR.Ch6-ex.BGP.Attr.Local.Preference-02
!
! Procedures:
!  1. Basic configuration for interfaces
!  2. Configuring BGP on R1~R6 
!    a. R1 with local preference = 200 
!    b. R2 with local preference = 500 
!  3. Verifying BGP neighbors
!
!  1. Basic configuration for interfaces
!
! R1
int lo0
 ip add 192.168.1.1 255.255.255.0
 ip ospf 1 area 0

int s1/0
 enc ppp
 ip add 192.168.12.1 255.255.255.0
 ip ospf 1 area 0
 no shut

int s1/1
 enc ppp
 ip add 192.168.13.1 255.255.255.0
 ip ospf 1 area 0
 no shut

int s1/2
 enc ppp
 ip add 192.168.14.1 255.255.255.0
 ip ospf 1 area 0
 no shut

int s1/3
 enc ppp
 ip add 172.16.11.1 255.255.255.0
 no shut

! R2
int lo0
 ip add 192.168.2.2 255.255.255.0
 ip ospf 1 area 0

int s1/0
 enc ppp
 ip add 192.168.12.2 255.255.255.0
 ip ospf 1 area 0
 no shut

int s1/1
 enc ppp
 ip add 192.168.24.2 255.255.255.0
 ip ospf 1 area 0
 no shut

int s1/2
 enc ppp
 ip add 172.16.22.1 255.255.255.0
 no shut

! R3
int lo0
 ip add 192.168.3.3 255.255.255.0
 ip ospf 1 area 0

int s1/0
 enc ppp
 ip add 192.168.13.3 255.255.255.0
 ip ospf 1 area 0
 no shut

int s1/1
 enc ppp
 ip add 192.168.34.3 255.255.255.0
 ip ospf 1 area 0
 no shut

! R4
int lo0
 ip add 192.168.4.4 255.255.255.0
 ip ospf 1 area 0

int s1/0
 enc ppp
 ip add 192.168.14.4 255.255.255.0
 ip ospf 1 area 0
 no shut

int s1/1
 enc ppp
 ip add 192.168.24.4 255.255.255.0
 ip ospf 1 area 0
 no shut

int s1/2
 enc ppp
 ip add 192.168.34.4 255.255.255.0
 ip ospf 1 area 0
 no shut

! ISP1
int lo0
 ip add 10.0.1.1 255.255.255.0
 
int s0/0
 enc ppp
 ip add 172.16.11.2 255.255.255.0
 no shut

! ISP2
int lo0
 ip add 10.0.2.1 255.255.255.0
 
int s0/0
 enc ppp
 ip add 172.16.22.2 255.255.255.0
 no shut

! 2. Configuring BGP on R1~R6 
!   a. R1 with local preference = 200 
!   b. R2 with local preference = 500 
!
! R1 - R4
router bgp 65001
 nei INTERNAL peer-group
 nei INTERNAL remote 65001
 nei INTERNAL update lo0
 nei INTERNAL next-hop-self
 nei 192.168.1.1 peer-group INTERNAL
 nei 192.168.2.2 peer-group INTERNAL
 nei 192.168.3.3 peer-group INTERNAL
 nei 192.168.4.4 peer-group INTERNAL

! R1
router bgp 65001
 nei 172.16.11.2 remote 65002
 net 192.168.1.0 mask 255.255.255.0

 bgp default local-preference 200

! R2
router bgp 65001
 nei 172.16.22.2 remote 65002
 net 192.168.2.0 mask 255.255.255.0

 bgp default local-preference 500

! R3
router bgp 65001
 net 192.168.3.0 mask 255.255.255.0

! R4
router bgp 65001
 net 192.168.4.0 mask 255.255.255.0

! ISP1
router bgp 65002
 nei 172.16.11.1 remote 65001
 net 10.0.1.0 mask 255.255.255.0

! ISP1
router bgp 65002
 nei 172.16.22.1 remote 65001
 net 10.0.2.0 mask 255.255.255.0

!  3. Verifying BGP neighbors
do sh ip bgp


!#####################################################################
! Chapter 6 Example Modifying BGP AS Path Attribute 
!
! File: RTR.Ch6-ex.BGP.Attr.AS.Path-01
!
! Procedures:
!  1. Basic configuration for interfaces
!  2. Configuring Bassic BGP on R1~R6 
!  3. Changing the AS-Path for R1
!  4. Verifying BGP neighbors
!
! 1. Basic configuration for interfaces
!
! R1
int lo0
 ip add 192.168.1.1 255.255.255.0
 ip ospf 1 area 0

int s0/0
 enc ppp
 ip add 172.16.14.1 255.255.255.252
 no shut

int f0/0
 ip add 172.16.13.1 255.255.255.252
 ip ospf 1 area 0
 no shut

! R2
int lo0
 ip add 192.168.2.1 255.255.255.0
 ip ospf 1 area 0

int s0/0
 enc ppp
 ip add 172.16.26.1 255.255.255.252
 no shut

int f0/0
 ip add 172.16.23.1 255.255.255.252
 ip ospf 1 area 0
 no shut

! R3
int lo0
 ip add 192.168.3.1 255.255.255.0
 ip ospf 1 area 0

int f0/0
 ip add 172.16.13.2 255.255.255.252
 ip ospf 1 area 0
 no shut

int f0/1
 ip add 172.16.23.2 255.255.255.252
 ip ospf 1 area 0
 no shut

! R4
int lo0
 ip add 192.168.4.1 255.255.255.0

int s0/1
 enc ppp
 ip add 172.16.14.2 255.255.255.252
 no shut

int s0/0
 enc ppp
 ip add 172.16.45.1 255.255.255.252
 no shut

! R5
int lo0
 ip add 192.168.5.1 255.255.255.0

int s0/1
 enc ppp
 ip add 172.16.45.2 255.255.255.252
 no shut

int s0/0
 enc ppp
 ip add 172.16.56.1 255.255.255.252
 no shut

! R6
int lo0
 ip add 192.168.6.1 255.255.255.0

int s0/1
 enc ppp
 ip add 172.16.56.2 255.255.255.252
 no shut

int s0/0
 enc ppp
 ip add 172.16.26.2 255.255.255.252
 no shut

! 2. Configuring Bassic BGP on R1~R6
!
! R1 - R3
router bgp 65040
 nei INTERNAL peer-group
 nei INTERNAL remote 65040
 nei INTERNAL update lo0
 nei INTERNAL next-hop-self

 nei 192.168.1.1 peer-group INTERNAL
 nei 192.168.2.1 peer-group INTERNAL
 nei 192.168.3.1 peer-group INTERNAL

! R1
router bgp 65040
 nei 172.16.14.2 remote 65010
 net 192.168.1.0 mask 255.255.255.0
 
! R2
router bgp 65040
 nei 172.16.26.2 remote 65030
 net 192.168.2.0 mask 255.255.255.0
 
! R3
router bgp 65040
 net 192.168.3.0 mask 255.255.255.0

! R4
router bgp 65010
 nei 172.16.14.1 remote 65040
 nei 172.16.45.2 remote 65020
 net 192.168.4.0 mask 255.255.255.0

! R5
router bgp 65020
 nei 172.16.45.1 remote 65010
 nei 172.16.56.2 remote 65030
 net 192.168.5.0 mask 255.255.255.0

! R6
router bgp 65030
 nei 172.16.56.1 remote 65020
 nei 172.16.26.1 remote 65040
 net 192.168.6.0 mask 255.255.255.0

! 3. Changing the AS-Path for R1
!
! R1
router bgp 65040
 nei 172.16.14.1 route-map SET_AS_PATH out

route-map SET_AS_PATH permit 10
 set as-path prepend 65040 65040 65040

! 4. Verifying BGP neighbors
do sh ip bgp

do trac 192.168.3.1 so lo0

!#####################################################################
! Chapter 6 Example Modifying BGP MED Attribute - All Routes
!
! File: RTR.Ch6-ex.BGP.Attr.MED-01
!
! Procedures:
!  1. Basic configuration for interfaces
!  2. Configuring Bassic BGP on R1~R5 
!  3. Changing the AS-Path with Route Map
!    a. R1 with metric-1001
!    b. R2 with metric=90
!  4. Verifying BGP neighbors
!
!  1. Basic configuration for interfaces
!
! R1
int lo0 
 ip add 192.168.25.1 255.255.255.0
 ip ospf 1 area 0

int s0/0
 enc ppp
 ip add 172.16.13.1 255.255.255.252
 ip ospf 1 area 0
 no shut
 
int s0/1
 enc ppp
 ip add 10.0.1.2 255.255.255.252
 no shut

! R2
int lo0 
 ip add 192.168.24.1 255.255.255.0
 ip ospf 1 area 0

int s0/0
 enc ppp
 ip add 172.16.23.1 255.255.255.252
 ip ospf 1 area 0
 no shut
 
int s0/1
 enc ppp
 ip add 10.0.2.2 255.255.255.252
 no shut

! R3
int lo0 
 ip add 192.168.26.1 255.255.255.0
 ip ospf 1 area 0

int s0/0
 enc ppp
 ip add 172.16.13.2 255.255.255.252
 ip ospf 1 area 0
 no shut
 
int s0/1
 enc ppp
 ip add 172.16.23.2 255.255.255.252
 ip ospf 1 area 0
 no shut

! ISP1
int lo0
 ip add 192.168.1.1 255.255.255.0

int s0/0
 enc ppp
 ip add 10.0.1.1 255.255.255.252
 no shut

! ISP2
int lo0
 ip add 192.168.2.1 255.255.255.0

int s0/0
 enc ppp
 ip add 10.0.2.1 255.255.255.252
 no shut

!  2. Configuring Bassic BGP on R1~R5 
!
! R1 - R3
router bgp 65000
 nei AS65000 peer-group
 nei AS65000 remote 65000
 nei AS65000 update lo0
 nei AS65000 next-hop-self
 nei 192.168.24.1 peer-group AS65000
 nei 192.168.25.1 peer-group AS65000 
 nei 192.168.26.1 peer-group AS65000 

! R1
router bgp 65000
 nei 10.0.1.1 remote 65001
 net 192.168.25.0 mask 255.255.255.0

! R2
router bgp 65000
! nei 10.0.2.1 remote 65001
 nei 192.168.2.1 remote 65001
 nei 192.168.2.1 update lo0
 nei 192.168.2.1 ebgp 2
 net 192.168.24.0 mask 255.255.255.0

ip route 192.168.2.1 255.255.255.255 s0/1

! R3
router bgp 65000
 net 192.168.26.0 mask 255.255.255.0

! ISP1
router bgp 65001
 nei 10.0.1.2 remote 65000
 net 192.168.1.0 mask 255.255.255.0

! ISP2
router bgp 65001
! nei 10.0.2.2 remote 65000
 nei 192.168.24.1 remote 65000
 nei 192.168.24.1 update lo0
 nei 192.168.24.1 ebgp 2
 net 192.168.2.0 mask 255.255.255.0

ip route 192.168.24.1 255.255.255.255 s0/0

! Verify
do sh ip bgp

do trace 192.168.1.1 so lo0
do trace 192.168.2.1 so lo0

!  3. Changing the AS-Path with Route Map
!    a. R1 with metric-1001
!    b. R2 with metric=90
!
! R1
router bgp 65000
 default-metric 1001
 
! R2
router bgp 65000
 default-metric 99

!  4. Verifying BGP neighbors



!#####################################################################
! Chapter 6 Example Modifying BGP MED Attribute - Route Map
!
! File: RTR.Ch6-ex.BGP.Attr.MED-02
!
! Procedures:
!  1. Basic configuration for interfaces
!  2. Configuring Bassic BGP on R1~R6 
!  3. Changing the MED for R1
!  4. Verifying BGP neighbors
!
! 1. Basic configuration for interfaces
!
! R1
int lo0
 ip add 192.168.25.1 255.255.255.0
 ip ospf 1 area 0

int s0/0
 enc ppp
 ip add 172.16.13.1 255.255.255.252
 ip ospf 1 area 0
 no shut

int s0/1
 enc ppp
 ip add 10.0.11.2 255.255.255.252
 no shut

! R2
int lo0
 ip add 192.168.24.1 255.255.255.0
 ip ospf 1 area 0

int s0/0
 enc ppp
 ip add 172.16.23.1 255.255.255.252
 no shut
 ip ospf 1 area 0

int s0/1
 enc ppp
 ip add 10.0.22.2 255.255.255.252
 no shut

! R3
int lo0
 ip add 192.168.26.1 255.255.255.0
 ip ospf 1 area 0

int s0/0
 enc ppp
 ip add 172.16.13.2 255.255.255.252
 ip ospf 1 area 0
 no shut

int s0/1
 enc ppp
 ip add 172.16.23.2 255.255.255.252
 ip ospf 1 area 0
 no shut

! ISP1
int lo0
 ip add 192.168.1.1 255.255.255.0
 ip ospf 100 area 0

int s0/0
 enc ppp
 ip add 10.0.11.1 255.255.255.252
 no shut

int s0/1
 enc ppp
 ip add 10.0.13.1 255.255.255.252
 ip ospf 100 area 0
 no shut

! ISP2
int lo0
 ip add 192.168.2.1 255.255.255.0
 ip ospf 100 area 0

int s0/0
 enc ppp
 ip add 10.0.22.1 255.255.255.252
 no shut

int s0/1
 enc ppp
 ip add 10.0.23.1 255.255.255.252
 ip ospf 100 area 0
 no shut

! ISP3
int lo0
 ip add 192.168.3.1 255.255.255.0
 ip ospf 100 area 0

int s0/0
 enc ppp
 ip add 10.0.13.2 255.255.255.252
 ip ospf 100 area 0
 no shut

int s0/1
 enc ppp
 ip add 10.0.23.2 255.255.255.252
 ip ospf 100 area 0
 no shut

! 2. Configuring Bassic BGP on R1~R6 
!
! R1 - R3
router bgp 65001
 nei AS65001 peer-group
 nei AS65001 remote-as 65001
 nei AS65001 update lo0
 nei AS65001 next-hop-self
 nei 192.168.24.1 peer-group AS65001
 nei 192.168.25.1 peer-group AS65001
 nei 192.168.26.1 peer-group AS65001

! R1
router bgp 65001
 nei 10.0.11.1 remote 65002
 net 192.168.25.0 mask 255.255.255.0

! R2
router bgp 65001
 nei 10.0.22.1 remote 65002
 net 192.168.24.0 mask 255.255.255.0

! R3
router bgp 65001
 net 192.168.26.0 mask 255.255.255.0

! ISP1 - ISP3
router bgp 65002
 nei AS65002 peer-group
 nei AS65002 remote 65002
 nei AS65002 update lo0
 nei AS65002 next-hop-self
 nei 192.168.1.1 peer-group AS65002
 nei 192.168.2.1 peer-group AS65002
 nei 192.168.3.1 peer-group AS65002

! ISP1
router bgp 65002
 nei 10.0.11.2 remote 65001
 net 192.168.1.0 mask 255.255.255.0

! ISP2
router bgp 65002
 nei 10.0.22.2 remote 65001
 net 192.168.2.0 mask 255.255.255.0

! ISP3
router bgp 65002
 net 192.168.3.0 mask 255.255.255.0

! 3. Changing the MED for R1 * R2
!
! R1
router bgp 65001
 nei 192.168.1.1 route-map MED_65002 out

route-map MED_65002 per 10
 match ip addr 66
 set metric 100

route-map MED_65002 per 20
 set metric 200

access-list 66 per 192.168.25.0 0.0.0.255
access-list 66 per 192.168.26.0 0.0.0.255

! R2
router bgp 65002
 nei 192.168.2.1 route-map MED_65001 out

route-map MED_65001 per 10
 match ip addr 66
 set metric 100

route-map MEC_65001 per 20
 set metric 200

access-list 66 per 192.168.24.0 0.0.0.255

! 4. Verifying BGP neighbors
!
do sh ip bgp



!#####################################################################
! Chapter 6 Example BGP Prefix List 
!
! File: RTR.Ch6-ex.BGP.Prefix.List-01
!
! Procedures:
!  1. Basic configuration for interfaces
!  2. Configuring Bassic BGP on R1-R2 
!  3. Configuring Prefix List on R2
!  4. Verifying BGP neighbors
!
!  1. Basic configuration for interfaces
!
! R1
int lo0
 ip add 172.16.10.1 255.255.255.0
 
int s0/0
 enc ppp
 ip add 172.16.1.1 255.255.255.0
 no shut
 
! R2
int lo0
 ip add 172.16.20.1 255.255.255.0

int s0/0
 enc ppp
 ip add 172.16.1.2 255.255.255.0
 no shut

!  2. Configuring Bassic BGP on R1-R2 
!
! R1
router bgp 65001
 nei 172.16.1.2 remote 65002
 net 172.16.10.0 mask 255.255.255.0

ip route 172.16.20.1 255.255.255.255 s0/0

! R2
router bgp 65002
 nei 172.16.1.1 remote 65001
 net 172.16.20.0 mask 255.255.255.0

ip route 172.16.10.1 255.255.255.255 s0/0

!  3. Configuring Prefix List on R2
!
router bgp 65002
 nei 172.16.1.1 prefix-list ANY_6to24_NET in

ip prefix-list ANY_8to24_NET per 0.0.0.0/0 ge 8 le 24

!  4. Verifying BGP neighbors
!
do sh ip prefix-list detail ANY_8to24_NET


!#####################################################################
! Chapter 6 Example BGP Route Map 
!
! File: RTR.Ch6-ex.BGP.Route.Map-01
!
! Procedures:
!  1. Basic configuration for interfaces
!  2. Configuring Bassic BGP on R1-R2 
!  3. Configuring Route Map on R1
!  4. Verifying BGP neighbors
!
!  1. Basic configuration for interfaces
!
! R1
int f0/0
 ip add 172.16.12.2 255.255.255.252
 no shut

int f0/1
 ip add 172.16.13.2 255.255.255.252
 no shut

! R2
int f0/0
 ip add 172.16.12.1 255.255.255.252
 no shut

int f0/1
 ip add 172.16.23.2 255.255.255.252
 no shut

! R3
int f0/0
 ip add 172.16.23.1 255.255.255.252
 no shut

int f0/1
 ip add 172.168.13.1 255.255.255.252
 no shut

!  2. Configuring Bassic BGP on R1-R2 
!
! R1
router bgp 65213
 nei 172.16.12.1 remote 65527
 nei 172.16.13.1 remote 65527
 net 172.16.12.0 mask 255.255.255.252

! R2
router bgp 65527
 nei 172.16.12.2 remote 65213
 nei 172.16.23.1 remote 65527
 net 172.16.23.0 mask 255.255.255.252

! R3
router bgp 65527
 nei 172.16.23.2 remote 65527
 nei 172.16.13.2 remote 65213
 net 172.16.13.0 mask 255.255.255.252 

!  3. Configuring Route Map on R1
!
router bgp 65213
 nei 172.16.12.1 route-map FILTER in
 nei 172.16.13.1 route-map FILTER in
 
route-map FILTER per 10
 match ip add prefix-list DEF_ONLY
 match as-path 10
 set weight 150

route-map FILTER per 20
 match ip add prefix-list DEF_ONLY
 set weight 100

ip as-path aceess-list 10 per _65527$
ip prefix-list DEF_ONLY seq 10 per 0.0.0.0/0

!  4. Verifying BGP neighbors
!
do sh ip bgp





