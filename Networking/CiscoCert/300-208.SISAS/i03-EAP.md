# Authentication & Authorization - EAP

## Extensible Authentication Protocol (EAP)

+ EAP is an authentication framework
    + Mainly used in Wi-Fi and wired
+ 802.1x defines the encapsulation of EAP over IEEE 802, namely EAP over LAN (EAPOL)
+ 802.1x is a flexible layer 2 authentication mechanism
    + Makes use of EAP methods, tunneled inside RADIUS packets
    + Currently there are about 40 different methods defined
+ EAP method types
    + Tunneled (protects the supplicant’s identity and credentials)
    + Non-tunneled (does not protect supplicant’s credentials)

+ 802.1X w/ EAP
    <br/><img src="https://www.cisco.com/c/dam/en/us/td/i/200001-300000/210001-220000/214001-215000/214087.eps/_jcr_content/renditions/214087.jpg" alt="High-Level 802.1X Sequence" href="https://www.cisco.com/c/en/us/td/docs/solutions/Enterprise/Security/TrustSec_1-99/Dot1X_Deployment/Dot1x_Dep_Guide.html" width="450">

+ <a name="EAP-FASTv1">Tunneled EAP</a>
    <br/><img src="https://mrncciew.files.wordpress.com/2013/03/peap-1.png" alt="the PEAP packet flow" href="https://mrncciew.com/2013/03/03/eap-overview/" width="450">

+ 802.1x authentication components
    <br/><img src="https://www.researchgate.net/profile/Choong-Ho_Cho/publication/4374057/figure/fig3/AS:279974889181200@1443762623852/8021x-authentication-components.png" alt="802.1x authentication components " href="urhttps://www.researchgate.net/publication/4374057_Designs_of_a_Secure_Wireless_LAN_Access_Technique_and_an_Intrusion_Detection_System_for_Home_Network/figures?lo=1l" width="300">

## Common EAP Tunneled Methods

+ PEAP - Protected EAP (developed by Microsoft, Cisco, RSA)
    + Two phase method
        + Phase 1, called outer method, used to authenticate server and form the TLS channel
        + Phase 2, called inner method, used to authenticate supplicant and protect its EAP identity
    + Theoretically, inner authentication method can be any EAP type
    + Mutual authentication
        + Server is always authenticated by certificate
        + Supplicant is authenticated by certificate (EAP-TLS), username/password (EAPMSCHAPv2), or OTP (EAP-GTC)
        + Requires server certificates, on client is optional
    + Identity protection available only in PEAPv1 and PEAPv2
    + Data Flow
        <br/><img src="https://sites.google.com/site/amitsciscozone/_/rsrc/1468881647294/home/switching/peap---protected-eap-protocol/PEAP%20message%20exchange.PNG" alt="PEAP" href="https://sites.google.com/site/amitsciscozone/home/switching/peap---protected-eap-protocol" width="450">

+ EAP-FASTv1 (Flexible Authentication via Secure Tunneling)
    + Cisco proprietary, similar with PEAP in scope but very different in functionality
        + Developed to allow faster re-authentication and wireless roaming
    + Based on PAC files (Protected Access Credentials)
        + Can be seen as a cookie locally stored on the supplicant
        + Generated by the RADIUS server from a master key known by itself only
    + Three-phase method
        + Phase 0 is optional and used to provision the supplicant with a PAC file
        + Phase 1 is used to establish the TLS tunnel based on the PAC file
        + Phase 2 is used to authenticate the supplicant within the TLS tunnel
    + [Data Flow - Tunneled EAP](#EAP-FASTv1)

+ EAP-FASTv2 (EAP Chaining)
    + Ties machine authentication to user authentication
        + Relies on machine PAC and user PAC
        + Performs double authentication within single EAP transaction
    + Will become standard, known as EAP-TEAP (RFC draft)
    + Data Flow
        <br/><img src="https://image.slidesharecdn.com/ise2-160329194235/95/ise-20-navy-techday-8-638.jpg?cb=1459281002" alt="Ise 2.0 navy techday" href="https://www.slideshare.net/CiscoPublicSector/ise-20-navy-techday" width="450">

+ EAP-TTLS - Tunneled TLS (RFC 5281)
    + Very similar with PEAP
        + 2-phase method
        + requires server side certificate
    + Major difference as compare to PEAP is that inner method can use any authentication
        + Non-EAP methods such as PAP and CHAP supported
    + Not widely implemented: Two versions
        + EAP-TTLSv0
        + EAP-TTLSv1

+ EAP-TLS (RFC 5216)
    + Single phase protocol
    + Mutual authentication based on certificates
    + Requires client and server certificates
        + TLS tunneled created based on certificates
        + The RFC requires only server side certificates
    + No supplicant identity protection
    + Passed in EAP-Identity and in certificate exchange
    + Message Flow
        <br/><img src="https://mrncciew.files.wordpress.com/2013/03/eap-tls1.png" alt="the EAP-TLS packet flow" href="https://mrncciew.com/2013/03/03/eap-overview/" width="450">

## Common EAP Non-Tunneled Methods

+ EAP-based authentication procedure flow 
    <br/><img src="https://www.researchgate.net/profile/Choong-Ho_Cho/publication/4374057/figure/fig1/AS:279974889181197@1443762623728/EAP-based-authentication-procedure-flow-EAP-MD5-EAP-MD5-is-the-base-security.png" alt="https://www.researchgate.net/publication/4374057_Designs_of_a_Secure_Wireless_LAN_Access_Technique_and_an_Intrusion_Detection_System_for_Home_Network/figures?lo=1" href="EAP-based authentication procedure flow " width="350">

+ EAP-MD5 (RFC2284)
    + The only EAP method defined in original EAP RFC
    + Only supplicant authentication based on username/password
    + Challenge-response through MD5

+ EAP-GTC (RFC3748)
    + Developed by Cisco as alternative to PEAP
    + Supports OTP through challenge-response based authentication of supplicant

+ EAP-LEAP (Light EAP)
    + Cisco proprietary used only for wireless (WEP or TKIP keys)
    + Mutual authentication based on shared secret which is client’s password
    + Uses modified version of MS-CHAP, thus is challenge-response based
    + Supplicant authenticated based on username/password

## 802.1x Configuration Steps

+ 802.1x Configuration Steps on Supplicant
    + Configure the supplicant to use appropriate EAP method
        + It cannot be negotiated
    + Two types of supplicants
        + Built-in operating system supplicant
        + Cisco AnyConnect NAM module
    + Ideally do not let both supplicants configured

+ 802.1x Configuration Steps on NAD
    + Enable AAA: `aaa new-model`
    + Configure dot1x default authentication list: `aaa authentication dot1x default group`
    + Globally enable 802.1x: `dot1x system-auth-control`
    + Enable 802.1x on switch port facing the supplicant: `dot1x pae authenticator`
    + Enforce authentication on switch port facing the supplicant: `authentication port-control auto`
    + Define RADIUS server settings: `radius-server host <IP> key <radius key>`
    + Optionally configure other global/interface level settings

+ 802.1x Configuration Steps on ISE
    + Configure 802.1x authentication policy
        + Optionally use a default one
        + Enable same EAP method as on supplicant
    + Configure authorization policy
        + Optionally use a default one
    + Enroll ISE into PKI infrastructure
        + Only if tunneled EAP methods are used by supplicant
    + Enroll ISE into Active Directory
        + Only if EAP-TLS or EAP-MSCHAPv2 is the authentication method of supplicant

+ 802.1x Verification and Troubleshooting
    + Verification
        + `show dot1x all`
        + `show authentication session`
        + `show authentication interface <if_number>`
        + `show aaa servers`
    + Troubleshooting
        + `show authentication session interface <if_number>`
        + `debug dot1x all` (on the port of Authenticator facing supplicant)
        + `debug radius authentication` (on the port of Authenticator facing Authentication Server)

## Deploying EAP



## EAP-FASTv1 Implementation



## ISE Identity Sources



## Authentication Against AD



## AD Integration



## ISE Application Server



## Identity Prefix & Suffix Strip



## User & Machine Authorization Policies



## Deploying EAP TLS



## Issuing Certificates on ISE



## Enrolling Users on a Certificate



## User Authentication using EAP TLS



## Importing CA Certificates



## EAP-FASTv2 Chaining


