# NAT-T for IPsec

Trainer: Charles Judd


- Network address translation
  - **Network Address Translation (NAT):** converting private IP to public IP
  - **NAT Transversal (NAT-T):** used to d VPN connections across NAT devices


- Port Address Translation
  - resided at firwall btw two routers w/ site-to-site VPN btw routers
  - happening at a type of network to map multiple private IP addresses to a single public IP
  - assigning different port for private IP addresses
  - issue w/ VPN security protocols
    - protocols such as AH & ESP as L3 protocols
    - not conntaining any L4 port info
    - any NAT or PAT devices btw these router $\to$ AH & ESP packets dropped
  - NAT-T as one of the solutions


- NAT Transversal (NAT-T)
  - default feature starting in IOS 12.2(13)
  - NAT-D packets used to discover translation
  - NAT-D packets containing hashed of known source and destination IP addressing
    - matched hashes: no NAT device btw peers
    - mismatched hashes: NAT device btw peers 
  - mismatched hashes: performing NAT-T to form a IPsec tunnel
    - IPsec packets re-encapsulated within UDP
    - UDP port 4500 assigned as both source and destination
    - peer understanding NAT-T packets over port 4500 means communication is from IPsec peer
  - maintaining NTA-T
    - typical NAT translations age out quickly
    - NAT-T requiring assignments to remain in place
    - keepalive packets used to maintain assignment
    - keepalive: un-encrypted UDP packet w/ 1 byte payload
  - NAT-T keepalive timer
    - by default most NAT mapping expired in 60 seconds or less
    - the timer for keepalive able to be configured depending on the scenarios
    - cmd: `R1(config)# crypto isakmp nat keepalive <seconds>`
    - `<seconds>`:
      - range: 5 ~ 3600
      - recommendation: less than the NAT mapping expiration time


