# Spam filtering

Trainer: Charles Judd


- Cisco Email Security Appliance (ESA)
  - placed btw edge device and mail server
  - ESA acting as a mail transfer agent
  - public AX records for the domain pointing to the ESA public IP address


- Typical ESA mail flow
  - external sender emails 'support@kwtrain.com'
  - sender's emails server performs MX record search
  - hostname of Cisco ESA is returned (e.g., 'mail.kwtrain.com')
  - sender's server also queries DNS server fro the IP address associated w/ 'mail.kwtrain.com'
  - sender's mail server opens SMTP connection w/ Cisco ESA
  - ESA helps incoming mail against policies and delivers to internal email server, if acceptable
  - internal user's email client will retrieve message from internal mail server using POP or IMAP


- Demo: spam filtering on ESA
  - ESA dashboard > Security Service tab > Anti-Spam > IronPort Anti-Spam
  - IronPort Anti-Spam > IronPort Anti-Spam Overview: disabled globally > 'Enable' button
  - IronPort Anti-Spam: Success - IronPort Anti-Spam scanning is nor available ... > sections: IronPort Anti-Spam Overview, Rules Updates
  - IronPort Anti-Spam Overview > 'Edit Global Setting...' button
  - Edit IronPort Anti-Spam Global Settings > IronPort Anti-Spam Global Settings: Messages Scanning Thresholds, Timeout for Scanning Single Message, Scanning Profile


- Demo: config incoming mail policy
  - ESA dashboard > Mail Policies tab > Email Security Manager > Incoming Mail Policies
  - Incoming Mail Policies: sections - Find Polices, Policies > Policies: Polices Nme, Anti-Spam, Anti-Virus, Advanced Malware Protection, Graymail, content Filters, Outbreak Filters, Advance Phising Protection, Delete
  - Policies: Policy Name = Default Policy, Anti-Spam = Disabled, Anti-Virus = Not Available, ... > Anti-Span = Disable: 'Disable' field
  - Mail Policies: Anti-Spam > AntiSpam Settings section: areas - Positively-Identified Settings, Suspected Spam Settings, Spam Thresholds
    - Enable Anti-Spam Scanning for this Policy = Use IronPort Anti-Spam service
    - Positively-Identified Settings: Apply This Action to Message = Deliver / Drop / Bounce (need quarantine available) --> quarantine feature
    - Positively-Identified Settings: Apply This Action to Message = Deliver / Drop / Spam Quarantine / Bounce 


- Demo: config quarantine feature
  - ESA dashboard > Monitor tab > System Capacity > Spam Quarantine
  - Spam Quarantine: Spam Quarantine (disabled) > 'Enable' button
  - Edit Spam Quarantine: section - Spam Quarantine Setting, Edit-User Quarantine Access, Spam Notification
    - Spam Quarantine Settings: Quarantine Size = When storage full, automatically delete oldest message first; Schedule Delete After = 14 days; Notify Cisco Upon Message Release = Send a copy of released messages to Cisco for analysis (recommended); Span Quarantine Appearance = user Current Logo
    - Edit-User Quarantine Access: Enable Edit-User Quarantine Access = On; End-User Authentication = None / Mailbox(IMAP/POP) / (`*`)LDAP; Hide Message Bodies = Do not display message bodies to end-users until message is released
    - Spam Notification: Enable Spam Notification = On > many options to set depending on requirements
      - enable spam summary spam email digest
      - alert users about any messags quarantined
      - commom practice, otherwise user probably missing important
      - easing admin load off the email admin, email released by users themselves
    - 'Submit' button > Span Quarantine: Success - Settings are saved. ...
  - NB: LDAP Query needed to be configured if LDAP Authentication enabled






