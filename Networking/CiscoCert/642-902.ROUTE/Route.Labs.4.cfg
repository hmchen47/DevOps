
! #########################################################################
! Lab 4-1 Redistribution Between RIP and OSPF
!
! File: RTR.Lab.4-1.Redist.RIP&OSPF
!
! Procedures:
! 1. Configuring loopbacks and assign addresses
!   a. Configuring all loopbacks and interfaes
!   b. enabling secret password
!   c. verifying connectivity with tclsh
! 2. Configuring RIPv2
!   a. Configuring RIPv2
!   b. Verifying routing table
!   c. Verifying databse
! 3. Configuring passive interface in RIP
!   a. Checking RIP routes on R1
!   b. Verifying RIPv2 updates on R2
!   c. Configuring and verifying passive on serial link of R3
!   d. Verifying RIP routes on R1
!   e. Configuring passive interface on R1 & R2
! 4. Summarizing a supernet with RIP
!   a. Displaying RIP routes on R2 and configuring summary address on R1
!   b. Creating static route on R1 to eliminate error message
!   c. Verifying RIP supernet on R1 & R2
! 5. Suppress routes using prefix lists
!   a. Configuring prefix-list on R1
!   b. Applying prefix on R1
!   c. Verifying routes and database on R2
! 6. Configuring OSPF
!   a. Configuring OSPF on R2 & R3
!   b. Changing network type of loopback on R3
!   c. Verifying OSPF adjancies on R2 & R3
! 7. Configuring passive interfaces in OSPF
!   a. Configuring loopback as passive on R3
!   b. Configuring all loopbacks as passive on R3
!   c. Verifying passive settings
! 8. Allow one-way redistribution
!   a. Configuring redistribution from OSPF to RIP on R2
!   b. Verifying the redistribution on R2 
!   c. Verifying RIP routes on R1
!   d. Verifying connectivity R3 loopback on R1
!   e. Verifying trace of R3 loopback on R1
!   f. Forcing R2 to advertise a default route in OSPF
!   g. Verifying OSPF route on R3
!   h. Verifying connectivity with tclsh
! 9. Redistributing between two routing protocols
!   a. Remove default route advertisement and redistribute RIP
!   b. Verifying OSPF routes on R3
!   c. Modify redistribute with subnets on R3
!   d. Verifying OSPF routes on R3
!   e. Verifying connectivity with tclsh
! 10. Set a default see metric
!   a. Configuring OSPF default metric on R2
!   b. verifying the metric settings
!11. Changing OSPF external network type
!   a. redistributing RIP into OSPF with metric type on R2
!   b. Verifying ospf routes on R3
!
! 
! 1. Configuring loopbacks and assign addresses
!   a. Configuring all loopbacks and interfaes
! 
! R1
int lo0
 ip add 172.16.1.1 255.255.255.0
int lo48
 ip add 192.168.48.1 255.255.255.0
int lo49
 ip add 192.168.49.1 255.255.255.0
int lo50
 ip add 192.168.50.1 255.255.255.0
int lo51
 ip add 192.168.51.1 255.255.255.0
int lo70
 ip add 192.168.70.1 255.255.255.0

int s0/0
 ip add 172.16.12.1 255.255.255.0
 enc ppp
 clock rate 128000
 bandwidth 128
 no shut

! R2
int lo0
 ip add 172.16.2.1 255.255.255.0

int s0/0
 enc ppp
 ip add 172.16.12.2 255.255.255.0
 bandwidth 128
 no shut

int s0/1
 enc ppp
 ip add 172.16.23.2 255.255.255.0
 clock rate 128000
 bandwidth 128
 no shut

! R3
int lo0
 ip add 172.16.3.1 255.255.255.0
int lo20
 ip add 192.168.20.1 255.255.255.0
int lo25
 ip add 192.168.25.1 255.255.255.0
int lo30
 ip add 192.168.30.1 255.255.255.0
int lo35
 ip add 192.168.35.1 255.255.255.0
int lo40
 ip add 192.168.40.1 255.255.255.0

int s0/0
 enc ppp
 ip add 172.16.23.3 255.255.255.0
 band 128
 no shut

! b. enabling secret password
!
! R1 ~ R3
enable secret cisco

line con 0
 logging synchronous
 exec-timeout 0 0

line vty 0 4
 password cisco
 login

! c. verifying connectivity with tclsh
!
! R1 ~ R3
end

tclsh

foreach addr {
 172.16.1.1
 192.168.48.1
 192.168.49.1
 192.168.50.1
 192.168.51.1
 192.168.70.1
 172.16.12.1
 172.16.2.1
 172.16.12.2
 172.16.23.2
 172.16.3.1
 172.16.23.3
 192.168.20.1
 192.168.25.1
 192.168.30.1
 192.168.35.1
 192.168.40.1
} {
 ping $addr 
}

exit
conf t

! 2. Configuring RIPv2
!  a. Configuring RIPv2
! 
! R1
router rip 
 ver 2
 no au
 net 172.16.0.0
 net 192.168.48.0
 net 192.168.49.0
 net 192.168.50.0
 net 192.168.51.0
 net 192.168.70.0

! R2
router rip
 ver 2
 no au
 net 172.16.0.0

! b. Verifying routing table
!
! R1 & R2
do sh ip rou rip

! c. Verifying databse
!
! R1 & R2
do sh ip rip database

! 3. Configuring passive interface in RIP
!  a. Checking RIP routes on R1
!
do sh ip rou rip

! b. Verifying RIPv2 updates on R2
!
do sh ip pro

! c. Configuring and verifying passive on serial link of R2
!
! R2
router rip
 passive-interface s0/1

do sh ip pro

! d. Verifying RIP routes on R1
do sh ip rou rip

! e. Configuring passive interface on R1 & R2
!
! R1
router rip
 passive-interface lo0
 passive-interface lo48
 passive-interface lo49
 passive-interface lo50
 passive-interface lo51
 passive-interface lo70

! Alternative
router rip
 passive-interface default
 no passive-interface s0/0

! R2
router rip
 passive-interface lo0

! 4. Summarizing a supernet with RIP
!  a. Displaying RIP routes on R2 and configuring summary address on R1
!
! R2
do sh ip rou rip

! R1 --> error message
int s0/0
! ip summary-address rip 192.168.48.0 255.255.252.0
 ip summary-address rip 192.168.48.0 255.255.255.0
 ip summary-address rip 192.168.49.0 255.255.255.0
 ip summary-address rip 192.168.50.0 255.255.255.0
 ip summary-address rip 192.168.51.0 255.255.255.0

! b. Creating static route on R1 to eliminate error message
ip route 192.168.48.0 255.255.255.0 null0

router rip
 redistribute static

! c. Verifying RIP supernet on R1 & R2
!
do sh ip rou

! 5. Suppress routes using prefix lists
!  a. Configuring prefix-list on R1
ip prefix-list RIP_OUT per 192.168.48.0/22
ip prefix-list RIP_OUT deny 192.168.48.0/22 le 24
ip prefix-list RIP_OUT per 0.0.0.0/0 le 32

! b. Applying prefix on R1
router rip
 distribute-list prefix RIP_OUT out s0/0

! c. Verifying routes and database on R2
do sh ip rou rip

do sh ip rip database

! 6. Configuring OSPF
!  a. Configuring OSPF on R2 & R3
!
! R2
router ospf 1
 net 172.16.23.0 0.0.0.255 area 0

! R3
router ospf 1
 net 172.16.0.0 0.0.255.255 area 0
 net 192.168.0.0 0.0.255.255 area 0

! b. Changing network type of loopback on R3
int lo0
 ip ospf net point-to-point
int lo20
 ip ospf net point-to-point
int lo25
 ip ospf net point-to-point
int lo30
 ip ospf net point-to-point
int lo35
 ip ospf net point-to-point
int lo40
 ip ospf net point-to-point

! c. Verifying OSPF adjancies on R2 & R3
do sh ip ospf nei

do sh ip route ospf

! 7. Configuring passive interfaces in OSPF
!  a. Configuring loopback as passive on R3
router ospf 1
 passive-interface lo0

! b. Configuring all loopbacks as passive on R3
router ospf 1
 passive-interface default

no passive-interface s0/0

! c. Verifying passive settings
!
! R3
do sh ip pro

! 8. Allow one-way redistribution
!  a. Configuring redistribution from OSPF to RIP on R2
router rip
 redistribute ospf 1 metric 4

! b. Verifying the redistribution on R2 
do sh ip pro

! c. Verifying RIP routes on R1
do sh ip rou rip

! d. Verifying connectivity R3 loopback on R1
do pi 192.168.30.1

! e. Verifying trace of R3 loopback on R1
do trace 192.168.30.1

! f. Forcing R2 to advertise a default route into OSPF
router ospf 1
 default-information originate always

! g. Verifying OSPF route on R3
do sh ip rou ospf

! h. Verifying connectivity with tclsh
!  same as 1.c

! 9. Redistributing between two routing protocols
!  a. Remove default route advertisement and redistribute RIP
! R2
router ospf 1
 no default-information originate always
 redistribute rip

! b. Verifying OSPF routes on R3
do sh ip rou ospf

! c. Modify redistribute with subnets on R3
router ospf 1
 redistribute rip subnets

! d. Verifying OSPF routes on R3
do sh ip rou ospf

! e. Verifying connectivity with tclsh
!  same as 1.c

! 10. Set a default see metric
!  a. Configuring OSPF default metric on R2
router ospf 1
 default-metric 10000

! b. verifying the metric settings on R3
do sh ip rou ospf

! 11. Change the OSPF external network type
!  a. change external type for RIP into OSPF on R2
router ospf 1
 redistribute rip subnets metric-type 1

! b. Display R3 routing table
do sh ip rou ospf


!
! Running Configuration
!
! R1
interface Loopback0
 ip address 172.16.1.1 255.255.255.0
!
interface Loopback48
 ip address 192.168.48.1 255.255.255.0
!
interface Loopback49
 ip address 192.168.49.1 255.255.255.0
!
interface Loopback50
 ip address 192.168.50.1 255.255.255.0
!
interface Loopback51
 ip address 192.168.51.1 255.255.255.0
!
interface Loopback70
 ip address 192.168.70.1 255.255.255.0
!
interface Serial0/0
 bandwidth 128
 ip address 172.16.12.1 255.255.255.0
 encapsulation ppp
 clock rate 128000
!
router rip
 version 2
 redistribute static
 passive-interface default
 no passive-interface Serial0/0
 network 172.16.0.0
 network 192.168.48.0
 network 192.168.49.0
 network 192.168.50.0
 network 192.168.51.0
 network 192.168.70.0
 distribute-list prefix RIP_OUT out Serial0/0
 no auto-summary
!
ip forward-protocol nd
ip route 192.168.48.0 255.255.252.0 Null0
ip route 192.168.48.0 255.255.255.0 Null0
!
ip prefix-list RIP_OUT seq 5 permit 192.168.48.0/22
ip prefix-list RIP_OUT seq 10 deny 192.168.48.0/22 le 24
ip prefix-list RIP_OUT seq 15 permit 0.0.0.0/0 le 32

! R2
interface Loopback0
 ip address 172.16.2.1 255.255.255.0
!
interface Serial0/0
 bandwidth 128
 ip address 172.16.12.2 255.255.255.0
 encapsulation ppp
 clock rate 2000000
!
interface Serial0/1
 bandwidth 128
 ip address 172.16.23.2 255.255.255.0
 encapsulation ppp
 clock rate 128000
!
router ospf 1
 log-adjacency-changes
 redistribute rip metric-type 1 subnets
 network 172.16.23.0 0.0.0.255 area 0
 default-metric 10000
!
router rip
 version 2
 redistribute ospf 1 metric 4
 passive-interface Loopback0
 network 172.16.0.0
 no auto-summary

! R3
interface Loopback0
 ip address 172.16.3.1 255.255.255.0
 ip ospf network point-to-point
!
interface Loopback20
 ip address 192.168.20.1 255.255.255.0
 ip ospf network point-to-point
!
interface Loopback25
 ip address 192.168.25.1 255.255.255.0
 ip ospf network point-to-point
!
interface Loopback30
 ip address 192.168.30.1 255.255.255.0
 ip ospf network point-to-point
!
interface Loopback35
 ip address 192.168.35.1 255.255.255.0
 ip ospf network point-to-point
!         
interface Loopback40
 ip address 192.168.40.1 255.255.255.0
 ip ospf network point-to-point
!
interface Serial0/0
 bandwidth 128
 ip address 172.16.23.3 255.255.255.0
 encapsulation ppp
 clock rate 2000000
!
router ospf 1
 log-adjacency-changes
 passive-interface default
 no passive-interface Serial0/0
 network 172.16.0.0 0.0.255.255 area 0
 network 192.168.0.0 0.0.255.255 area 0


! #########################################################################
! Lab 4-2 Redistribution Between EIGRP and OSPF
!
! File: RTR.Lab.4-2.Redist.EIGRP&OSPF
!
! Procedures:
! 1. Configuring loopbacks and additional addresses
!   a. Remove RIPv2 on R1 & R2 from Lab 4-1
!   b. Configure additional loopbacks on R2 & R3
! 2. Configuring EIGRP
!   a. Configuring EIGRP on R1 & R2 with AS 1
!   b. Verify configuration on R1 & R2
! 3. Create passive interface in EIGRP
!   a. Display EIGRP interfaces on R2
!   b. Disable EIGRP updates to R3 on R2
!   c. Verify the change
! 4. Manually summarize with EIGRP
!   a. Advertise one supernet for lo48 & lo49 to R2 on R1
!   b. Verify configuration on R1
! 5. Additional OSPF configuration
!   a. Add new OSPF areas on R2 & R3
!   b. Verify OSPF adjacencies on OSPF on R2 & R3
!   c. Override the default behavior on OSPF loopback on R2 & R3
!   d. Verify the configurationon R2
! 6. Summarize OSPF areas at the ABR
!   a. Summarize the areas into one on R3
!   b. Verify summarization on R3
! 7. Configure mtuual redistribution btw OSPF & EIGRP
!   a. Redistribute EIGRP into OSPF on R2
!   b. Verify redistribution on R2
!   c. Verifying routing table on R1 & R3
!   d. Verify connectivity with tclsh
! 8. Filter redistrinutpn with route maps
!   a. Displat routing table on R1
!   b. Configure ACL on R2
!   c. Configure route map on R2
!   d. Aplly route map to redistribution on R2
!   e. Configure a default metric under EIGRP on R2
!   f. Verify filtered routes on R1
! 9. Summarize external routes into OSPF at the ASBR
!   a. Display R3 routing table
!   b. Summarize into one supernet on R2
!   c. Verify R3 routing tbale
!   d. Trace Lo50 of R1 from R3 & R2
! 10. Modify EIGRP distances
!   a. Display R1 routing table
!   b. Change AD for EIGRP routes on R1
!   c. Verify R1 routing table and protocols
! 11. Modify OSPF distances
!   a. Display R3 routing table
!   b. Change AD for OSPF routes on R3
!   c. Verify R3 routing table and AD
! A. Exploring black hole operations
!   a. Shutdown lo50 on R1
!   b. Display R2 routing table  
!   c. Verify connectivity to Lo50 on R2 & route R3
!   d. Debug IP and ICMP packets on R3
!   e. Telnet to Lo50 on R2
!   f. Bring up Lo50 on R1
!
! 1. Configuring loopbacks and additional addresses
!   a. Remove RIPv2 on R1 & R2 from Lab 4-1
! 
! R1
no route rip
no ip route 192.168.48.0 255.255.252.0 null0
no ip prefix-list RIP_OUT

! R2
no router rip
router ospf 1
 no default-information originate
 no redistribute rip
 no default-metric 10000

! b. Configure additional loopbacks on R2 & R3
!
! R2
int lo100
 ip add 172.16.100.1 255.255.255.0

! R3
int lo8
 ip add 192.168.8.1 255.255.255.0
int lo9
 ip add 192.168.9.1 255.255.255.0
int lo10
 ip add 192.168.10.1 255.255.255.0
int lo11
 ip add 192.168.11.1 255.255.255.0

! 2. Configuring EIGRP
!   a. Configuring EIGRP on R1 & R2 with AS 1
!
! R1
router eigrp 1
 no au
 net 172.16.0.0
 net 192.168.48.0
 net 192.168.49.0
 net 192.168.50.0
 net 192.168.51.0
 net 192.168.70.0

! Alternative
router eigrp 1
 no au
 net 172.16.0.0
 net 192.168.0.0 0.0.255.255

! R2
router eigrp 1
 no au
 net 172.16.0.0

! b. Verify configuration on R1 & R2
do sh ip eigrp neighbors

do sh ip route eigrp

! 3. Create passive interface in EIGRP
!  a. Display EIGRP interfaces on R2
!
do sh ip eigrp interfaces

! b. Disable EIGRP updates to R3 on R2
router eigrp 1
 passive-interface s0/1

! c. Verify the change
do sh ip eigrp interfaces

do sh ip pro

! 4. Manually summarize with EIGRP
!  a. Advertise one supernet for lo48 & lo49 to R2 on R1
int s0/0
 ip summary-address eigrp 1 192.168.48.0 255.255.254.0

do sh ip rou eigrp

! b. Verify configuration on R1
do sh ip route 192.168.48.0 255.255.254.0

! 5. Additional OSPF configuration
!  a. Add new OSPF areas on R2 & R3
!
! R2
router ospf 1
 net 172.16.100.0 0.0.0.255 area 10

! R3
router ospf 1
 net 192.168.8.0 0.0.3.255 area 20

! b. Verify OSPF adjacencies on OSPF on R2 & R3
do sh ip ospf nei

do sh ip rou ospf

! c. Override the default behavior on OSPF loopback on R2 & R3
! R2
int lo100
 ip ospf net point-to-point

! R3
int lo8
 ip ospf net point-to-poin
int lo9
 ip ospf net point-to-point
int lo10
 ip ospf net point-to-point
int lo11
 ip ospf net point-to-point

! alternative
int range lo 8 - 11
 ip ospf net point-to-point

! d. Verify the configurationon R2
do sh ip rou

! 6. Summarize OSPF areas at the ABR
!  a. Summarize the areas into one on R3
router ospf 1
 area 20 range 192.168.8.0 255.255.252.0

! b. Verify summarization on R3
do sh ip rou ospf

! 7. Configure mtuual redistribution btw OSPF & EIGRP
!  a. Redistribute EIGRP into OSPF on R2
router ospf 1
 redistribute eigrp 1 subnets

router eigrp 1
 redistribute ospf 1 metric 10000 100 255 1 1500

! alternative
 default-metric 10000 100 255 1 1500
 redistribute ospf 1

! b. Verify redistribution on R2
do sh ip protocols

! c. Verifying routing table on R1 & R3
do sh ip route

! d. Verify connectivity with tclsh
end

tclsh

foreach addr {
 172.16.1.1
 192.168.48.1
 192.168.49.1
 192.168.50.1
 192.168.51.1
 192.168.70.1
 172.16.12.1
 172.16.2.1
 172.16.100.1
 172.16.12.2
 172.16.23.2
 172.16.3.1
 172.16.23.3
 192.168.20.1
 192.168.25.1
 192.168.30.1
 192.168.35.1
 192.168.40.1
 192.168.8.1
 192.168.9.1
 192.168.10.1
 192.168.11.1
} {
 ping $addr 
}

exit
conf t

! 8. Filter redistrinutpn with route maps
!  a. Display routing table on R1
do sh ip rou eig

! b. Configure ACL on R2
access-list 1 permit 192.168.25.0
access-list 1 permit 192.168.30.0

! c. Configure route map on R2
route-map SELECTED_DENY deny 10
 match ip address 1

route-map SELECTED_DENY permit 20

! d. Aplly route map to redistribution on R2
router eigrp 1
 redistribute ospf 1 route-map SELECTED_DENY metric 64 100 255 1 1500

! e. Configure a default metric under EIGRP on R2 <- alternative
router eigrp 1
 redistribute ospf 1 route-map SELECTED_DENY 

! f. Verify filtered routes on R1
do sh ip route eigrp

! 9. Summarize external routes into OSPF at the ASBR
!  a. Display R3 routing table
do sh ip rou ospf

! b. Summarize into one supernet on R2
router ospf 1
 summary-address 192.168.48.0 255.255.252.0

! c. Verify R3 routing tbale
do sh ip rou ospf

! d. Trace Lo50 of R1 from R3 & R2
do trace 192.168.50.1

! 10. Modify EIGRP distances
!  a. Display R1 routing table
do sh ip route eigrp

do sh ip protocols

! b. Change AD for EIGRP routes on R1
router eigrp 1
 distance eigrp 95 165

! c. Verify R1 routing table and protocols
do show ip route eigrp

! 11. Modify OSPF distances
!  a. Display R3 routing table
do sh ip rou ospf

! b. Change AD for OSPF routes on R3
router ospf 1
 distance ospf intra-area 105 inter-area 115 external 175

! c. Verify R3 routing table and AD
do show ip route ospf

do sh ip pro

!
! Running Configuration
!
! R1
interface Loopback0
 ip address 172.16.1.1 255.255.255.0
!
interface Loopback48
 ip address 192.168.48.1 255.255.255.0
!
interface Loopback49
 ip address 192.168.49.1 255.255.255.0
!
interface Loopback50
 ip address 192.168.50.1 255.255.255.0
!
interface Loopback51
 ip address 192.168.51.1 255.255.255.0
!
interface Loopback70
 ip address 192.168.70.1 255.255.255.0
!
interface Serial0/0
 bandwidth 128
 ip address 172.16.12.1 255.255.255.0
 encapsulation ppp
 ip summary-address eigrp 1 192.168.48.0 255.255.254.0 5
 clock rate 128000
!
router eigrp 1
 network 172.16.0.0
 network 192.168.0.0 0.0.255.255
 distance eigrp 95 165
 no auto-summary
!
router rip
 version 2
 redistribute static
 passive-interface default
 no passive-interface Serial0/0
 network 172.16.0.0
 network 192.168.48.0
 network 192.168.49.0
 network 192.168.50.0
 network 192.168.51.0
 network 192.168.70.0
 distribute-list prefix RIP_OUT out Serial0/0
 no auto-summary
!
ip forward-protocol nd
ip route 192.168.48.0 255.255.255.0 Null0

! R2
interface Loopback0
 ip address 172.16.2.1 255.255.255.0
!
interface Loopback100
 ip address 172.16.100.1 255.255.255.0
 ip ospf network point-to-point
!
interface Serial0/0
 bandwidth 128
 ip address 172.16.12.2 255.255.255.0
 encapsulation ppp
 clock rate 2000000
!
interface Serial0/1
 bandwidth 128
 ip address 172.16.23.2 255.255.255.0
 encapsulation ppp
 clock rate 128000
!
router eigrp 1
 redistribute ospf 1 metric 64 100 255 1 1500 route-map SELECTED_DENY
 passive-interface Serial0/1
 network 172.16.0.0
 no auto-summary
!
router ospf 1
 log-adjacency-changes
 summary-address 192.168.48.0 255.255.252.0
 redistribute eigrp 1 subnets
 network 172.16.23.0 0.0.0.255 area 0
 network 172.16.100.0 0.0.0.255 area 10
!
access-list 1 permit 192.168.25.0
access-list 1 permit 192.168.30.0
!
route-map SELECTED_DENY deny 10
 match ip address 1
!
route-map SELECTED_DENY permit 20

! R3
interface Loopback0
 ip address 172.16.3.1 255.255.255.0
 ip ospf network point-to-point
!
interface Loopback8
 ip address 192.168.8.1 255.255.255.0
 ip ospf network point-to-point
!
interface Loopback9
 ip address 192.168.9.1 255.255.255.0
 ip ospf network point-to-point
!
interface Loopback10
 ip address 192.168.10.1 255.255.255.0
 ip ospf network point-to-point
!
interface Loopback11
 ip address 192.168.11.1 255.255.255.0
 ip ospf network point-to-point
!         
interface Loopback20
 ip address 192.168.20.1 255.255.255.0
 ip ospf network point-to-point
!
interface Loopback25
 ip address 192.168.25.1 255.255.255.0
 ip ospf network point-to-point
!
interface Loopback30
 ip address 192.168.30.1 255.255.255.0
 ip ospf network point-to-point
!
interface Loopback35
 ip address 192.168.35.1 255.255.255.0
 ip ospf network point-to-point
!
interface Loopback40
 ip address 192.168.40.1 255.255.255.0
 ip ospf network point-to-point
!
interface Serial0/0
 bandwidth 128
 ip address 172.16.23.3 255.255.255.0
 encapsulation ppp
 clock rate 2000000
!
router ospf 1
 log-adjacency-changes
 area 20 range 192.168.8.0 255.255.252.0
 passive-interface default
 no passive-interface Serial0/0
 network 172.16.0.0 0.0.255.255 area 0
 network 192.168.8.0 0.0.3.255 area 20
 network 192.168.0.0 0.0.255.255 area 0
 distance ospf intra-area 105 inter-area 115 external 175


! A. Exploring black hole operations
!  a. Shutdown lo50 on R1
int lo50
 shut

! b. Display R2 routing table  
do sh ip rou

! c. Verify connectivity to Lo50 on R2 & route R3
!
! R2
do deb ip packet 

do pi 192.168.50.1

do un all

do trace 192.168.50.1

! R3
do sh ip rou 192.168.50.1

! d. Debug IP and ICMP packets on R3
do debug ip packet
do debug ip icmp

do pi 192.168.50.1

do un all

do trace 192.168.50.1
 
! e. Telnet to Lo50 on R3
do telnet 192.168.50.1

! f. Bring up Lo50 on R1
int lo50
 no shut


! #########################################################################
! Lab 4-3 Manipulating Administrative Distances
!
! File: RTR.Lab.4-3.Manipulate.AD
!
! Procedures:
! 1. Review default AD
! 2. Configure router loopbacks and addressing
! 3. Configure switch VLANs
!   a. Configure VLANs
!   b. Verify connectivity
! 4. Configure RIP
!   a. Configure RIPv2 on R1 ~ R3
!   b. Verify routing table on R1 ~ R3
!   c. Verify receiving RIP routes from others
! 5. Configure OSPF
!   a. Configure OSPF on all routers
!   b. Verify OSPF routes and neighbors for all roters
! 6. Modify the routing protocol distance
!   a. Change RIP distance on all router
!   b. Verify routing table on R1 ~ R3
!   c. Verify new deafult distance on R1 ~ R3
! 7. Modify distance based on route source
!   a. Change OSPF default AD on R1 ~ R3
!   b. Verify AD with routing table and protocol on R1 ~ R3
! 8. Modify distance based on an access list
!   a. Change AD of 172,16.0.0 on R1 ~ R3
!   b. Verify change on R1 ~ R3
!   c. Verify full connectivity 
!
!
! 1. Review default AD
! 2. Configure router loopbacks and addressing
! 
! R1
int lo1
 ip add 172.16.1.1 255.255.255.0

int lo101
 ip add 192.168.101.1 255.255.255.0

int f0/0
 ip add 172.16.12.1 255.255.255.0
 speed 100
 duplex full
 no shut

int s0/0
 ip add 172.16.13.1 255.255.255.0
 enc ppp
 band 128
 no shut

! R2
int lo2
 ip add 172.16.2.1 255.255.255.0

int lo102
 ip add 192.168.102.1 255.255.255.0

int f0/0
 ip add 172.16.12.2 255.255.255.0
 speed 100
 duplex full
 no shut

int f0/1
 ip add 172.16.23.2 255.255.255.0
 speed 100
 duplex full
 no shut

! R3
int lo3
 ip add 172.16.3.1 255.255.255.0

int lo103
 ip add 192.168.103.1 255.255.255.0
 
int f0/0
 ip add 172.16.23.3 255.255.255.0
 speed 100
 duplex full
 no shut

int s0/0
 enc ppp
 band 128
 ip add 172.16.13.3 255.255.255.0
 clock rate 128000
 no shut

! 3. Configure switch VLANs
!  a. Configure VLANs
!
! SW
no ip routing

int range f1/0 - 15
 shut
exit

end 

vlan database
 vlan 12 name R1-T2
 vlan 23 name R2-R3
exit

conf t

!vlan 12
! name R1-R2
!vlan 23
! name R2-R3

int f1/1
 desc To R1 f0/0
 switchport mode access
 switchport access vlan 12
 no shut

int f1/2
 desc To R2 f0/0
 sw mode access
 sw access vlan 12
 no shut

int f1/3
 desc To R3 f0/0
 sw mode access
 sw access vlan 12
 no shut

int f1/4
 desc To R2 f0/1
 sw mode access
 sw access vlan 12
 no shut

! b. Verify connectivity
do ping ! interfaces

! 4. Configure RIP
!  a. Configure RIPv2 on R1 ~ R3
!
! R1
router rip
 ver 2
 no au
 net 172.16.0.0
 net 192.168.101.0

! R2
router rip
 ver 2
 no au
 net 172.16.0.0
 net 192.168.102.0

! R3
router rip
 ver 2
 no au
 net 172.16.0.0
 net 192.168.103.0

! b. Verify routing table on R1 ~ R3
do sh ip rou

! c. Verify receiving RIP routes from others
do sh ip pro

! 5. Configure OSPF
!  a. Configure OSPF on all routers
!
! R1
int lo1
 ip ospf network point-to-point
int lo101
 ip ospf network point-to-point

router ospf 1
 net 172.16.0.0 0.0.255.255 area 0
 net 192.168.101.0 0.0.0.255 area 0

! R2
int lo2
 ip ospf network point-to-point
int lo102
 ip ospf network point-to-point

router ospf 1
 net 172.16.0.0 0.0.255.255 area 0
 net 192.168.102.0 0.0.0.255 area 0

! R3
int lo3
 ip ospf network point-to-point
int lo103
 ip ospf network point-to-point

router ospf 1
 net 172.16.0.0 0.0.255.255 area 0
 net 192.168.103.0 0.0.0.255 area 0

! b. Verify OSPF routes and neighbors for all roters
do sh ip ospf nei

do sh ip rou

! R1
do sh ip ospf database route adv-router 192.168.103.1

! 6. Modify the routing protocol distance
!  a. Change RIP distance on all router
!
router rip
 distance 100

! b. Verify routing table on R1 ~ R3
do sh ip rou

! c. Verify new deafult distance on R1 ~ R3
do sh ip pro

! 7. Modify distance based on route source
!  a. Change OSPF default AD on R1 ~ R3
router ospf 1
 distance 85 192.168.100.0 0.0.3.255

! b. Verify AD with routing table and protocol on R1 ~ R3
do sh ip rou

do sh ip pro

! 8. Modify distance based on an access list
!  a. Change AD of 172,16.0.0 on R1 ~ R3
!
access-list 1 permit 172.16.0.0 0.0.255.255

router rip
 distance 65 0.0.0.0 255.255.255.255 1

! b. Verify change on R1 ~ R3
do sh ip pro

do sh ip rou

! c. Verify full connectivity 
end

tclsh

foreach addr {
 172.16.1.1
 172.16.2.1
 172.16.3.1
 172.16.12.1
 172.16.12.2
 172.16.13.1
 172.16.13.3
 172.16.23.2
 172.16.23.3
 192.168.101.1
 192.168.102.1
 192.168.103.1
} {
 ping $addr
}

exit

!
! Running Configuration
!
! R1
interface Loopback1
 ip address 172.16.1.1 255.255.255.0
 ip ospf network point-to-point
!
interface Loopback101
 ip address 192.168.101.1 255.255.255.0
 ip ospf network point-to-point
!
interface FastEthernet0/0
 ip address 172.16.12.1 255.255.255.0
 speed 100
 full-duplex
!
interface Serial0/0
 bandwidth 128
 ip address 172.16.13.1 255.255.255.0
 encapsulation ppp
 clock rate 2000000
!
router ospf 1
 log-adjacency-changes
 network 172.16.0.0 0.0.255.255 area 0
 network 192.168.101.0 0.0.0.255 area 0
 distance 85 192.168.100.0 0.0.3.255
!
router rip
 version 2
 network 172.16.0.0
 network 192.168.101.0
 distance 100
 distance 65 0.0.0.0 255.255.255.255 1
 no auto-summary
!
access-list 1 permit 172.16.0.0 0.0.255.255

! R2
interface Loopback2
 ip address 172.16.2.1 255.255.255.0
 ip ospf network point-to-point
!
interface Loopback102
 ip address 192.168.102.1 255.255.255.0
 ip ospf network point-to-point
!
interface FastEthernet0/0
 ip address 172.16.12.2 255.255.255.0
 speed 100
 full-duplex
!
interface FastEthernet0/1
 ip address 172.16.23.2 255.255.255.0
 speed 100
 full-duplex
!
router ospf 1
 log-adjacency-changes
 network 172.16.0.0 0.0.255.255 area 0
 network 192.168.102.0 0.0.0.255 area 0
 distance 85 192.168.100.0 0.0.3.255
!
router rip
 version 2
 network 172.16.0.0
 network 192.168.102.0
 distance 100
 distance 65 0.0.0.0 255.255.255.255 1
 no auto-summary
!
access-list 1 permit 172.16.0.0 0.0.255.255

! R3
interface Loopback3
 ip address 172.16.3.1 255.255.255.0
 ip ospf network point-to-point
!
interface Loopback103
 ip address 192.168.103.1 255.255.255.0
 ip ospf network point-to-point
!
interface FastEthernet0/0
 ip address 172.16.23.3 255.255.255.0
 speed 100
 full-duplex
!
interface Serial0/0
 bandwidth 128
 ip address 172.16.13.3 255.255.255.0
 encapsulation ppp
 clock rate 128000
!
router ospf 1
 log-adjacency-changes
 network 172.16.0.0 0.0.255.255 area 0
 network 192.168.103.0 0.0.0.255 area 0
 distance 85 192.168.100.0 0.0.3.255
!
router rip
 version 2
 network 172.16.0.0
 network 192.168.103.0
 distance 100
 distance 65 0.0.0.0 255.255.255.255 1
 no auto-summary
!
ip forward-protocol nd
!
access-list 1 permit 172.16.0.0 0.0.255.255


! #########################################################################
! Lab 4-4 EIGRP and OSPF case study
!
! File: RTR.Lab.4-4.Redist.EIGRP&OSPF
!
! Requirements:
! 1. ITA core network is running EIGRP AS1
! 2. Summarize the loopback interfaces on R2 with the best summary 
!     route to the other EIGRP routers
! 3. Loopback 192 on R3 represents a connection to the Internet.  
!    Originate a default route into EIGRP from R3
! 4. The Local Travel Agency router, R4, needs to communicate with 
!    the ITA core via OSPF area 0
! 5. Redistribute OSPF into EIGRP
! 6. Originate a default route into the OSPF process from R3
! 7. Test connectivity using Tcl script on all routers 
!

! 1. Configure interfaces and addresses
!
!R1
int lo1
 ip add 192.168.1.1 255.255.255.252

int s0/0
 enc ppp
 ip add 192.168.1.129 255.255.255.252
 no shut

int s0/1
 enc ppp
 ip add 192.168.1.133 255.255.255.252
 no shut

! R2
int lo101
 ip add 192.168.1.101 255.255.255.252
int lo105
 ip add 192.168.1.105 255.255.255.252
int lo109
 ip add 192.168.1.109 255.255.255.252
int lo113
 ip add 192.168.1.113 255.255.255.252

int s0/0
 enc ppp
 ip add 192.168.1.130 255.255.255.252
 no shut

int f0/0
 ip add 192.168.1.161 255.255.255.252
 no shut

! R3
int lo5
 ip add 192.168.1.5 255.255.255.252
int lo192
 ip add 192.168.100.1 255.255.255.0

int s0/0
 enc ppp
 ip add 192.168.1.134 255.255.255.252
 no shut

int s0/1
 enc ppp
 ip add 10.1.1.3 255.255.255.248
 no shut

int f0/0
 ip add 192.168.1.162 255.255.255.252
 no shut

! R4
int lo4
 ip add 10.4.4.4 255.255.255.0

int s0/0
 enc ppp
 ip add 10.1.1.4 255.255.255.248
 no shut

! 2. Configure EIGRP on R1 ~ R3
!
! R1
router eig 1
 no au
 net 192.168.1.0 0.0.0.3
 net 192.168.1.128 0.0.0.3
 net 192.168.1.132 0.0.0.3

! R2
router eig 1
 no au
 net 192.168.1.96 0.0.0.31
 net 192.168.1.128 0.0.0.3
 net 192.168.1.160 0.0.0.3

int s0/0
 ip summary-address eigrp 1 192.168.1.96 255.255.255.224 5

int f0/0
 ip summary-address eigrp 1 192.168.1.96 255.255.255.224 5

! R3
router eigrp 1
 no au
 net 192.168.1.4 0.0.0.3
 net 192.168.1.132 0.0.0.3

! 3. Configure OSPF
!
! R3
router ospf 1 
 net 10.1.1.0 0.0.0.7 area 0
 default-information originate always
 
! R4
router ospf 1
 net 10.4.4.0 0.0.0.255 area 0
 net 10.1.1.0 0.0.0.7 area 0
 passive-interface lo4

! 4. Redistribution 
!
! R3
router eig 1
 redist ospf 1 metric 10000 100 255 1 1500

ip route 0.0.0.0 0.0.0.0 lo192

! R4
ip route 0.0.0.0 0.0.0.0 10.1.1.3

! 5. Verify connectivity 
end
tclsh

foreach addr {
 192.168.1.1
 192.168.1.129 
 192.168.1.130
 192.168.1.101
 192.168.1.105 
 192.168.1.105
 192.168.1.113
 192.168.1.161
 192.168.1.162
 192.168.1.133
 192.168.1.134
 10.1.1.3
 10.1.1.4
 10.4.4.4
} {
 ping $addr 
}

exit

conf t

!
! Running Configuration
!
! R1
interface Loopback1
 ip address 192.168.1.1 255.255.255.252
!
interface Serial0/0
 ip address 192.168.1.129 255.255.255.252
 encapsulation ppp
 clock rate 2000000
!         
interface Serial0/1
 ip address 192.168.1.133 255.255.255.252
 encapsulation ppp
 clock rate 2000000
!
router eigrp 1
 network 192.168.1.0 0.0.0.3
 network 192.168.1.128 0.0.0.3
 network 192.168.1.132 0.0.0.3
 no auto-summary

! R2
interface Loopback101
 ip address 192.168.1.101 255.255.255.252
!
interface Loopback105
 ip address 192.168.1.105 255.255.255.252
!
interface Loopback109
 ip address 192.168.1.109 255.255.255.252
!
interface Loopback113
 ip address 192.168.1.113 255.255.255.252
!
interface FastEthernet0/0
 ip address 192.168.1.161 255.255.255.252
 ip summary-address eigrp 1 192.168.1.96 255.255.255.224 5
 duplex auto
 speed auto
!
interface Serial0/0
 ip address 192.168.1.130 255.255.255.252
 encapsulation ppp
 ip summary-address eigrp 1 192.168.1.96 255.255.255.224 5
 clock rate 2000000
!
router eigrp 1
 network 192.168.1.96 0.0.0.31
 network 192.168.1.128 0.0.0.3
 network 192.168.1.160 0.0.0.3
 auto-summary

! R3
interface Loopback5
 ip address 192.168.1.5 255.255.255.252
!
interface Loopback192
 ip address 192.168.100.1 255.255.255.0
!
interface FastEthernet0/0
 ip address 192.168.1.162 255.255.255.252
 duplex auto
 speed auto
!
interface Serial0/0
 ip address 192.168.1.134 255.255.255.252
 encapsulation ppp
 clock rate 2000000
!
interface Serial0/1
 ip address 10.1.1.3 255.255.255.248
 encapsulation ppp
 clock rate 2000000
!
router eigrp 1
 redistribute ospf 1 metric 10000 100 255 1 1500
 network 192.168.1.4 0.0.0.3
 network 192.168.1.132 0.0.0.3
 no auto-summary
!
router ospf 1
 log-adjacency-changes
 network 10.1.1.0 0.0.0.7 area 0
 default-information originate always
!
ip default-network 192.168.100.0

! R4
interface Loopback4
 ip address 10.4.4.4 255.255.255.0
!
interface Serial0/0
 ip address 10.1.1.4 255.255.255.248
 encapsulation ppp
 clock rate 2000000
!         
interface Loopback4
 ip address 10.4.4.4 255.255.255.0
!
interface Serial0/0
 ip address 10.1.1.4 255.255.255.248
 encapsulation ppp
 clock rate 2000000
!         
router ospf 1
 log-adjacency-changes
 passive-interface Loopback4
 network 10.1.1.0 0.0.0.7 area 0
 network 10.4.4.0 0.0.0.3 area 0
 network 10.4.4.0 0.0.0.255 area 0


!############### EXAMPLES ############################################

!#####################################################################
! Chapter 4 Example Redistribute into RIP
!
! File: RTR.Ch4-ex.Redist.RIP-01
!
! Procedures:
!  1. Configure router loopbacks and addressing
!  2. Configure RIP
!  3. Configure OSPF
!  4. Redistribute OSPF into RIP
!  5. Verifying redistribution
!
! 1. Configure router loopbacks and addressing
!
! R1
int lo0
 ip add 172.14.1.1 255.255.255.0

int f0/0
 ip add 10.1.1.1 255.255.255.0
 no shut

! R2
int lo0
 ip add 192.168.1.1 255.255.255.0

int f0/0
 ip add 10.1.1.2 255.255.255.0
 no shut

! 2. Configure RIP
!
! R1
router rip
 ver 2
 no au
 net 10.0.0.0 

! R2
router rip
 ver 2
 no au
 net 10.0.0.0 
 net 192.168.1.0

! When use 192.160.0.0, the routing table on R1 no this route 
! Debug error message: 
!  RIP: build update entries - suppressing null update

! 3. Configure OSPF
!
router ospf 1
 net 172.14.0.0 0.0.255.255 area 0

! 4. Redistribute OSPF into RIP
!
router rip
 redist ospf 1 metric 3

! 5. Verifying redistribution
!  chk R2's metric value
do sh ip rou



!#####################################################################
! Chapter 4 Example Redistribute into OSPF
!
! File: RTR.Ch4-ex.Redist.OSPF-01
!
! Procedures:
!  1. Configure router loopbacks and addressing
!  2. Configure OSPF
!  3. Configure EIGRP
!  4. Redistribute EIGRP into OSPF
!  5. Set default metric
!  6. Verifying redistribution
!
!  1. Configure router loopbacks and addressing
!
! Same as RTR.Ch4-ex.Redist.RIP-01 Step 1

!  2. Configure OSPF
!
! R1
int f0/0
 ip ospf 1 area 0

! R2
router ospf 1
 net 192.168.1.0 0.0.0.255 area 0
 net 10.1.1.0 0.0.0.255 area 0

!  3. Configure EIGRP
!
router eigrp 100
 no au
 net 172.14.1.0 0.0.0.255

!  4. Redistribute EIGRP into OSPF
!
router ospf 1
 redist eig 100 subnets metric-type 1

!  5. Set default metric
!
router ospf 1
 red eig 100 metric 30 
! (default metric = 20) then add mmetric of the Etherlink

!  6. Verifying redistribution
!
do sh ip rou


!#####################################################################
! Chapter 4 Example Redistribute into EIGRP
!
! File: RTR.Ch4-ex.Redist.EIGRP-01
!
! Procedures:
!  1. Configure router loopbacks and addressing
!  2. Configure OSPF
!  3. Configure EIGRP
!  4. Redistribute OSPF into EIGRP
!  5. Verifying redistribution
!
! 1. Configure router loopbacks and addressing
!
! Same as RTR.Ch4-ex.Redist.RIP-01 Step 1

! 2. Configure OSPF
int lo0
 ip ospf 1 area 0

! 3. Configure EIGRP
!
! R1
router eig 100
 no au
 net 10.1.1.0 0.0.0.255

! R2
router eig 100
 no au
 net 10.1.1.0 0.0.0.255
 net 192.168.1.0 0.0.0.255

! 4. Redistribute OSPF into EIGRP
router eig 100
 red ospf 1 metric 100000 100 255 1 1500

! 5. Verifying redistribution
!
do sh ip rou


!#####################################################################
! Chapter 4 Example Route Redistribution with RIP & OSPF
!
! File: RTR.Ch4-ex.Redist.RIP&OSPF-01
!
! Procedures:
!  1. Configure router loopbacks and addressing
!  2. Configure RIPv2
!  3. Configure OSPF
!  4. Redistribute RIPv2 into OSPF 
!  6. Redistribute OSPF into RIPv2 with passive interface
!  7. Verifying redistribution
!
! 1. Configure router loopbacks and addressing
!
! R1
int lo1
 ip add 10.1.0.1 255.255.0.0
int lo2
 ip add 10.2.0.1 255.255.0.0
int lo3
 ip add 10.3.0.1 255.255.0.0

int s0/0
 enc ppp
 ip add 10.0.0.1 255.255.255.252
 no shut

! R2
int s0/0
 enc ppp
 ip add 10.0.0.2 255.255.255.252
 no shut

int s0/1
 enc ppp
 ip add 10.0.0.9 255.255.255.252
 no shut

! R3
int lo8
 ip add 10.8.0.1 255.255.0.0
int lo9
 ip add 10.9.0.1 255.255.0.0
int lo10
 ip add 10.10.0.1 255.255.0.0
int lo11
 ip add 10.11.0.1 255.255.0.0

int s0/0
 enc ppp
 ip add 10.0.0.10 255.255.255.252
 no shut

! 2. Configure RIPv2
! 
! R1 & R2
router rip
 ver 2
 no au
 net 10.0.0.0

! 3. Configure OSPF
!
! R2
int s0/1
 ip ospf 1 area 0

! R3
router ospf 1
 net 10.8.0.0 0.3.255.255 area 0
 net 10.0.0.8 0.0.0.3 area 0

! 4. Redistribute RIPv2 into OSPF 
router rip
 red ospf 1 metric 5
 passive-interface s0/1
 
! 6. Redistribute OSPF into RIPv2 with passive interface
router ospf 1
 red rip subnets metric 300
 
! 7. Verifying redistribution
do sh ip rou


!#####################################################################
! Chapter 4 Example Route Redistribution with RIP & OSPF
!
! File: RTR.Ch4-ex.Redist.RIP&OSPF-02
!
! Procedures:
!  1. Configure router loopbacks and addressing
!  2. Configure RIPv2
!  3. Configure OSPF
!  4. Redistribute RIPv2 into OSPF 
!  5. Redistribute OSPF into RIPv2 with passive interface
!  6. Verifying redistribution
!
! 1. Configure router loopbacks and addressing
!
! R1
int lo0
 ip add 10.200.200.31 255.255.255.255

int f0/0
 ip add 10.3.1.1 255.255.255.248
 no shut

int s0/0
 enc fram
 ip add 172.31.3.1 255.255.255.248
 fram map ip 172.31.3.2 105
 fram map ip 172.31.3.3 105 bro
 no shut

! R2
int lo0
 ip add 10.200.200.32 255.255.255.255

int f0/0
 ip add 10.3.2.2 255.255.255.248
 no shut

int s0/0
 enc fram
 ip add 172.31.3.2 255.255.255.248
 fram map ip 172.31.3.1 205
 fram map ip 172.31.3.3 205 bro
 no shut

! R3
int lo0
 ip add 10.200.200.33 255.255.255.255

int f0/0
 ip add 10.3.1.3 255.255.255.248
 no shut

int s0/0
 enc ppp
 ip add 10.3.3.3 255.255.255.240
 no shut

! R4
int lo0
 ip add 10.200.200.34 255.255.255.255

int f0/0
 ip add 10.3.2.4 255.255.255.248
 no shut

int s0/0
 enc ppp
 ip add 10.3.3.4 255.255.255.240
 no shut

! R5
int lo0
 ip add 10.254.0.1 255.255.255.0

int s0/0
 enc fra ietf
 ip add 172.31.3.3 255.255.255.248
 fram map ip 172.31.3.1 501 bro
 fram map ip 172.31.3.2 502 bro
 no shut

! 2. Configure RIPv2
!
! R1 - R4
router rip
 ver 2
 no au
 net 10.0.0.0
 
! 3. Configure OSPF
!
! R1
router ospf 1
 net 172.31.3.0 0.0.0.7 area 0
 nei 172.31.3.2
 nei 172.31.3.3

! R2
router ospf 1
 net 172.31.3.0 0.0.0.7 area 0
 nei 172.31.3.1
 nei 172.31.3.3

! R5
router ospf 1
 net 172.31.3.0 0.0.0.7 area 0
 net 10.254.0.0 0.0.0.255 area 0
 nei 172.31.3.1
 nei 172.31.3.2

! 4. Redistribute RIPv2 into OSPF 
!
! R1 & R2
router ospf 1
 red rip met 10000 metric-type 1 subnets
 

! 5. Redistribute OSPF into RIPv2 with passive interface
!
! R1 & R2
router rip
 red ospf 1 metric 5

! ==> Suboptimal routes, ex. R2 with lo0 on R4
do sh ip rou 

! 6. Change AD to eleminate suboptimal with RIP
!
! R1 & R2
router ospf 1
 distance 125 0.0.0.0 255.255.255.255 64

access-list 64 per 10.3.1.0
access-list 64 per 10.3.2.0
access-list 64 per 10.3.3.0
access-list 64 per 10.200.200.31
access-list 64 per 10.200.200.32
access-list 64 per 10.200.200.33
access-list 64 per 10.200.200.34

! 7. Verifying redistribution
!
do sh ip rou


!#####################################################################
! Chapter 4 Example Route Map with Tag
!
! File: RTR.Ch4-ex.Route.Map.Tag-01
!
! Procedures:
!  1. Configure router loopbacks and addressing
!  2. Configure RIPv2
!  3. Configure EIGRP
!  4. Redistribute EIGRP into RIPv2 with tag
!  6. Redistribute RIPv2 into EIGRP with filter
!  7. Verifying redistribution
!
!
! 1. Configure router loopbacks and addressing
!
! R1
int lo0
 ip add 172.16.1.1 255.255.255.0

int f0/0
 ip add 172.16.12.1 255.255.255.0
 no shut

int f0/1 
 ip add 172.16.21.1 255.255.255.0
 no shut

int f1/0
 no switchport
 ip add 172.16.13.1 255.255.255.0
 no shut

int range f1/1 - 15
 shut

! R2
int lo0
 ip add 172.16.2.1 255.255.255.0

int f0/0
 ip add 172.16.12.2 255.255.255.0
 no shut

int f0/1
 ip add 172.16.21.2 255.255.255.0
 no shut

int f1/0
 no switchport
 ip add 172.16.23.2 255.255.255.0
 no shut

int range f1/1 - 15
 shut

! R3
int lo0
 ip add 10.0.0.1 255.255.255.0

int f0/0
 ip add 172.16.13.3 255.255.255.0
 speed 100
 duplex full
 no shut

int f0/1
 ip add 172.16.23.3 255.255.255.0
 speed 100
 duplex full
 no shut

! 2. Configure RIPv2
!
! R1 - R2
router rip
 ver 2
 no au
 net 172.16.0.0

! 3. Configure EIGRP
!
! R1
router eig 40
 no au
 net 172.16.13.0 0.0.0.255
 net 172.16.12.0 0.0.0.255

! R2
router eig 40
 no au
 net 172.16.23.0 0.0.0.255
 net 172.16.12.0 0.0.0.255

! R3
router eig 40
 no au
 net 172.16.23.0 0.0.0.255
 net 172.16.13.0 0.0.0.255
 net 10.0.0.0 0.0.0.255

! 4. Redistribute EIGRP into RIPv2 with tag
! 
! R1 & R2
router rip
 redist eigrp 40 metric 3 route-map INTO_RIP

route-map INTO_RIP deny 10
 match tag 20

route-map INTO_RIP permit 20
 set tag 40

! 6. Redistribute RIPv2 into EIGRP with filter
!
! R1 & R2
router eigrp 40
 redist rip metric 10000 100 255 1 1500 route-map INTO_EIGRP

route-map INTO_EIGRP deny 10
 match tag 40

route-map INTO_EIGRP permit 20
 set tag 20

! 7. Verifying redistribution
!
! R1
do sh ip rou 10.0.0.0 255.255.255.0

! R2 & R3
do sh ip rou 172.16.1.0 255.255.255.0


!#####################################################################
! Chapter 4 Example Redistribution Control with Diestribute List
!
! File: RTR.Ch4-ex.Redist.Control-01
!
! Procedures:
!  1. Configure router loopbacks and addressing
!  2. Configure RIPv2
!  3. Configure OSPF
!  4. Configure redistribution OSPF into RIP with distribute list
!  5. Configure redistribution RIP into OSPF with distribute list
!  6. Verifying redistribution
!
! 1. Configure router loopbacks and addressing
!
! R1
int lo1
 ip add 10.1.0.1 255.255.0.0
int lo2
 ip add 10.2.0.1 255.255.0.0
int lo3
 ip add 10.3.0.1 255.255.0.0

int s0/0
 enc ppp
 ip add 10.0.0.1 255.255.255.252
 no shut

int s0/1
 enc ppp
 ip add 10.0.0.5 255.255.255.252
 no shut

! R2
int s0/0
 enc ppp
 ip add 10.0.0.2 255.255.255.252
 no shut

int s0/1
 enc ppp
 ip add 10.0.0.9 255.255.255.252
 no shut

! R3
int lo8
 ip add 10.8.0.1 255.255.0.0
 ip ospf net point-to-point
int lo9
 ip add 10.9.0.1 255.255.0.0
 ip ospf net point-to-point
int lo10
 ip add 10.10.0.1 255.255.0.0
 ip ospf net point-to-point
int lo11
 ip add 10.11.0.1 255.255.0.0
 ip ospf net point-to-point

int s0/0
 enc ppp
 ip add 10.0.0.10 255.255.255.252
 no shut

int s0/1
 enc ppp
 ip add 10.0.0.14 255.255.255.252
 no shut

! R4
int s0/0
 enc ppp
 ip add 10.0.0.13 255.255.255.252
 no shut

int s0/1
 enc ppp
 ip add 10.0.0.6 255.255.255.252
 no shut

!  2. Configure RIPv2
!
! R1, R2 & R4
router rip 
 no au
 ver 2
 net 10.0.0.0

! R2
router rip
 passive s0/1

! R4
router rip
 passive s0/0

! 3. Configure OSPF
!
! R2 
router ospf 1
 net 10.0.0.8 0.0.0.3 area 0
 
! R3
router ospf 1
 net 10.0.0.8 0.0.0.3 area 0
 net 10.0.0.12 0.0.0.3 area 0
 net 10.8.0.0 0.0.255.255 area 0
 net 10.9.0.0 0.0.255.255 area 0
 net 10.10.0.0 0.0.255.255 area 0
 net 10.11.0.0 0.0.255.255 area 0
 passive-interface lo8
 passive-interface lo9
 passive-interface lo10
 passive-interface lo11

! R4
router ospf 1
 net 10.0.0.12 0.0.0.3 area 0

! 4. Configure redistribution OSPF into RIP with distribute list
!
! R2 & R4 --> filter outgoing updates from neighboring router
!             here is to accept the summary address
router rip
 red ospf 1 metric 3 
 distribute-list 3 out ospf 1

access-list 3 per 10.8.0.0 0.3.255.255

! 5. Configure redistribution RIP into OSPF with distribute list
!
! R2 & E4
router ospf 1
 red rip subnets
 distribute-list 2 out rip 

access-list 2 deny 10.8.0.0 0.3.255.255
access-list 2 permit any

! 6. Verifying redistribution
do sh ip rou


!#####################################################################
! Chapter 4 Example Redistribution with Prefix List
!
! File: RTR.Ch4-ex.Redist.Prefix.List-01
!
! Procedures:
!  1. Configure router loopbacks and addressing
!  2. Configure RIPv2
!  3. Configure OSPF
!  4. Configure redistribute with prefix list on R2
!  5. Verifying redistribution
!
!
! 1. Configure router loopbacks and addressing
!
! R1
int lo1
 ip add 10.1.0.1 255.255.255.0
int lo2
 ip add 10.2.0.1 255.255.255.0
int lo3
 ip add 10.3.0.1 255.255.255.0
int lo4
 ip add 10.4.0.1 255.255.255.0
int lo5
 ip add 10.5.0.1 255.255.255.0
int lo6
 ip add 10.6.0.1 255.255.255.0

int s0/0
 enc ppp
 ip add 10.0.12.1 255.255.255.252
 no shut

! R2
int s0/0
 enc ppp
 ip add 10.0.12.2 255.255.255.252
 no shut

int s0/1
 enc ppp
 ip add 10.0.23.2 255.255.255.252
 no shut

! R3
int lo8
 ip add 10.8.0.1 255.255.255.0
 ip ospf net point-to-point
int lo9
 ip add 10.9.0.1 255.255.255.0
 ip ospf net point-to-point
int lo10
 ip add 10.10.0.1 255.255.255.0
 ip ospf net point-to-point
int lo11
 ip add 10.11.0.1 255.255.255.0
 ip ospf net point-to-point
int lo12
 ip add 10.12.0.1 255.255.255.0
 ip ospf net point-to-point
int lo13
 ip add 10.13.0.1 255.255.255.0
 ip ospf net point-to-point

int s0/0
 enc ppp
 ip add 10.0.23.1 255.255.255.252
 no shut

! 2. Configure RIPv2
!
! R1 & R2
router rip 
 ver 2
 no au
 net 10.0.0.0

! R2
router rip
 passive s0/1

! 3. Configure OSPF
!
! R2
router ospf 1
 net 10.0.23.0 0.0.0.3 area 0

! R3
router ospf 1
 net 10.8.0.0 0.0.255.255 area 0
 net 10.9.0.0 0.0.255.255 area 0
 net 10.10.0.0 0.0.255.255 area 0
 net 10.11.0.0 0.0.255.255 area 0
 net 10.12.0.0 0.0.255.255 area 0
 net 10.13.0.0 0.0.255.255 area 0
 net 10.0.23.0 0.0.0.3 area 0
 passive lo8
 passive lo9
 passive lo10
 passive lo11
 passive lo12
 passive lo13

! 4. Configure redistribute with prefix list on R2
router ospf 1
 red rip route-map INTO_OSPF subnets

router rip
 red ospf 1 route-map INTO_RIP metric 5

route-map INTO_OSPF per 10
 match ip addr prefix-list PFX1

route-map INTO_RIP per 10
 match ip addr prefix-list PFX2

ip prefix-list PFX1 per 10.0.0.0/14 le 24
ip prefix-list PFX2 per 10.8.0.0/14 ge 24

! 5. Verifying redistribution
do sh ip rou


!#####################################################################
! Chapter 4 Example Redistribution Comprehensive Example
!
! File: RTR.Ch4-ex.Redist.Comprehensive-01
!
! Ref: https://learningnetwork.cisco.com/thread/35277
!
! Procedures:
!  1.	Verify the scenario: 
!    a. R1’s route to R3’s loopback interface; 
!    b. R1 traces to Lo1 – routing loop; 
!    c. check protocols on R1; 
!    d. check EIGRP topology on R1; 
!    e. display Lo1 route on R1; 
!  2. Identify specific routes with prefix lists
!  3. Configure route maps to set tags according to the prefix list
!  4.	Add the route map to the redistribute command
!  5.	Verify the configuration
!  6.	Display routing table changes and trace to key advertisements 
!     to verify operations: 
!    a. check route on R1; 
!    b. trace route on R1; 
!    c. display routing table on R1; 
!    d. check EIGRP topology on R1; 
!    e. display OSPF topology on R1; 
!    f. check prefix list traffic counts on R1; 
!    g. resetting OSPF process on R1; 
!    h. alternative configuration on R1 & R2 for all subnets
! 7.	Suboptimal issue & verify on R1 & R2: 
!    a. display R2’s routing table; 
!    b. reach R3’s external route via R1; 
!    c. display R1 & R2 routing table;
!  8.	Change AD on R1 & R2: 
!    a. changing AD of external OSPF on R2; 
!    b. check R2’s routing table; 
!    c. trace route to Lo1 on R2; 
!    d. changing AD on R1
!
! 0. Configure interface and IP addreses
!
! R1
int f0/0
 ip add 10.2.7.1 255.255.255.0
 no shut

int f0/1
 ip add 10.3.7.1 255.255.255.0
 no shut

int s0/0
 enc ppp
 ip add 192.168.2.1 255.255.255.0
 no shut

router ospf 1
 net 10.2.0.0 0.0.255.255 area 0
 redist eigrp 1 subnets metric 4

router eigrp 1
 no au
 net 10.3.7.0 0.0.0.255
 net 192.168.2.0 0.0.0.255
 redistribute ospf 1 metric 10000000 0 255 1 500 match external 1 external 2

! R2
int f0/0
 ip add 10.2.7.2 255.255.255.0
 no shut

int f0/1
 ip add 10.3.7.2 255.255.255.0
 no shut

int s0/0
 enc ppp
 ip add 192.168.1.1 255.255.255.0
 no shut

router ospf 1
 net 10.2.0.0 0.0.255.255 area 0
 redist eigrp 1 subnets metric 4

router eigrp 1
 no au
 net 10.3.7.0 0.0.0.255
 net 192.168.1.0 0.0.0.255
 redistribute ospf 1 metric 10000000 0 255 1 500 match external 1 external 2

! R3
int lo0
 ip add 192.168.253.1 255.255.255.0
 ip ospf net point-to-point
int lo1
 ip add 192.168.254.1 255.255.255.0
 ip ospf net point-to-point

int s0/0
 enc ppp
 ip addr 192.168.2.2 255.255.255.0
 no shut

int s0/1
 enc ppp
 ip add 192.168.1.2 255.255.255.0
 no shut

router eigrp 1
 no au
 net 192.168.1.0 0.0.0.255
 net 192.168.2.0 0.0.0.255
 redist connected

! 1.	Verify the scenario: 
!  a. R1’s route to R3’s loopback interface
!
do sh ip rou 192.168.254.0

! b. R1 traces to Lo1 – routing loop; 
trace 192.168.254.0 ttl 0 255

! c. check protocols on R1; 
do sh ip pro

! d. check EIGRP topology on R1; 
do sh ip eig topo 192.168.254.0

! e. display Lo1 route on R2; 
do sh ip route 192.168.254.0

! 2. Identify specific routes with prefix lists
!
! R1
ip prefix-list EXTERNAL seq 5 per 192.168.253.0/24 le 32
ip prefix-list EXTERNAL seq 10 per 192.168.254.0/24 le 32

! 3. Configure route maps to set tags according to the prefix list
!
! R1
route-map SETTAG per 10
 match ip add prefix EXTERNAL
 set tag 1000

route-map SETTAG per 20

route-map MATCHTAG deny 10
 match tag 1000

route-map MATCHTAG per 20

! 4.	Add the route map to the redistribute command
!
! R1
router ospf 1
 red eig 1 metric 4 subnets route-map SETTAG

router eig 1
 red ospf 1 metric 100 100 125 125 1500 route-map MATCHTAG

! 5.	Verify the configuration
!
! R2
ip prefix EXTERNAL seq 5 per 192.168.253.0/24 le 32
ip prefix EXTERNAL seq 10 per 192.168.254.0/24 le 32

route-map SETTAG per 10
 match ip addr prefix EXTERNAL
 set tag 1000

route-map SETTAG per 20

route-map MATCHTAG deny 10
 match tag 1000

route-map MATCHTAG per 20

router ospf 1
 red eig 1 metric 4 subnets route-map SETTAG

router eig 1
 red ospf 1 metric 10000000 0 255 1 500 match external 1 external 2 route-map MATCHTAG

! 6.	Display routing table changes and trace to key advertisements 
!    to verify operations: 
!  a. check route on R1; 
!  b. trace route on R1; 
!  c. display routing table on R1; 
!  d. check EIGRP topology on R1; 
!  e. display OSPF topology on R1; 
!  f. check prefix list traffic counts on R1; 
!  g. resetting OSPF process on R1; 
do sh ip rou 192.168.254.0

trace 192.168.254.1

do sh ip rou | s 254

do sh ip eig topo 192.168.254.0

do sh ip ospf database external 192.168.254.0

do sh ip prefix-list detail EXTERNAL

do clear ip ospf process
do sh ip prefix-list detail EXTERNAL

! alternative configuration on R1 & R2 for all subnets
!
! R1 & R2
route-map TAGS deny 10
 match tag 1000

route-map TAGS per 20
 set tag 1000

router ospf 1
 red eig 1 metric 4 route-map TAGS

! R1
router eig 1
 red ospf 1 metric 100 100 125 125 1500 route-map TAGS

! R2
router eig 1
 red ospf 1 metric 10000000 0 255 1 800 route-map TAGS

! 7.	Suboptimal issue & verify on R1 & R2: 
!
! a. display R2’s routing table; 
do sh ip rou 192.168.254.0

! b. reach R3’s external route via R2;
trace 192.168.254.1

! c. display R1 & R2 routing table;
do sh ip rou | s 254

! 8.	Change AD on R1 & R2: 
!  a. changing AD of external OSPF on R2; 
de deb ip routing

router ospf 1
 distance ospf external 171

! b. check R2’s routing table; 
do sh ip route | s 254

! c. trace route to Lo1 on R2;
do tarce 192.168.254.1

! d. changing AD on R1
router ospf 1
 distance ospf external 171
 
do tarce 192.168.254.1


!
! Running Configuration
!
! R1
interface FastEthernet0/0
 ip address 10.2.7.1 255.255.255.0
 duplex auto
 speed auto
!
interface Serial0/0
 ip address 192.168.2.1 255.255.255.0
 encapsulation ppp
 clock rate 2000000
!
interface FastEthernet0/1
 ip address 10.3.7.1 255.255.255.0
 duplex auto
 speed auto
!
router eigrp 1
 redistribute ospf 1 metric 100 100 125 125 1500 match external 1 external 2 route-map MATCHTAG
 network 10.3.7.0 0.0.0.255
 network 192.168.2.0
 no auto-summary
!
router ospf 1
 log-adjacency-changes
 redistribute eigrp 1 metric 4 subnets route-map SETTAG
 network 10.2.0.0 0.0.255.255 area 0
 distance ospf external 171
!
ip prefix-list EXTERNAL seq 5 permit 192.168.253.0/24 le 32
ip prefix-list EXTERNAL seq 10 permit 192.168.254.0/24 le 32
!
route-map MATCHTAG deny 10
 match tag 1000
!
route-map MATCHTAG permit 20
!         
route-map SETTAG permit 10
 match ip address prefix-list EXTERNAL
 set tag 1000
!
route-map SETTAG permit 20

! R2
interface FastEthernet0/0
 ip address 10.2.7.2 255.255.255.0
 duplex auto
 speed auto
!
interface Serial0/0
 ip address 192.168.1.1 255.255.255.0
 encapsulation ppp
 clock rate 2000000
!
interface FastEthernet0/1
 ip address 10.3.7.2 255.255.255.0
 duplex auto
 speed auto
!
router eigrp 1
 redistribute ospf 1 metric 10000000 0 255 1 500 match external 1 external 2 route-map MATCHTAG
 network 10.3.7.0 0.0.0.255
 network 192.168.1.0
 no auto-summary
!
router ospf 1
 log-adjacency-changes
 redistribute eigrp 1 metric 4 subnets route-map SETTAG
 network 10.2.0.0 0.0.255.255 area 0
 distance ospf external 171
!
ip prefix-list EXTERNAL seq 5 permit 192.168.253.0/24 le 32
ip prefix-list EXTERNAL seq 10 permit 192.168.254.0/24 le 32
!
route-map MATCHTAG deny 10
 match tag 1000
!
route-map MATCHTAG permit 20
!         
route-map SETTAG permit 10
 match ip address prefix-list EXTERNAL
 set tag 1000
!
route-map SETTAG permit 20

! R3
interface Serial0/0
 ip address 192.168.2.2 255.255.255.0
 encapsulation ppp
 clock rate 2000000
!
interface Serial0/1
 ip address 192.168.1.2 255.255.255.0
 encapsulation ppp
 clock rate 2000000
!
router eigrp 1
 redistribute connected
 network 192.168.1.0
 network 192.168.2.0
 no auto-summary
