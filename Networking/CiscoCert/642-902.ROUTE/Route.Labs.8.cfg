
! #####################################################################
! Chapter 8 Lab8-1, Configuring OSPF for IPv6
!
! File: RTR.Lab.8-1.Configing.OSPF.for.IPv6
!
! 1. Put router and switches into default
! 2. Configure the network as show in diagram
! 3. Config static IPv6 addresses
!   a. Configure two serial links with IPv6 adddresses
!   b. verify local subnet connectivity
! 4. Config link-local addresses on link between R1 & R2
!   a. display IPv6 related properties of the router 
!      interface
!   b. change local-link addresses
!   c. verify link-local address on the otehr side
!   d. verify link-local address
! 5. Config EUI-64 addresses on link for R2 & R3
!   a. configure IPv6 EUI-64 
!   b. display IPv6 address on the interfaces
! 6. Enable IPv6 routing and CEF
!   a. Configure two serial links with IPv6 adddresses
!   b. verify local subnet connectivity
! 7. Config OSPFv3 
!   a. add all interfces into OSPF process 1, area 0
!   b. verify OSPFv3 neighbors
!   c. verify routing table
!   d. verify per-inetrface OSPF behavior
!   e. verify fully connectivity with Tcl
!
!
! 1. Preepare routers for the lab
!    put swith into manufacture defualt
!
! 2. Configure hostname and loopback interfaces
!
!   Using "no" verson to erase wrong netered ipv6 addresses

! R1
hostname R1

int lo0
ip addr 10.1.1.1 255.255.255.0
ipv6 addr FEC0::1:1/112

! R2
hostname R2

int lo0
ip addr 10.1.2.1 255.255.255.0
ipv6 addr FEC0::2:1/112

! R3
hostname R3

int lo0
ip addr 10.1.3.1 255.255.255.0
ipv6 addr FEC0::3:1/112


! 3. Configure static IPv6 address
!   a. Configure two serial links with IPv6 adddresses
!   b. verify local subnet connectivity
!

! a. R1
int s0/0
ipv6 addre FEC0::12:1/112
clockrate 64000
bandwidth 64
no shut
exit

int s0/1
ipv6 addre FEC0::13:1/112
bandwidth 64    !! DON'T FORGET
no shut
exit

! a. R2
int s0/0
ipv6 addre FEC0::12:2/112
bandwidth 64    !! DON'T FORGET
no shut
exit

! a. R3
int s0/0
ipv6 addre FEC0::13:3/112
clockrate 64000
bandwidth 64
no shut
exit


! b. R1
do ping FEC0::12:2

do ping FEC0::13:3

! b. R2 
do ping FEC0::12:1

! b. R3
do ping FEC0::13:1

! 4. chnage link-local address on an interface
!   a. display IPv6 related properties of the router 
!      interface
!   b. change local-link addresses
!   c. verify link-local address on the otehr side
!   d. verify link-local address
!
! a. R1
do sh ipv6 int s0/0

! a. R2
do sh ipv6 int s0/0

! b. R1
int s0/0
ipv6 addr FE80::1 link-local
exit

! b. R2 
int s0/0
ipv6 addr FE80::2 link-local
exit

! c. R1
do ping FE80::2

! c. R2
do ping FE80::1

! d. R1
do sh ipv6 int s0/0

! d. R2
do sh ipv6 int s0/0

!
! 5. configure EUI-64 address
!   a. configure IPv6 EUI-64 
!   b. display IPv6 address on the interfaces
!
! a. R2
int f0/0
ipv6 addr FEC0:23::/64 eui-64
no shut
exit

! a. R3
int f0/0
ipv6 addr FEC0:23::/64 eui-64
no shut 
exit

! b. R2
do sh ipv6 int f0/0

do sh ipv6 int bri
! Highlight: FEC0:23::218:B9FF:FE92:28D8

! b. R3
do sh ipv6 int bri
! highlight: FEC0:23::218:B9FF:FECD:BEF0

! b. R2 
do pi FEC0:23::218:B9FF:FECD:BEF0

! b. R3
do pi FEC0:23::218:B9FE92:28D8
 
!
! 6. Enable IPv6 routing and CEF
! 
! R1, R2, & R3
ipv6 unicast-routing
ipv6 cef

!
! 7. Congiure OSPFv3
!   a. add all interfces into OSPF process 1, area 0
!   b. verify OSPFv3 neighbors
!   c. verify routing table
!   d. verify per-inetrface OSPF behavior
!   e. verify fully connectivity with Tcl
!
! a. R1
int lo0
ipv ospf 1 area 0
int s1/0
ipv ospf 1 area 0
int s1/1
ipv ospf 1 area 0
exit

! a. R2 & R3
int lo0
ipv ospf 1 area 0
int s1/0
ipv ospf 1 area 0
int f0/0
ipv ospf 1 area 0
exit

! b. R1, R2, & R3
do sh ipv ospf nei

! c. R1, R2, & R3
do sh ipv rout

! d. R1, R2, & R3
do sh ipv ospf int

! e. 

tclsh

foreach address {
  FEC0::1:1
  FEC0::2:1
  FEC0::3:1
  FEC0::12:1
  FEC0::12:2
  FEC0::13:1
  FEC0::13:3
  FEC0:23::
  FEC0:23::
} {
  ping $address
}

! e. R1
tclsh 

foreach address {
  FEC0::1:1
  FEC0::2:1
  FEC0::3:1
  FEC0::12:1
  FEC0::12:2
  FEC0::13:1
  FEC0::13:3
  FEC0:23::C205:19FF:FE5C:0
  FEC0:23::C206:19FF:FE5C:0
} {
  ping $address
}

exit

!
! Chanllenge: Summarize OSPFv3 areas
!
! R2
int lo100
ipv add fec0:500::100:1/112
ipv ospf 1 area 500

int lo200
ipv add fec0:500::200:1/112
ipv ospf 1 area 500
ex

ipv6 router ospf 1
area range ?
exit

!
! Running Coonfiguration
!
! R1


!
! R2


!
! R3





! #####################################################################
! Chapter 8 lab 8-2 using manual IPv6 tunnels with EIGRP for IPv6
!
! File: RTR.Lab.8-2.Using.Manual.IPv6 Tunnels.with EIGRP.for.IPv6
! 
! 1. Set to the default and basic configuration
! 2. Configuring loopbacks and physical interfaces
! 3. Configure EIGRP IPv4
! 4. Configure a mnaul IPv6 tunnel
!   a. manually create tunnel
!   b. verify tunnel
! 5. Configure EIGRP for IPv6 over a tunnel
!   a. enable IPv6 routing
!   b. verify configuration with eigrp neighbor
!   c. enable IPv6-EIGRP for process 100
!   d. verify configuration with eigrp neighbor
!   e. verify with ping
!   f. verify connectivity with Tcl
!
!
! 1. Set to the default and basic configuration
! 2. Configuring loopbacks and physical interfaces
! 
! R1
int lo0
ip addr 10.1.1.1 255.255.255.0
ipv6 addr FEC0::1:1/112

int s0/0
ip addr 172.16.12.1 255.255.255.0
clock rate 64000
bandw 64
no shut
exit

! R2
int lo0
ip addr 10.1.2.1 255.255.255.0

int s0/0
ip addr 172.16.12.2 255.255.255.0
bandw 64
no shut

int s0/1
ip addr 172.16.23.2 255.255.255.0
clock rate 64000
bandw 64
no shut
exit

! R3
int lo0
ip addr 10.1.3.1 255.255.255.0
ipv6 addr FEC0::3:1/112

int s0/1
ip addr 172.16.23.3 255.255.255.0
band 64
no shut
exit

! 3. Configure EIGRP IPv4
!
! R1, R2, & R3
router eigrp 1
no auto-summ
net 10.0.0.0
net 172.16.0.0
exit


! 4. Configure a mnaul IPv6 tunnel
!   a. manually create tunnel
!   b. verify tunnel
!
! a. R1
int tun0
tun mode ipv6ip
tun sour s0/0
tun dest 172.16.23.3
ipv6 addr FEC0::13:1/112
exit

! a. R3
int tun0
tun mode ipv6ip
tun sour s0/1
tun dest 172.16.12.1
ipv6 addr FEC0::13:3/112
exit

! b. R1
do ping FEC0::13:3

! b. R3
do ping FEC0::13:1
!

! 5. Configure EIGRP for IPv6 over a tunnel
!   a. enable IPv6 routing
!   b. verify configuration
!   c. enable IPv6-EIGRP for process 100
!   d. verify configuration
!   e. verify with ping
!   f. verify connectivity with Tcl
!
! a. R1
ipv6 unicast-routing
int lo0
ipv6 eigrp 100
int tun0
ipv6 eigrp 100

! a. R3
ipv6 unicast-rou
int lo0
ipv6 eigrp 100
int tun0
ipv6 eigrp 100

! b. R1
do sh ipv6 eigrp nei

! c. R1 & R3
ipv6 router eigrp 100
no shut
exit

! d. R1
do sh eigrp nei

! e. R1
do pi FEC0::3:1

! e. R3
do pi FEC0::1:1

! f. R1 & R3
tclsh

foreach address {
  10.1.1.1
  10.1.2.1
  10.1.3.1
  176.16.12.1
  172.16.12.2
  172.16.23.2
  172.16.23.3
  FEC0::1:1
  FEC0::3:1
  FEC0::13:1
  FEC0::13:3
} {
  ping $address
}

exit

!
! Running Coonfiguration
!
! R1
ipv6 unicast-routing
!
interface Loopback0
 ip address 10.1.1.1 255.255.255.0
 ipv6 address FEC0::1:1/112
 ipv6 eigrp 100
!
interface Tunnel13
 no ip address
 ipv6 address FEC0::13:1/112
 ipv6 eigrp 100
 tunnel source Serial0/0
 tunnel destination 172.16.23.3
 tunnel mode ipv6ip
!
interface Serial0/0
 bandwidth 8000
 ip address 172.16.12.1 255.255.255.0
 encapsulation ppp
 clock rate 8000000
!
router eigrp 1
 network 10.1.1.0 0.0.0.255
 network 172.16.12.0 0.0.0.255
 no auto-summary
!
ipv6 router eigrp 100
 no shutdown

!
! R2
interface Loopback0
 ip address 10.1.2.1 255.255.255.0
!
interface Serial0/0
 bandwidth 8000
 ip address 172.16.12.2 255.255.255.0
 encapsulation ppp
 clock rate 2000000
!
interface Serial0/1
 bandwidth 8000
 ip address 172.16.23.2 255.255.255.0
 encapsulation ppp
 clock rate 8000000
!
router eigrp 1
 network 10.1.2.0 0.0.0.255
 network 172.16.12.0 0.0.0.255
 network 172.16.23.0 0.0.0.255
 no auto-summary

!
! R3
ipv6 unicast-routing
!
interface Loopback0
 ip address 10.1.3.1 255.255.255.0
 ipv6 address FEC0::3:1/112
 ipv6 eigrp 100
!
interface Tunnel13
 no ip address
 ipv6 address FEC0::13:3/112
 ipv6 eigrp 100
 tunnel source Serial0/0
 tunnel destination 172.16.12.1
 tunnel mode ipv6ip
!
interface Serial0/0
 bandwidth 8000
 ip address 172.16.23.3 255.255.255.0
 encapsulation ppp
 clock rate 2000000
!
router eigrp 1
 network 10.1.3.0 0.0.0.255
 network 172.16.23.0 0.0.0.255
 no auto-summary
!
ipv6 router eigrp 100
 no shutdown


! #####################################################################
! Chapter 8 lab 8-3 Configuring 6to4 tunnels
!
! File: RTR.Lab.8-3.Configuring.6to4.Tunnels
!
! 1. Configure router with basic settings
! 2. Configure loopbacks and physical interfaces
!   a. condifure loopback interface with IPv4 & IPv6
!   b. verify local subnet
! 3. Configure EIGRP with 1
! 4. configure a maual IPv6 6to4 tunnel
!   a. add loopback interfaces on R1 & R3
!   b. configure 6to4 tunnel
!   c. set tunnel mode
!   d. enable ipv6 routing
!   e. setting 6to4 tunnel on R3
!   f. verify configuration with ping
! 5. configure static IPv6 toutes
!   a. static route with next-hop IPv6 addr
!   b. verify IPv6 ststic route
!   c. pinging R1 & R3 each other
!   d. using Tcl to verify
!   e. explain
!
!
! 1. Configure router with basic settings
!
! 2. Configure loopbacks and physical interfaces
!   a. condifure loopback interface with IPv4 & IPv6
!   b. verify local subnet
!
! a. R1
int lo0
ip add 10.1.1.1 255.255.255.0
ipv6 add fec0::1:1/112
int s0/0
ip add 172.16.12.1 255.255.255.0
clock 64000
band 64
no shut

! a. R2
int lo0
ip add 10.1.2.1 255.255.255.0
int s0/0
ip add 172.16.12.2 255.255.255.0
ban 64
no shut
int s0/1
ip add 172.16.23.2 255.255.255.0
clock 64000
band 64
no shut

! a. R3
int lo0
ip add 10.1.3.1 255.255.255.0
ipv6 add fec0::3:1/112
int s0/0
ip add 172.16.23.3 255.255.255.0
band 64
no shut

! b. R1, R2, & R3
do pi 10.1.1.1          ! R1
do pi fec0::1:1         ! R1
do pi 172.16.12.1       ! R2
do pi 10.1.2.1          ! R2
do pi 172.16.12.2       ! R2
do pi 172.16.23.2       ! R2
do pi 10.1.3.1          ! R3
do pi fec0::3:1         ! R3

! 3. Configure EIGRP
!
! R1, R2, & R3
router eigrp 1
no auto
net 10.0.0.0
net 172.16.0.0

! 4. configure a maual IPv6 6to4 tunnel
!   a. add loopback interfaces on R1 & R3
!   b. configure 6to4 tunnel
!   c. set tunnel mode
!   d. enable ipv6 routing
!   e. setting 6to4 tunnel on R3
!   f. verify configuration

! a. R1
int lo11
ipv6 add 2002:ac10:0c01:11::1/64
int lo12
ipv6 add 2002:ac10:0c01:12::1/64

! a. R3
int lo31
ipv6 add 2002:ac10:0c01:31::1/64
int lo32
ipv6 add 2002:ac10:0c01:32::1/64

! b. R1
int tun0

! c. R1 
tun mode ipv6ip 6to4
ipv6 add 2002:ac10:0c01:1::1/64
tun sou s0/0
exit


! d. R1
ipv6 uni
ipv6 rou 2002::/16 tun0

! e. R3
int tun0
tun mode ipv6ip 6to4
ip addr 2002:ac10:1703:1::3/64
tun sou s0/0
exit
ipv un
ipv rou 2002::/16 tun0

! f. R1
do pi 2002:ac10:1703:1::3

do pi 2002:ac10:1703:31::1

do pi 2002:ac10:1703:32::1

! f. R3
do pi 2002:ac10:c01:1::1

do pi 2002:ac10:c01:11::1

do pi 2002:ac10:c01:12::1


! 5. configure static IPv6 toutes
!   a. static route with next-hop IPv6 addr
!   b. verify IPv6 ststic route
!   c. pinging R1 & R3 each other
!   d. using Tcl to verify
!   e. explain

! a. R1
ipv6 rou fec0::3:0/112 2002:ac10:1730::3

! a. R3
ipv6 rou fec0::1:0/112 2002:ac10:c01::1

! b. R1
do sh ipv6 route

! b. R3
do sh ipv6 route

! c. R1
do pi fec0::3:1

! c. R2
do pi fec0::1:1

! d. 
foreach addr {
  10.1.1.1
  10.1.2.1
  10.1.3.1
  172.16.12.1
  172.16.12.2
  172.16.23.2
  172.16.23.3
  fec0::1:1
  fec0::3:1
  2002:ac10:c01:1::1
  2002:ac10:1703:1::3
  2002:ac10:1703:31::1
  2002:ac10:1703:32::1
  2002:ac10:c01:11::1
  2002:ac10:c01:12::1
} {
  ping $addr
}

exit

!
! Running Coonfiguration
!
! R1
ipv6 unicast-routing
!
multilink bundle-name authenticated
!
interface Loopback0
 ip address 10.1.1.1 255.255.255.0
 ipv6 address FEC0::1:1/112
!
interface Loopback11
 no ip address
 ipv6 address 2002:AC10:C01:11::1/64
!
interface Loopback12
 no ip address
 ipv6 address 2002:AC10:C01:12::1/64
!
interface Tunnel0
 no ip address
 no ip redirects
 ipv6 address 2002:AC10:C01:1::1/64
 tunnel source Serial0/0
 tunnel mode ipv6ip 6to4
!
interface Serial0/0
 bandwidth 8000
 ip address 172.16.12.1 255.255.255.0
 encapsulation ppp
 clock rate 8000000
!
router eigrp 1
 network 10.0.0.0
 network 172.16.0.0
 no auto-summary
!
ipv6 route 2002::/16 Tunnel0
ipv6 route FEC0::3:0/112 2002:AC10:C01:1::3

!
! R2
interface Loopback0
 ip address 10.1.2.1 255.255.255.0
!
interface Serial0/0
 bandwidth 8000
 ip address 172.16.12.2 255.255.255.0
 encapsulation ppp
 clock rate 2000000
!
interface Serial0/1
 bandwidth 8000
 ip address 172.16.23.2 255.255.255.0
 encapsulation ppp
 clock rate 8000000
!
router eigrp 1
 network 10.0.0.0
 network 172.16.0.0
 no auto-summary

! 
! R3
ipv6 unicast-routing
!
interface Loopback0
 ip address 10.1.3.1 255.255.255.0
 ipv6 address FEC0::3:1/112
!
interface Loopback31
 no ip address
 ipv6 address 2002:AC10:1703:31::1/64
!
interface Loopback32
 no ip address
 ipv6 address 2002:AC10:1703:32::1/64
!
interface Tunnel0
 no ip address
 no ip redirects
 ipv6 address 2002:AC10:1703:1::3/64
 tunnel source Serial0/0
 tunnel mode ipv6ip 6to4
!
interface Serial0/0
 bandwidth 8000
 ip address 172.16.23.3 255.255.255.0
 encapsulation ppp
 clock rate 2000000
!
router eigrp 1
 network 10.0.0.0
 network 172.16.0.0
 auto-summary
!
ipv6 route 2002::/16 Tunnel0
ipv6 route FEC0::1:0/112 2002:AC10:C01:1::1


! #####################################################################
! Chapter 8 Lab 8-4 IPv6 Challenge Lab
!
! File: RTR.Lab.8-4.IPv6.Challenge
!
! Procedure:
! 1. Configure router with basic settings
! 2. Use EUI-64 address on the link between R3 & R4
! 3. Config EIGRP AS 1 on R1, R2,& R3 to route all IPv4 networks
! 4. Disable EIGRP automatic summarization
! 5. Configure a manual IPv6 tunnel between R1 & R3
! 6. Include all IPv6 network in OSPF area 0 on R1, R3, & R4
! 7. Manually configure a router ID of 172.16.4.1 on R4
! 8. remove the OSPFv3 config commands from R1, R3, and R4 and
!     config RIPng to run on these routers using RIP1 as the
!     process name
!
! 1. Configure router with basic settings
!
! R1
ipv uni

int s0/0
 enc ppp
 ip add 172.16.12.1 255.255.255.0
 no shut

int lo0
 ipv add fec0::1:1/112

! R2
int s0/0
 enc ppp
 ip add 172.16.12.2 255.255.255.0
 no shut

int s0/1
 enc ppp
 ip add 172.16.23.2 255.255.255.0
 no shut

! R3
ipv uni

int s0/0
 enc ppp
 ip add 172.16.23.3 255.255.255.0
 no shut

int lo0
 ipv add fec0::3:1/112

! R4
int lo0
 ipv add fec0::4:1/112


! 2. Use EUI-64 address on the link between R3 & R4
!
! R3 
ipv uni

int s0/1
 enc ppp
 ipv add fec0:34::/64 eui
 no shut

! R4 
ipv uni

int s0/0
 enc ppp
 ipv add fec0:34::/64 eui
 no shut

! 3. Config EIGRP AS 1 on R1, R2,& R3 to route all IPv4 networks
!
! R1
router eig 1
 net 172.16.12.0 0.0.0.255

! R2
router eig 1
 net 172.16.12.0 0.0.0.255
 net 172.16.23.0 0.0.0.255

! R3
router eig 1
 net 172.16.23.0 0.0.0.255

! 4. Disable EIGRP automatic summarization
!
! R1, R2, R3
router eig 1
 no au

! 5. Configure a manual IPv6 tunnel between R1 & R3
!
! R1
int tun13
 ipv add fec0::13:1/112
 tun so s0/0
 tun des 172.16.23.3
 tun mod ipv6ip

! R3
int tun13
 ipv add fec0::13:3/112
 tun so s0/0
 tun des 172.16.12.1
 tun mod ipv6ip

! 6. Include all IPv6 network in OSPF area 0 on R1, R3, & R4
!
! R1
int lo0
 ipv ospf 1 ar 0

int tun13
 ipv osp 1 ar 0

! R3
int lo0
 ipv osp 1 ar 0

int s0/1
 ipv osp 1 ar 0

int tun13
 ipv osp 1 ar 0

! R4
int lo0
 ipv osp 1 ar 0

int s0/0
 ipv osp 1 ar 0

! 7. Manually configure a router ID of 172.16.4.1 on R4
!
! R4
ipv router osp 1
 router-id 172.16.4.1

! 8. remove the OSPFv3 config commands from R1, R3, and R4 and
!     config RIPng to run on these routers using RIP1 as the
!     process name
!
! R1
no ipv router osp 1

int lo0
 no ipv osp 1 ar 0
 ipv rip RIPng en

int tun13
 no ipv osp 1 ar 0
 ipv rip RIPng en

! R3
no ipv router osp 1

int lo0
 no ipv osp 1 ar 0
 ipv rip RIPng en

int s0/1
 no ipv osp 1 ar 0
 ipv rip RIPng en

int tun13
 no ipv osp 1 ar 0
 ipv rip RIPng en

! R4
no ipv router osp 1

int lo0
 no ipv osp 1 ar 0
 ipv rip RIPng en

int s0/0
 no ipv osp 1 ar 0
 ipv rip RIPng en

!
! Running Configuration for OSPFv3
!
! R1
ipv6 unicast-routing
!
interface Loopback0
 no ip address
 ipv6 address FEC0::1:1/112
 ipv6 ospf 1 area 0
!
interface Tunnel13
 no ip address
 ipv6 address FEC0::13:1/112
 ipv6 ospf 1 area 0
 tunnel source Serial0/0
 tunnel destination 172.16.23.3
 tunnel mode ipv6ip
!
interface Serial0/0
 ip address 172.16.12.1 255.255.255.0
 encapsulation ppp
 clock rate 2000000
!
router eigrp 1
 network 172.16.12.0 0.0.0.255
 no auto-summary

!
! R2
interface Serial0/0
 ip address 172.16.12.2 255.255.255.0
 encapsulation ppp
 clock rate 2000000
!
interface Serial0/1
 ip address 172.16.23.2 255.255.255.0
 encapsulation ppp
 clock rate 2000000
!
router eigrp 1
 network 172.16.12.0 0.0.0.255
 network 172.16.23.0 0.0.0.255

!
! R3
ipv6 unicast-routing
!
interface Loopback0
 no ip address
 ipv6 address FEC0::3:1/112
 ipv6 ospf 1 area 0
!
interface Tunnel13
 no ip address
 ipv6 address FEC0::13:3/112
 ipv6 ospf 1 area 0
 tunnel source Serial0/0
 tunnel destination 172.16.12.1
 tunnel mode ipv6ip
!
interface Serial0/0
 ip address 172.16.23.3 255.255.255.0
 encapsulation ppp
 clock rate 2000000
!
interface Serial0/1
 no ip address
 encapsulation ppp
 ipv6 address FEC0:34::/64 eui-64
 ipv6 ospf 1 area 0
 clock rate 2000000
!
router eigrp 1
 network 172.16.23.0 0.0.0.255
 no auto-summary

!
! R4
ipv6 unicast-routing
!
interface Loopback0
 no ip address
 ipv6 address FEC0::4:1/112
 ipv6 ospf 1 area 0
!
interface Serial0/0
 no ip address
 encapsulation ppp
 ipv6 address FEC0:34::/64 eui-64
 ipv6 ospf 1 area 0
 clock rate 2000000
!
interface Serial0/1
 no ip address
 clock rate 2000000



!
! Running Configuration for RIPng
!
! R1
ipv6 unicast-routing
!
interface Loopback0
 no ip address
 ipv6 address FEC0::1:1/112
 ipv6 rip RIPng enable
!
interface Tunnel13
 no ip address
 ipv6 address FEC0::13:1/112
 ipv6 rip RIPng enable
 tunnel source Serial0/0
 tunnel destination 172.16.23.3
 tunnel mode ipv6ip
!
interface Serial0/0
 ip address 172.16.12.1 255.255.255.0
 encapsulation ppp
 clock rate 2000000
!
interface Serial0/1
 no ip address
 shutdown
 clock rate 2000000
!
router eigrp 1
 network 172.16.12.0 0.0.0.255
 no auto-summary
!
ipv6 router ospf 1
 log-adjacency-changes
!
ipv6 router rip RIPng

!
! R2
interface Serial0/0
 ip address 172.16.12.2 255.255.255.0
 encapsulation ppp
 clock rate 2000000
!
interface Serial0/1
 ip address 172.16.23.2 255.255.255.0
 encapsulation ppp
 clock rate 2000000
!
router eigrp 1
 network 172.16.12.0 0.0.0.255
 network 172.16.23.0 0.0.0.255
 no auto-summary

!
! R3
ipv6 unicast-routing
!
interface Loopback0
 no ip address
 ipv6 address FEC0::3:1/112
 ipv6 rip RIPng enable
!
interface Tunnel13
 no ip address
 ipv6 address FEC0::13:3/112
 ipv6 rip RIPng enable
 tunnel source Serial0/0
 tunnel destination 172.16.12.1
 tunnel mode ipv6ip
!
interface Serial0/0
 ip address 172.16.23.3 255.255.255.0
 encapsulation ppp
 clock rate 2000000
!
interface Serial0/1
 no ip address
 encapsulation ppp
 ipv6 address FEC0:34::/64 eui-64
 ipv6 rip RIPng enable
 clock rate 2000000
!
router eigrp 1
 network 172.16.23.0 0.0.0.255
 no auto-summary

!
! R4
ipv6 unicast-routing
!
interface Loopback0
 no ip address
 ipv6 address FEC0::4:1/112
 ipv6 rip RIPng enable
!
interface Serial0/0
 no ip address
 encapsulation ppp
 ipv6 address FEC0:34::/64 eui-64
 ipv6 rip RIPng enable
 clock rate 2000000
!
interface Serial0/1
 no ip address
 clock rate 2000000

!#####################################################################
! Chapter 8 Lab 8-5 IPv6 Troubleshooting Lab
!
! File: RTR.Lab.8-5.IPv6.Troubleshooting
!
! Requirements:
! 1. Use the IPv6 addressing scheme shwon in the diagram
! 2. All interfaces must be in OSPFv3 area0
! 3. The router IDs are manually configured with the initial config
! 4. Do not use ststic routes, default routes, or routing 
!     protocols other than OSPFv3
! 5. All IPv6 addresses in the topology must be reachable from 
!     all routers
!
! Initial Configuration
! R1
hostname R1
!
ipv6 unicast-routing
!
interface Loopback0
 ipv6 address FEC0::1:1/112
!
interface Serial0/0
 ipv6 address FEC0::12:1/112
 ipv6 ospf 1 area 0
 clock rate 64000
 bandwidth 64
 no shutdown
!
ipv6 router ospf 1
 router-id 172.16.1.1
end

!
! R2
hostname R2
!
ipv6 unicast-routing
!
interface Loopback0
 ipv6 address FEC0::2:1/112
 ipv6 ospf 1 area 0
!
interface Serial0/0
 ipv6 address FEC0::12:2/112
 ipv6 ospf 1 area 0
 bandwidth 64
 no shutdown
!
interface Serial0/1
 ipv6 address FEC0::23:2/112
 ipv6 ospf 1 area 0
 clock rate 64000
 bandwidth 64
 no shutdown
!
ipv6 router ospf 1
 router-id 172.16.2.1
end

!
! R3
hostname R3
!
ipv6 unicast-routing
!
interface Loopback0
 ipv6 address FEC0::3:1/112
 ipv6 ospf 1 area 0
!
interface Serial0/0
 ipv6 address FEC0::23:3/112
 ipv6 ospf 1 area 0
 bandwidth 64
 no shutdown
!
interface Serial0/1
 ipv6 address FEC0::34:3/112
 ipv6 ospf 1 area 0
 clock rate 64000
 bandwidth 64
 no shutdown
!
ipv6 router ospf 1
 router-id 172.16.3.1
end

!
! R4
hostname R4
!
ipv6 unicast-routing
!
interface Loopback0
 ipv6 address FEC0::4:1/112
 ipv6 ospf 1 area 0
!
interface Serial0/0
 ipv6 address FEC0::34:4/112
 ipv6 ospf 100 area 0
 bandwidth 64
 no shutdown
!
ipv6 router ospf 1
 router-id 172.16.4.1
end

! Verification
end

tclsh

foreach addr {
 fec0::1:1
 fec0::12:1
 fec0::12:2
 fec0::2:1
 fec0::23:2
 fec0::23:3
 fec0::3:1
 fec0::34:3
 fec0::34:4
 fec0::4:1
} {
 ping $addr
}

exit


!
! Corrected Confiuration
!
! R1
ipv6 unicast-routing
!
interface Loopback0
 no ip address
 ipv6 address FEC0::1:1/112
 ipv6 ospf 1 area 0
!
interface Serial0/0
 bandwidth 64
 no ip address
 ipv6 address FEC0::12:1/112
 ipv6 ospf 1 area 0
 clock rate 64000
!
ipv6 router ospf 1
 router-id 172.16.1.1
 log-adjacency-changes

!
! R2
ipv6 unicast-routing
!
interface Loopback0
 no ip address
 ipv6 address FEC0::2:1/112
 ipv6 ospf 1 area 0
!
interface Serial0/0
 bandwidth 64
 no ip address
 ipv6 address FEC0::12:2/112
 ipv6 ospf 1 area 0
 clock rate 2000000
!
interface Serial0/1
 bandwidth 64
 no ip address
 ipv6 address FEC0::23:2/112
 ipv6 ospf 1 area 0
 clock rate 64000
!
ipv6 router ospf 1
 router-id 172.16.2.1
 log-adjacency-changes

!
! R3
ipv6 unicast-routing
!
interface Loopback0
 no ip address
 ipv6 address FEC0::3:1/112
 ipv6 ospf 1 area 0
!
interface Serial0/0
 bandwidth 64
 no ip address
 ipv6 address FEC0::23:3/112
 ipv6 ospf 1 area 0
 clock rate 2000000
!
interface Serial0/1
 bandwidth 64
 no ip address
 ipv6 address FEC0::34:3/112
 ipv6 ospf 1 area 0
 clock rate 64000
!
ipv6 router ospf 1
 router-id 172.16.3.1
 log-adjacency-changes

!
! R4
ipv6 unicast-routing
!
interface Loopback0
 no ip address
 ipv6 address FEC0::4:1/112
 ipv6 ospf 1 area 0
!
interface Serial0/0
 bandwidth 64
 no ip address
 ipv6 address FEC0::34:4/112
 ipv6 ospf 1 area 0
 clock rate 2000000
!
interface Serial0/1
 no ip address
 shutdown
 clock rate 2000000
!
ipv6 router ospf 1
 router-id 172.16.4.1
 log-adjacency-changes
!
ipv6 router ospf 100
 log-adjacency-changes

!#####################################################################
! Chapter 8 Example IPv6 EIGRP
!
! File: RTR.Ch8-ex.IPv6.EIGRP-01
!
! IPv6 EIGRP AS 100
!
! DLCI -- DLCI
! 1:102   2: 201
! 1:103   3: 301
! 2:204   4: 203
!
!R1
en
conf t

no ip domain-lookup
enable secret class

line con 0
  logg sync
  no exec-timeout
  password cisco
  login
  privilege level 15

line vty 0 15
  logg sync
  no exec-time
  privilege level 15
  password cisco
  login 
exit

hostname R1

ipv uni

int s0/0
  encapsulation frame-relay
  no shut

int s0/0.3 point-to-point
  ipv add 13:13::1/64
  no ipv split-horizon eigrp 100
  frame-relay interface-dlci 103
  ipv eigrp 100

int s0/0.2 poin 
  ipv add 12:12::1/64
  no ipv split-horizon eigrp 100
  fra interface-dlci 102
  ipv eigrp 100
ex


!#####################################################################
! Chapter 8 Example RIPng
!
! File: RTR.Ch8-ex.RIPng-01
!
!  1. Initial Configuration
!  2. Global Unicast Frame Relay Map Configuration
!  3. Verification of Connectivity Between Sites
!  4. Configuration of Link-Local Address Maps
!  5. Configuring RIPng
!  6. Verifying RIPng on R1
!  7. Configuring Frame Relay Maps with the broadcast Keyword
!  8. Debug Output
!  9. Adding R3’s Loopback Interface to RIPng
! 10. Turning Off Split Horizon on R1
!
! DLCI -- DLCI
! 1:102   2: 201
! 1:103   3: 301
!
! 1. Initial configuration
!
!R1

int s0/0
  enc fra ietf
  ipv add 2001:12::1/64
  no shut
ex

!
!R2

int lo0
  ipv add 2001:22::2/64

int s0/0
  enc fra ietf
  no shut
ex

int s0/0.7 multipoint
  ipv add 2001:12::2/64
  no shut
ex

!
! R3
int lo0
  ipv add 2001:33::3/64

int s0/0
  enc fra ietf
  no shut
  
int s0/0.7 multipoint
  ipv add 2001:12::3/64
  no shut
ex

!
! FR map configuration
!
! R1
int s0/0
  fra map ipv 2001:12::2 102
  fra map ipv 2001:12::3 103
  no shut
ex

!
! R2
int s0/0.7
 fra map ipv 2001:12::1 201
 ex
 no shut
ex

!
! R3
int s0/0.7
 fra map ipv 2001:12::1 301
  no shut
ex

!
! Verify connectivity
!
! R1
do pi 2001:12::2
do pi 2001:12::3

! R2
do pi 2001:12::1

! R3
do pi 2001:12::1

! Config link-local address
!
! R1
int s0/0
 ipv add fe80::1 li

! R2
int s0/0.7
 ipv add fe80::2 li

! R3
int s0/0.7
 ipv add fe80::3 li

! 2. Global Unicast Frame Relay Map Configuration
!
! R1
do sh runint s0/0

fram map ipv 2001:12::2 102
fram map ipv 2001:12::3 103

! R2
do sh run int s0/0.7

int s0/0.7
 frame map ipv 2001:12::1 201

! R3
do sh run int s0/0.7

int s0/0.7
 fram map ipv 2001:12::1 301

! 3. Verification of Connectivity Between Sites
!
! R1
do pi 2001:12::2
do pi 2001:12::3

! R2  & R3
do pi 2001:12::1

! 4. Configuration of Link-Local Address Maps
!
! R1
int s0/0
 fram map ipv fe80::2 102 
 fram map ipv fe80::3 103

! R2
int s0/0.7
 fram map ipv fe80::1 201

! R3
int s0/0.7
 fram map ipv fe80::1 301

! 5. Configuring RIPng
!
! R1
exit

ipv uni

int s0/0
 ipv rip RIPTag en

do sh ipv protocols

! R2 & R3
exit

ipv uni

int s0/0.7
 ipv rip RIPTag en

do sh ipv pro

! 6. Verifying RIPng on R1
!
! R1
do debug ipv rip

! N.B: R1 only sending not receiving

! 7. Configuring Frame Relay Maps with the broadcast Keyword
!
!  No "broadcast" keyword in the above configuration.  The keyword allows
!  both broacast and multicast packets to go across FR network.
!  
!  RIPng only use link-local address to commeunicate between routers
!
! R1
do sh frame-relay map

int s0/0
 fram map ipv fe80::2 102 bro
 fram map ipv fe80::3 103 bro

! R2
int s0/0.7
 fram map ipv fe80::1 201 bro

! R3
int s0/0.7
 fram map ipv fe80::1 301 bro

! 8. Debug Output
!
! R1
do deb ipv rip

! 9. Adding R3’s Loopback Interface to RIPng
!
! R3
int lo103
 ipv rip RIPTag en

! R1
do sh rou rip

do pi 2001:33::3

! R2
do sh ipv rou rip
! R2 does not learn lo103 due to split-horizon of RIPng

! 10. Turning Off Split Horizon on R1
!
! R1
ipv router rip RIPTag
 no split

! R2
do sh ipv rou rip

do pi 2001:33::3

! NB: requires "frame map ipv 2001:12::2" on R3 to make the above
!     command work
!
! R3
int s0/0.7
 fram map ipv 2001:12::2 301


!#####################################################################
! Chapter 8 Example IPv6 Policy-Based Routing
!
! File: RTR.Ch8-ex.PBR-01
!
! IPv6 EIGRP AS 100
!
! DLCI -- DLCI
! 1:102   2: 201
! 1:103   3: 301
! 2:203   3: 302
!
! Procedures: 
!   1. Initial configuration
!   2. Enable RIPng with link-local addresses FE80::x
!   3. configuring route map on R1
!   4. verify route map on R1
!     a. debug observation on policy
!     b. connectivity 
!
! Initial configuration revised from http://www.techexams.net/forums/ccnp/62635-ipv6-frame-relay-full-mesh-topology-without-sub-int-update-solved.html
!
!
!   1. Initial configuration
!
! R1
int f0/0
  ipv add 14::1/64
  no shut

int s0/0
  ipv add 123::1/64
  enc fra ietf
  fram map ipv 123::2 102
  fram map ipv 123::3 103
  no shut
ex

!
! R2
int s0/0
  ipv add 123::2/64
  enc fra iet
  fram map ipv 123::1 201
  fram map ipv 123::3 203
  no shut
ex

!
! R3
int s0/0
  ipv add 123::3/64
  enc fra ietf
  fram map ipv 123::1 301
  fram map ipv 123::2 302
  no shut
ex

!
! R4
int f0/0
  ipv add 14::4/64
  no shut

int lo104
  ipv add 104::1/64
ex

! Verify interface status
do sh ipv int bri

! verify frame relay status
do sh fram map

! Verify connectivity btw routers
do pi 123::1
do pi 123::2
do pi 123::3

do pi 14::1
do pi 14::4

!
!   2. Enable RIPng with link-local addresses FE80::x
!
! R1
ipv uni

int s0/0
  ipv6 address fe80::1 link-local
  ipv rip RIPngTag en
  fram map ipv fe80::2 102 bro
  fram map ipv fe80::3 103 bro

int f0/0
  ipv rip RIPngTag en

!
! R2
ipv uni

int s0/0
  ipv add fe80::2 lin
  ipv rip RIPngTag en
  fram map ipv fe80::1 201 bro
  fram map ipv fe80::3 203 bro

!
! R3
ipv uni

int s0/0
  ipv add fe80::2 lin
  ipv rip RIPngTag en
  fram map ipv fe80::1 301 bro
  fram map ipv fe80::2 302 bro

!
! R4
ipv uni

int f0/0
  ipv rip RIPngTag en

int lo104
  ipv rip RIPngTag en


!
! Verify
do sh ipv rou rip

!
! 3. configuring route map on R1
!
! R1
ex

route-map PBR_SRC_ADDR permit 10
  match ipv6 address SOURCE_104
  set next-hop 123::3
ex

ipv6 access-list SOURCE_104
  permit 104::/64 any
ex

int f0/0
  ipv6 policy route-map PBR_SRC_ADDR

do sh route-map

do sh ipv access-list

!   4. verify route map on R1
!     a. debug observation on policy
!     b. connectivity 
!
! R1
do debug ipv6 policy

!
! R4
do ping 123::2

do pi 123::2 source lo104


!
! Running Configuration  --- ping does not work but the policy is working
!
! R1
ipv6 unicast-routing

interface FastEthernet0/0
 no ip address
 duplex auto
 speed auto
 ipv6 address FE80::14 link-local
 ipv6 address 14::1/64
 ipv6 rip RIPngTag enable
 ipv6 policy route-map PBR_SRC_ADDR
!
interface Serial0/0
 no ip address
 encapsulation frame-relay IETF
 ipv6 address FE80::1 link-local
 ipv6 address 123::1/64
 ipv6 rip RIPngTag enable
 clock rate 2000000
 frame-relay map ipv6 FE80::3 103 broadcast
 frame-relay map ipv6 FE80::2 102 broadcast
 frame-relay map ipv6 123::3 103
 frame-relay map ipv6 123::2 102

ipv6 router rip RIPngTag
!
route-map PBR_SRC_ADDR permit 10
 match ipv6 address SOURCE_104
 set ipv6 next-hop 123::3
!
ipv6 access-list SOURCE_104
 permit ipv6 104::/64 any


!
! R2
ipv6 unicast-routing

interface Serial0/0
 no ip address
 encapsulation frame-relay IETF
 ipv6 address FE80::2 link-local
 ipv6 address 123::2/64
 ipv6 rip RIPngTag enable
 clock rate 2000000
 frame-relay map ipv6 FE80::3 203 broadcast
 frame-relay map ipv6 FE80::1 201 broadcast
 frame-relay map ipv6 123::3 203
 frame-relay map ipv6 123::1 201

ipv6 router rip RIPngTag

!
! R3
ipv6 unicast-routing

interface Serial0/0
 no ip address
 encapsulation frame-relay IETF
 ipv6 address FE80::3 link-local
 ipv6 address 123::3/64
 ipv6 rip RIPngTag enable
 clock rate 2000000
 frame-relay map ipv6 FE80::2 302 broadcast
 frame-relay map ipv6 FE80::1 301 broadcast
 frame-relay map ipv6 123::2 302
 frame-relay map ipv6 123::1 301

ipv6 router rip RIPngTag

!
! R4
ipv6 unicast-routing

interface Loopback104
 no ip address
 ipv6 address 104::1/64
 ipv6 rip RIPngTag enable
!
interface FastEthernet0/0
 no ip address
 duplex auto
 speed auto
 ipv6 address FE80::41 link-local
 ipv6 address 15::4/64
 ipv6 rip RIPngTag enable

ipv6 router rip RIPngTag



!#####################################################################
! Chapter 8 Example IPv6 RIPng Redistribution
!
! File: RTR.Ch8-ex.Redist.RIPng-01
!
! Procedures:
!   1. Config and verify F/R network
!   2. RIPng config and verify on R1 & R2
!   3. config and verify resistibute connected on R2
!   4. RIPng config and verify on R3
!   5. Create RIPng domain by changing port number for RIPng process
!   6. Config and verify redistribute on R3
!   7. changing metrics of redistributed routes with route map
!   8. verify redistribution with route map on R3
!
!
! 1. Config and verify F/R network and R4
!
! R1
int s0/0
  ipv add 123::1/64
  enc fra iet
  fram map ipv 123::2 102
  fram map ipv 123::3 103

  ipv add fe80::1 lin
  fram map ipv fe80::2 102 bro
  fram map ipv fe80::3 103 bro
  no shut
ex

!
! R2
int lo102
  ipv add 102::1/64

int s0/0
  enc fra iet
  no shut

int s0/0.1 multipoint
  ipv add 123::2/64
  fram map ipv 123::1 201

  ipv add fe80::2 lin
  fram map ipv fe80::1 201 bro

int s0/1
  ipv add 24::2/64
  enc ppp
  band 8000
  no shut
ex

!
! R3
int lo103
  ipv add 103::1/64

int s0/0
  enc fram iet
  no shut

int s0/0.7 multipoint
  ipv add 123::3/64
  fram map ipv 123::1 301
  
  ipv add fe80::3 lin
  fram map ipv FE80::1 301 bro

int s0/1
  ipv add 34::3/64
  enc ppp
  ban 8000
  no shut
ex

!
! R4
int lo104
  ipv add 104::1/64

int s0/0
  ipv add 24::4/64
  enc ppp
  clock rate 8000000
  ban 8000
  no shut

int s0/1
  ipv add 34::4/64
  enc ppp
  clock rate 8000000
  band 8000
  no shut
ex

! Verify
do pi 123::1
do pi 123::2
do pi 123::3

do pi 24::2
do pi 24::4

do pi 34::3
do pi 34::4

! 2. RIPng config and verify on R1 & R2
!
! R1
ipv uni

int s0/0
  ipv rip R1R3 en

! 
! R2
ipv uni

int s0/0.1
  ipv rip R1R2 en

do deb ipv rip

! 3. config and verify resistibute connected on R2
!
! R1
ipv router rip R1R3
  no split-horizon

!
! R2
ipv router rip R1R2
  redistribute connected

!
! R1
do sh ipv rou rip

! 4. RIPng config and verify on R3
!
! R1  required to make the route distributed
ipv router rip R1R3
  no split-horizon

! R3
ipv uni
  
int s0/0.7
  ipv rip R1R3 en

do sh ipv rou rip

! 5. Create RIPng domain by changing port number for RIPng process
!
! R3
ipv6 router rip R1R3
  port 1013 multicast-group FF02::9

!
! R1
ipv6 router rip R1R3
  port 1013 multicast-group fF02::9

do clear ipv6 route *

!
! R3
do clear ipv rou *

do sh ipv rou rip

! 
! R1
do sh ipv rou rip

! command needs time to take effect

! 6. Config and verify redistribute on R1
!
! R1
int s0/0
  ipv6 rip R1R2 en

ipv6 router rip R1R2
  redistribute rip R1R3

ipv6 router rip R1R3
  redistribute rip R1R2

!
! R3
do sh ipv rou rip

! 7. changing metrics of redistributed routes with route map
!
! R3
ipv6 router rip R1R3
  redistribute connected route-map CONN_PREFIX

router-map CONN_PREFIX
  match ipv6 add PREFIX_34
  set metric 15

route-map CONN_PREFIX permit 20
  match ipv add prefix-list PREFIX_103
  set metric 5

ipv6 access-list PREFIX_34
  permit ipv6 34::/64

! ipv6 prefix-list PREFIX_103 permit 103::/64 any
ipv6 prefix-list PREFIX_103 permit 103::/64

! 8 verify redistribution with route map on R3
!
! R3
do deb ipv6 rip

!
! R1
do sh ipv rou rip

!
! Running Configuration
!
! R1
ipv6 unicast-routing

interface Serial0/0
 no ip address
 encapsulation frame-relay IETF
 ipv6 address 123::1/64
 ipv6 address FE80::1 link-local
 ipv6 rip R1R2 enable
 ipv6 rip R1R3 enable
 clock rate 2000000
 frame-relay map ipv6 FE80::2 102 broadcast
 frame-relay map ipv6 FE80::3 103 broadcast
 frame-relay map ipv6 123::2 102
 frame-relay map ipv6 123::3 103

ipv6 router rip R1R3
 redistribute rip R1R2
  no split-horizon
  port 1013 multicast-group FF02::9
!
ipv6 router rip R1R2
 redistribute rip R1R3

!
! R2
!
ipv6 unicast-routing

interface Loopback102
 no ip address
 ipv6 address 102::1/64

interface Serial0/0
 no ip address
 encapsulation frame-relay IETF
 clock rate 2000000
!
interface Serial0/0.1 multipoint
 ipv6 address 123::2/64
 ipv6 address FE80::2 link-local
 ipv6 rip R1R2 enable
 frame-relay map ipv6 123::1 201
 frame-relay map ipv6 FE80::1 201 broadcast

interface Serial0/1
 bandwidth 2000
 no ip address
 encapsulation ppp
 ipv6 address 24::2/64
 clock rate 2000000

ipv6 router rip R1R2
 redistribute connected

!
! R3
!
ipv6 unicast-routing

interface Loopback103
 no ip address
 ipv6 address 103::1/64

interface Serial0/0
 no ip address
 encapsulation frame-relay IETF
 clock rate 2000000
!
interface Serial0/0.7 multipoint
 ipv6 address 123::3/64
 ipv6 address FE80::3 link-local
 ipv6 rip R1R3 enable
 frame-relay map ipv6 FE80::3 301 broadcast
 frame-relay map ipv6 123::1 301

interface Serial0/1
 bandwidth 2000
 no ip address
 encapsulation ppp
 ipv6 address 34::3/64
 clock rate 2000000

ipv6 router rip R1R3
 redistribute connected route-map CONN_PREFIX
  port 1013 multicast-group FF02::9
!
ipv6 prefix-list PREFIX_103 seq 5 permit 103::/64
route-map CONN_PREFIX permit 10
 match ipv6 address PREFIX_34
 set metric 15
!
route-map CONN_PREFIX permit 20
 match ipv6 address prefix-list PREFIX_103
 set metric 5
!
ipv6 access-list PREFIX_34
 permit ipv6 34::/64 any

!
! R4
!
ipv6 unicast-routing

interface Serial0/0
 bandwidth 2000
 no ip address
 encapsulation ppp
 ipv6 address 24::4/64
 clock rate 2000000

interface Serial0/1
 bandwidth 2000
 no ip address
 encapsulation ppp
 ipv6 address 34::4/64
 clock rate 2000000



!#####################################################################
! Chapter 8 Example IPv6 Redistribution - RIPng & OSPFv3
!
! File: RTR.Ch8-ex.Redist.RIPng&OSPFv3-01
!
! Procedures:
!   1. Initial configuration with F/R and R4
!   2. Config RIPng domains, R1R2 and R1R3, and their redistribution
!   3. Config OSPFv3 processes on R2, R3, and R4
!   4. verify redistribuition on RIPng routers
!   5. config redistribution of connected routes on R3
!   6. verify distribution of connected routes on R4
!   7. config OSPFv3 redistribution on R4
!   8. verify OSPFv3 redistribution on R2 & R3
!   9. config RIPng and OSPFv3 redistribution on R2 & R3
!  10. verify RIPng & OSPFv3 redistribution on R1
!  11. config and verify redistribution traffic
!  12. exame resulting paths
!  13. exame behavior when a network goes down
!  14. follow and confirm the routing loop
!  15. config filtering to prevent routing loop
!  16. verify that filtering did prevent routign loop
!  17. fix and verify suboptimal routing loop
!
! 1. Initial configuration with F/R and R4
!
! Redo Redistribution RIPng example

! 2. Config RIPng domains, R1R2 and R1R3, and their distribution
!
! Redo Redistribution RIPng example

! 3. Config OSPFv3 processes on R2, R3, and R4
!
! R2
ipv router ospf 1
 router-id 10.10.1.2

ipv router ospf 102
 router-id 10.10.102.1

int s0/1
 ipv ospf 1 area 0

int lo102
 ipv ospf 1 area 102

!
! R3
ipv router ospf 2
 router-id 10.10.2.3

int s0/1
 ipv ospf 2 area 0

!
! R4
ipv router ospf 1
 router-id 10.10.1.4

ipv router ospf 2
 router-id 10.10.2.4

int s0/0
 ipv ospf 1 area 0

int s0/1
 ipv ospf 2 area 0

! R2, R3, & R4
do sh ipv ospf nei

do sh ipv pro

do sh ipv rou ospf

! 4. verify redistribuition on RIPng routers
!
! R1
do sh ipv pro

do sh ipv rip R1R2

do sh ipv rip R1R3

!
! Initial Configuration 
!
! R1
ipv6 unicast-routing

interface Loopback101
 no ip address
 ipv6 address 101::1/64
 ipv6 rip R1R2 enable

interface Serial0/0
 no ip address
 encapsulation frame-relay IETF
 ipv6 address FE80::1 link-local
 ipv6 address 123::1/64
 ipv6 rip R1R3 enable
 ipv6 rip R1R2 enable
 clock rate 2000000
 frame-relay map ipv6 FE80::3 103 broadcast
 frame-relay map ipv6 FE80::2 102 broadcast
 frame-relay map ipv6 123::3 103
 frame-relay map ipv6 123::2 102

ipv6 router rip R1R2
 redistribute connected
 redistribute rip R1R3
  no split-horizon
!
ipv6 router rip R1R3
 redistribute rip R1R2
  no split-horizon
  port 1013 multicast-group FF02::9

!
! R2
ipv6 unicast-routing

interface Loopback102
 no ip address
 ipv6 address 102::1/64
 ipv6 ospf 1 area 102

!         
interface Serial0/0
 no ip address
 encapsulation frame-relay IETF
 clock rate 2000000
!
interface Serial0/0.1 multipoint
 snmp trap link-status
 ipv6 address FE80::2 link-local
 ipv6 address 123::2/64
 ipv6 rip R1R2 enable
 frame-relay map ipv6 FE80::3 201 broadcast
 frame-relay map ipv6 123::3 201
 frame-relay map ipv6 FE80::1 201 broadcast
 frame-relay map ipv6 123::1 201

interface Serial0/1
 no ip address
 encapsulation ppp
 ipv6 address FE80::2 link-local
 ipv6 address 24::2/64
 ipv6 ospf 1 area 0
 clock rate 2000000

ipv6 router ospf 1
 router-id 10.10.1.2
 log-adjacency-changes
!
ipv6 router rip R1R2
 redistribute connected

!
! R3
ipv6 unicast-routing

interface Loopback103
 no ip address
 ipv6 address 103::1/64

!         
interface Serial0/0
 no ip address
 encapsulation frame-relay IETF
 clock rate 2000000
!
interface Serial0/0.7 multipoint
 snmp trap link-status
 ipv6 address FE80::3 link-local
 ipv6 address 123::3/64
 ipv6 rip R1R3 enable
 frame-relay map ipv6 FE80::2 301 broadcast
 frame-relay map ipv6 FE80::1 301 broadcast
 frame-relay map ipv6 123::2 301
 frame-relay map ipv6 123::1 301

interface Serial0/1
 no ip address
 encapsulation ppp
 ipv6 address FE80::3 link-local
 ipv6 address 34::3/64
 ipv6 ospf 2 area 0
 clock rate 2000000

ipv6 router ospf 2
 router-id 10.10.2.3
 log-adjacency-changes
!
ipv6 router rip R1R3
 redistribute connected
  port 1013 multicast-group FF02::9

! 
! R4
ipv6 unicast-routing

interface Loopback104
 no ip address
 ipv6 address 104::1/64

interface Serial0/0
 no ip address
 encapsulation ppp
 ipv6 address FE80::4 link-local
 ipv6 address 24::4/64
 ipv6 ospf 1 area 0
 clock rate 2000000

interface Serial0/1
 no ip address
 encapsulation ppp
 ipv6 address FE80::4 link-local
 ipv6 address 34::4/64
 ipv6 ospf 2 area 0
 clock rate 2000000

ipv6 router ospf 1
 router-id 10.10.1.4
 log-adjacency-changes
!
ipv6 router ospf 2
 router-id 10.10.2.4
 log-adjacency-changes

! 5. config redistribution of connected routes on R3
!
! R3
ipv router ospf 2
 redistribute connected metric-type 1 tag 3333 route-map LOOPBACKS

route-map LOOPBACKS permit 10
 match ipv add L103
ex

ipv access-list L103
 permit ipv 103::/64 any
ex

! 6. verify distribution of connected routes on R4
!
! R4
do sh ipv rou ospf

! 7. config OSPFv3 redistribution on R4
!
! R4
ipv router ospf 1 
! router-id 10.0.0.41
 redistribute connected
 redistribute ospf 2

ipv router ospf 2
! router-id 10.0.0.42
 redistribute connected
 redistribute ospf 1

! 8. verify OSPFv3 redistribution on R2 & R3
!
! R2 & R3
do sh ipv rou ospf

! 9. ipv config RIPng and OSPFv3 redistribution on R2 & R3
!
! R2
ipv router rip R1R2
  redistribute ospf 1
  redistribute connected

ipv router ospf 1
  redistribute rip R1R2
  redistribute connected

!
! R3
ipv router ospf 2
  redistribute connected
  redistribute rip R1R3

ipv router rip R1R3
  redistribute connected
  redistribute ospf 2

! 10. verify RIPng & OSPFv3 redistribution on R1
!
! R1
do sh ipv rou rip

do deb ipv rip

do un all  ! wait for a while to turn off the debug

! 11. config and verify redistribution traffic
!
! R2
ipv router rip R1R2
  redistribute ospf 1 metric 1

!
! R3
ipv router rip R1R3
  redistribute ospf 2 metric 1

!
! R1
do sh ipv rou rip

!
! R4
do pi 101::1 source 104::1

! 12. exame resulting paths
!
! R4
do trace 101::1

!
! R3
do sh  ipv route | section 10[14]::/64

do trace 101::1
! Problems:
! 1. The path R3-->R4-->R2-->R1 not waht we want
! 2. edge routers redistributes RIPng and OSPFv3 in both directions
! 3. issues when instable (interface down) --> step 13 shows it
!
! Solution: 
! 1. assign adminstrative distance
! 2. route filtering

! 13. exame behavior when a network goes down
!
! R3
do deb ipv rou

! 
! R4
int lo104
  shut
!
! R3
! observe result with debug output
!
! lo104 down but the routing table picks RIPng path for lo104

! 
! 14. follow and confirm the routing loop
!
! R3
do undebug all

do sh ipv rou | section 10[14]::/64

!
! R1, R2 & R4
do sh ipv rou | section 10[14]::/64

! R3 - confirming
do trace 104::1

!##################   IMPORTANT NOTICE   ###############################
! Unable to replicate the loop shoown in book.  The path selects the 
! OSPFv3 to establish the path for 104::1 due to lower administrative 
! diatance.  (R3->R4->R2->R1)
!
! After changing the distance value (step 17) to 109, R3 chooses the 
! R1 as the path.  However, the trace 104::1 command shows
! R3(config-rtr)#do trace 104::1
!
! Type escape sequence to abort.
! Tracing the route to 104::1
!
!  1 123::1 144 msec 8 msec 8 msec
!  2 123::2 28 msec 64 msec 20 msec
!  3  * 
!    123::1 148 msec 12 msec
!  4 123::2 72 msec 28 msec 64 msec
!  5  * 
!    123::1 92 msec 32 msec
!  6 123::2 84 msec 24 msec * 
!  7 123::1 140 msec *  64 msec
!  8 123::2 128 msec *  152 msec
!  9  * 
!    123::1 168 msec * 
! 10 123::2 124 msec 60 msec * 
! 11  *  *  * 
! 12 123::1 !U  !U  !U 
! 
! The path forms a loop between R1 and R2.  Then, no shut lo104 and
! remove the distance settings.  The network backs to as usual.  The 
! output message on R3 is shown as following
! 
! IPv6RT0: rip R1R3, Deleting all next-hops for 24::/64
! IPv6RT0: rip R1R3, Delete 24::/64 from table
! IPv6RT0: ospf 2, Backup call for 24::/64
! IPv6RT0: rip R1R3, Delete backup for 34::/64
! IPv6RT0: rip R1R3, Deleting all next-hops for 102::1/128
! IPv6RT0: rip R1R3, Delete 102::1/128 from table
! IPv6RT0: ospf 2, Backup call for 102::1/128
! IPv6RT0: rip R1R3, Deleting all next-hops for 102::/64
! IPv6RT0: rip R1R3, Delete 102::/64 from table
! IPv6RT0: rip R1R3, Delete backup for 103::/64
! IPv6RT0: rip R1R3, Deleting all next-hops for 104::/64
! IPv6RT0: rip R1R3, Delete 104::/64 from table
! IPv6RT0: ospf 2, Backup call for 104::/64
! IPv6RT0: rip R1R3, Delete backup for 123::/64
! IPv6RT0: rip R1R3, Route add 24::/64 [new]
! IPv6RT0: rip R1R3, Add 24::/64 to table
! IPv6RT0: rip R1R3, Adding next-hop FE80::1 over Serial0/0.7 for 24::/64, [120/3]
! IPv6RT0: rip R1R3, Added backup for 34::/64, distance 120
! IPv6RT0: rip R1R3, Route add 102::/64 [new]
! IPv6RT0: rip R1R3, Add 102::/64 to table
! IPv6RT0: rip R1R3, Adding next-hop FE80::1 over Serial0/0.7 for 102::/64, [120/3]
! IPv6RT0: rip R1R3, Added backup for 103::/64, distance 120
! IPv6RT0: rip R1R3, Route add 104::/64 [new]
! IPv6RT0: rip R1R3, Add 104::/64 to table
! IPv6RT0: rip R1R3, Adding next-hop FE80::1 over Serial0/0.7 for 104::/64, [120/3]
! IPv6RT0: rip R1R3, Added backup for 123::/64, distance 120
! IPv6RT0: Event: 24::/64, Del, owner rip, previous None
! IPv6RT0: Event: 102::1/128, Del, owner rip, previous None
! IPv6RT0: Event: 102::/64, Del, owner rip, previous None
! IPv6RT0: Event: 104::/64, Del, owner rip, previous None
! IPv6RT0: Event: 24::/64, Add, owner rip, previous None
! IPv6RT0: Event: 102::/64, Add, owner rip, previous None
! IPv6RT0: Event: 104::/64, Add, owner rip, previous None
! IPv6RT0: ospf 2, Route add 104::/64 [better dist 110, 120]
! IPv6RT0: rip R1R3, Added backup for 104::/64, distance 120
! IPv6RT0: rip R1R3, Deleting all next-hops for 104::/64
! IPv6RT0: ospf 2, Adding next-hop FE80::4 over Serial0/1 for 104::/64, [110/20]
! IPv6RT0: ospf 2, Route add 24::/64 [better dist 110, 120]
! IPv6RT0: rip R1R3, Added backup for 24::/64, distance 120
! IPv6RT0: rip R1R3, Deleting all next-hops for 24::/64
! IPv6RT0: ospf 2, Adding next-hop FE80::4 over Serial0/1 for 24::/64, [110/20]
! IPv6RT0: Event: 104::/64, Add, owner ospf, previous rip
! IPv6RT0: Event: 24::/64, Add, owner ospf, previous rip
! IPv6RT0: ospf 2, Route add 102::1/128 [new]
! IPv6RT0: ospf 2, Add 102::1/128 to table
! IPv6RT0: ospf 2, Adding next-hop FE80::4 over Serial0/1 for 102::1/128, [110/64]
! IPv6RT0: Event: 102::1/128, Add, owner ospf, previous None
! IPv6RT0: rip R1R3, Ignoring update for 102::1/128 [120/3],table [110/64]
! IPv6RT0: rip R1R3, Added backup for 102::1/128, distance 120
!
! After these actions, shut down the lo104 again.  The result on R3 shows
!
! R3(config-rtr)#
! IPv6RT0: ospf 2, Deleting all next-hops for 104::/64
! IPv6RT0: ospf 2, Delete 104::/64 from table
! IPv6RT0: rip R1R3, Backup call for 104::/64
! IPv6RT0: rip R1R3, Route add 104::/64 [new]
! IPv6RT0: rip R1R3, Add 104::/64 to table
! IPv6RT0: rip R1R3, Adding next-hop FE80::1 over Serial0/0.7 for 104::/64, [120/3]
! IPv6RT0: Event: 104::/64, Del, owner ospf, previous None
! IPv6RT0: Event: 104::/64, Add, owner rip, previous None
! IPv6RT0: ospf 2, Reuse backup for 123::/64, distance 110
!
! R3(config-rtr)#do trace 104::1
! 
! Type escape sequence to abort.
! Tracing the route to 104::1
! 
!   1 123::1 56 msec 44 msec 0 msec
!   2 123::2 20 msec 40 msec 8 msec
!   3 24::4 16 msec 52 msec 16 msec
!   4 34::3 8 msec 8 msec 16 msec
!   5  * 
!     123::1 88 msec 76 msec
!   6 123::2 12 msec 60 msec 44 msec
!   7 24::4 44 msec 32 msec 52 msec
!   8 34::3 24 msec 32 msec 68 msec
!   9  * 
!     123::1 120 msec 76 msec
!  10 123::2 32 msec 76 msec 40 msec
!  11 24::4 40 msec 56 msec 76 msec
!  12 34::3 32 msec 4 msec 68 msec
!  13  * 
!     123::1 172 msec 104 msec
!  14 123::2 28 msec 112 msec 40 msec
!  15 24::4 96 msec 88 msec 92 msec
!  16 34::3 56 msec 52 msec 52 msec
!  17  * 
!     123::1 72 msec 188 msec
!  18 123::2 68 msec 104 msec 44 msec
!  19 24::4 108 msec 60 msec 104 msec
!  20 34::3 68 msec 88 msec 52 msec
!  21  * 
!     123::1 156 msec * 
!  22 123::2 204 msec 88 msec 108 msec
!  23 24::4 108 msec 104 msec 92 msec
!  24 34::3 88 msec 84 msec 116 msec
!  25  * 
!     123::1 188 msec * 
!  26 123::2 212 msec 112 msec 132 msec
!  27 24::4 80 msec 116 msec 112 msec
!  28 34::3 132 msec 88 msec 120 msec
!  29  * 
!     123::1 232 msec * 
!  30 123::2 200 msec 100 msec 100 msec
! Destination not found inside max hopcount diameter.
!
! The result shows as described in the text book.  
!
! Besides, the updated routing messages are
! ospf 2, Route add 24::/64 [owner]
! ospf 2, Route add 101::/64 [owner]
! ospf 2, Reuse backup for 103::/64, distance 110
!
! * Suspect that the loop formed casued by the OSPFv3 not resetting the 
! *  process
! 
! R3(config)#do sh ipv rou | s 10[14]::/64   
! OE2  101::/64 [110/20]
!      via FE80::4, Serial0/1
! R   104::/64 [120/3]
!      via FE80::1, Serial0/0.7
! 
! R1(config-rtr)#do sh ipv rou | section 10[14]::/64
! C   101::/64 [0/0]
!      via ::, Loopback101
! R   104::/64 [120/2]
!      via FE80::2, Serial0/0
! 
! R2(config-rtr)#do sh ipv rou | section 10[14]::/64
! R   101::/64 [120/2]
!      via FE80::1, Serial0/0.1
! OE2  104::/64 [110/20]
!      via FE80::4, Serial0/1
! 
! R4(config-if)#do sh ipv rou | section 10[14]::/64
! OE2  101::/64 [110/20]
!      via FE80::2, Serial0/0
! OE2  104::/64 [110/20]
!      via FE80::3, Serial0/1
!
! The result cannot duplicate after lo104 backing and taking off online
!

! 15. config filtering to prevent routing loop
!
! R4
int lo104
  no shut

!
! R2
ipv router rip R1R2
  redistribute ospf 1 metric 1 route-map OSPF_TO_RIP

route-map OSPF_TO_RIP deny 10
  match ipv add prefix-list RIP_NATIVE

route-map OSPF_TO_RIP permit 20
  ipv prefix-list RIP_NATIVE seq 5 permit 101::/64

!
! R3
ipv router rip R1R3
  redistribute connected
  redistribute ospf 2 metric 1 route-map OSPF_TO_RIP

route-map OSPF_TO_RIP deny 10
  match ipv add prefix-list RIP_NATIVE

route-map OSPF_TO_RIP permit 20
  ipv prefix-list RIP_NATIVE seq 5 permit 101::64

! 
! R1
ipv router rip R1R3
  redistribute rip R1R2 route-map RIP_TO_OSPF

ipv router rip R1R2
  redistribute rip R1R3 route-map RIP_NOT_OSPF

route-map RIP_NOT_OSPF permit 10
  match ipv add prefix-list RIP_NATIVE

route-map RIP_NOT_OSPF deny 20
  ipv prefix-list RIP_NATIVE seq 5 permit 101::/64


! 16. verify that filtering did prevent routign loop
!
! R3
do deb ipv routing

!
! R4
int lo104
shut

!
! R3, R1 & R2
do sh ipv rou | section 10[14]::/64

!
! After entering the above commands, the loop forms.  The original path 
! is R3->R4->R2->R1 than stops where OSPFv3 takes over the route.  After 
! these commands, the route is R3->R1->R2->R4->R3 ...
!

!
! R4
int lo104
  no shut

! 17. fix and verify suboptimal routing loop
!
! R3
do sh ipv rou | sec 10[14]::/64

ipv router rip R1R3
  distance 109

!
! R2
ipv router rip R1R2
  distance 109

! 
! R2, R3
do sh ipv rou | s 10[14]::/64

! if shutdown lo104, trace 104::1 on R3 will result unreachable after 
! the network converge.  It won't happen immediately.

!
! R4
do pi 101::1 source 104::1

!
! After setting the distance value to resolve the suboptimal problem, 
! R4 cannot ping lo101.  Therefore, R3 reach lo101 via R4. However,
! when 104::1 is down, a loop forms between R1 & R2.  How to propogate 
! the down infomation to R1?

!
!
! Running Configuration without distance setting
!
! R1
ipv6 unicast-routing
!
interface Loopback101
 no ip address
 ipv6 address 101::1/64
 ipv6 rip R1R2 enable
!
interface Serial0/0
 no ip address
 encapsulation frame-relay IETF
 ipv6 address FE80::1 link-local
 ipv6 address 123::1/64
 ipv6 rip R1R2 enable
 ipv6 rip R1R3 enable
 clock rate 2000000
 frame-relay map ipv6 123::2 102
 frame-relay map ipv6 123::3 103
 frame-relay map ipv6 FE80::2 102 broadcast
 frame-relay map ipv6 FE80::3 103 broadcast
!
interface Serial0/1
 no ip address
 shutdown
 clock rate 2000000
!
ipv6 router rip R1R2
 redistribute connected
 redistribute rip R1R3 route-map RIP_NOT_OSPF
  no split-horizon
!
ipv6 router rip R1R3
 redistribute rip R1R2 route-map RIP_NOT_OSPF
  no split-horizon
  port 1013 multicast-group FF02::9
!
ipv6 prefix-list RIP_NATIVE seq 5 permit 101::/64
!
route-map RIP_NOT_OSPF permit 10
 match ipv6 address prefix-list RIP_NATIVE
!
route-map RIP_NOT_OSPF deny 20

! R2
!
ipv6 unicast-routing
!
interface Loopback102
 no ip address
 ipv6 address 102::1/64
 ipv6 ospf 1 area 102
!         
interface Serial0/0
 no ip address
 encapsulation frame-relay IETF
 clock rate 2000000
!
interface Serial0/0.1 multipoint
 snmp trap link-status
 ipv6 address FE80::2 link-local
 ipv6 address 123::2/64
 ipv6 rip R1R2 enable
 frame-relay map ipv6 123::1 201
 frame-relay map ipv6 FE80::1 201 broadcast
 frame-relay map ipv6 123::3 201
 frame-relay map ipv6 FE80::3 201 broadcast
!
interface Serial0/1
 no ip address
 encapsulation ppp
 ipv6 address FE80::2 link-local
 ipv6 address 24::2/64
 ipv6 ospf 1 area 0
 clock rate 2000000
!
ipv6 router ospf 1
 router-id 10.10.1.2
 log-adjacency-changes
 redistribute connected
 redistribute rip R1R2
!
ipv6 router rip R1R2
 redistribute connected
 redistribute ospf 1 metric 1 route-map OSPF_TO_RIP
!         
ipv6 prefix-list RIP_NATIVE seq 5 permit 101::/64
!
route-map OSPF_TO_RIP deny 10
 match ipv6 address prefix-list RIP_NATIVE
!
route-map OSPF_TO_RIP permit 20

! R3
!
ipv6 unicast-routing
!
interface Loopback103
 no ip address
 ipv6 address 103::1/64
!
interface Serial0/0
 no ip address
 encapsulation frame-relay IETF
 clock rate 2000000
!
interface Serial0/0.7 multipoint
 snmp trap link-status
 ipv6 address FE80::3 link-local
 ipv6 address 123::3/64
 ipv6 rip R1R3 enable
 frame-relay map ipv6 123::1 301
 frame-relay map ipv6 123::2 301
 frame-relay map ipv6 FE80::1 301 broadcast
 frame-relay map ipv6 FE80::2 301 broadcast
!
interface Serial0/1
 no ip address
 encapsulation ppp
 ipv6 address FE80::3 link-local
 ipv6 address 34::3/64
 ipv6 ospf 2 area 0
 clock rate 2000000
!
ipv6 router ospf 2
 router-id 10.10.2.3
 log-adjacency-changes
 redistribute connected metric 1 metric-type 1 tag 3333 route-map LOOPBACKS
!
ipv6 router rip R1R3
 redistribute connected
 redistribute ospf 2 metric 1 route-map OSPF_TO_RIP
  port 1013 multicast-group FF02::9
!
ipv6 prefix-list RIP_NATIVE seq 5 permit 101::/64
!
route-map LOOPBACKS permit 10
 match ipv6 address L103
!
route-map OSPF_TO_RIP deny 10
 match ipv6 address prefix-list RIP_NATIVE
!
route-map OSPF_TO_RIP permit 20
!
ipv6 access-list L103
 permit ipv6 103::/64 any

! R4
!
ipv6 unicast-routing
!
interface Loopback104
 no ip address
 ipv6 address 104::1/64
!
interface Serial0/0
 no ip address
 encapsulation ppp
 ipv6 address FE80::4 link-local
 ipv6 address 24::4/64
 ipv6 ospf 1 area 0
 clock rate 2000000
!
interface Serial0/1
 no ip address
 encapsulation ppp
 ipv6 address FE80::4 link-local
 ipv6 address 34::4/64
 ipv6 ospf 2 area 0
 clock rate 2000000
!
ipv6 router ospf 1
 router-id 10.10.1.4
 log-adjacency-changes
 redistribute connected
 redistribute ospf 2
!
ipv6 router ospf 2
 router-id 10.10.2.4
 log-adjacency-changes
 redistribute connected
 redistribute ospf 1



!#####################################################################
! Chapter 8 Example IPv6 Redistribution - RIPng, OSPFv3 & MBGP
!
! File: RTR.Ch8-ex.Redist.RIPng,OSPFv3&MBGP-01
!
! Procedures:
!   1. Initial configuration on R1 ~ R4
!   2. Configuring RIPng on R1 & R3
!   3. Configuring OSPFv3 on R4 & R2
!   4. Configuring BGP on R1 & R2
!   5. Verifying BGP on R2
!   6. BGP Routes in R2's routing table
!   7. Configuring and verifying RIPng redistribution into BGP on R1
!   8. Configuring and verifying OSPFv3 redistribution into BGP on R2
!   9. Configuring and verifying BGP redistribution into RIPng on R1 (remote)
!  10. Configuring and verifying BGP redistribution into RIPng on R1 (local)
!  11. Configuring and verifying BGP redistribution into OSPFv3 on R2
!
!
! 1. Initial configuration on R1 ~ R4
!
! Initial configuration
!
! R1
interface Loopback101
 no ip address
 ipv6 address 101::1/64
!
interface FastEthernet0/0
 no ip address
 duplex auto
 speed auto
 ipv6 address 13::1/64
 ipv6 address FE80::1 link-local
!
interface Serial0/0
 no ip address
 encapsulation ppp
 ipv6 address 12::1/64
 ipv6 address FE80::1 link-local
 clock rate 2000000

! 
! R2
interface Loopback102
 no ip address
 ipv6 address 102::1/64
!
interface FastEthernet0/0
 no ip address
 duplex auto
 speed auto
 ipv6 address 24::2/64
 ipv6 address FE80::2 link-local
!
interface Serial0/0
 no ip address
 encapsulation ppp
 ipv6 address 12::2/64
 ipv6 address FE80::2 link-local
 clock rate 2000000

!
! R3
interface Loopback103
 no ip address
 ipv6 address 103::1/64
!
interface FastEthernet0/0
 no ip address
 duplex auto
 speed auto
 ipv6 address 13::3/64
 ipv6 address FE80::3 link-local

!
! R4
interface Loopback104
 no ip address
 ipv6 address 104::1/64
!
interface FastEthernet0/0
 no ip address
 duplex auto
 speed auto
 ipv6 address 24::4/64
 ipv6 address FE80::4 link-local

! 2. Configuring RIPng on R1 & R3
!
! R1
ipv uni

int f0/0
 ipv rip R1R3 en

! R3
!
ipv uni

int f0/0
 ipv rip R1R3 en

int lo103
 ipv rip R1R3 en

! R1
!
do sh ipv rou rip


! 3. Configuring OSPFv3 on R4 & R2
!
! R4
ipv uni

ipv router ospf 1
 router-id 4.4.4.4

int f0/0
 ipv ospf 1 ar 0

int lo104
 ipv osp 1 ar 0

! R2
!
ipv uni

ipv router ospf 1
 router-id 2.2.2.2

int f0/0
 ipv osp 1 ar 0

do sh ipv rou osp

do sh ipv osp nei

! 4. Configuring BGP on R1 & R2
!
! R1
router bgp 12
 bgp router-id 1.1.1.1
 neighbor 12::2 remote-as 12
 address-family ipv6 uni
  neighbor 12::2 activate
  network 101::/64
  ex

! R2
!
router bgp 12
 bgp router-id 2.2.2.2
 neigh 12::1 remote-as 12
 address-family ipv6 uni
  neighbor 12::1 activate
  network 102::/64
  ex

! 5. Verifying BGP on R2
!
! R2
do sh ip bgp summary

do sh bgp ipv6 unicast summary

! 6. BGP Routes in R2's routing table
!
! R2
do sh ipv rou bgp

! 7. Configuring and verifying RIPng redistribution into BGP on R1
!
! R1
address-family ipv6 uni
 red rip R1R3 include-connected

! 
! R2
do sh ipv rou bgp

! 8. Configuring and verifying OSPFv3 redistribution into BGP on R2
!
! R2
router bgp 12
 address-family ipv6 uni
 red osp 1 include-connected

! 
! R1
 do sh ipv rou bgp

! 9. Configuring and verifying BGP redistribution into RIPng on R1
!
! R1
ipv router rip R1R3
 red bgp 12 include-connected

router bgp 12
 address-family ipv6 uni
 bgp redistribute-internal

!
! R3
do sh ipv rou rip

! 10. Configuring and verifying BGP redistribution into RIPng on R1
!
! R1
ipv router rip R1R3
 red con

!
! R3
do sh ipv rou rip

! 11. Configuring and verifying BGP redistribution into OSPFv3 on R2
!
! R2
ipv router ospf 1
 red bgp 12
 red con

router bgp 12
 address-family ipv6 uni
 bgp redistribute-internal

!
! R4
do sh ipv rou osp

do pi 103::1

do pi 103::1 so lo104

!
! Running Configuration
!
! R1
ipv6 unicast-routing
!
interface Loopback101
 no ip address
 ipv6 address 101::1/64
!
interface FastEthernet0/0
 no ip address
 duplex auto
 speed auto
 ipv6 address 13::1/64
 ipv6 address FE80::1 link-local
 ipv6 rip R1R3 enable
!
interface Serial0/0
 no ip address
 encapsulation ppp
 ipv6 address 12::1/64
 ipv6 address FE80::1 link-local
 clock rate 2000000
!
router bgp 12
 no synchronization
 bgp router-id 1.1.1.1
 bgp log-neighbor-changes
 neighbor 12::2 remote-as 12
 no auto-summary
 !
 address-family ipv6
  neighbor 12::2 activate
  bgp redistribute-internal
  network 101::/64
  redistribute rip R1R3 include-connected
  no synchronization
 exit-address-family
!
ipv6 router rip R1R3
 redistribute connected
 redistribute bgp 12 include-connected

! R2
ipv6 unicast-routing
!
interface Loopback102
 no ip address
 ipv6 address 102::1/64
!
interface FastEthernet0/0
 no ip address
 duplex auto
 speed auto
 ipv6 address 24::2/64
 ipv6 address FE80::2 link-local
 ipv6 ospf 1 area 0
!
interface Serial0/0
 no ip address
 encapsulation ppp
 ipv6 address 12::2/64
 ipv6 address FE80::2 link-local
 clock rate 2000000
!
router bgp 12
 no synchronization
 bgp router-id 2.2.2.2
 bgp log-neighbor-changes
 neighbor 12::1 remote-as 12
 no auto-summary
 !
 address-family ipv6
  neighbor 12::1 activate
  bgp redistribute-internal
  network 102::/64
  redistribute ospf 1 include-connected
  no synchronization
 exit-address-family
!
ipv6 router ospf 1
 router-id 2.2.2.2
 log-adjacency-changes
 redistribute connected
 redistribute bgp 12

!
! R3
ipv6 unicast-routing
!
interface Loopback103
 no ip address
 ipv6 address 103::1/64
 ipv6 rip R1R3 enable
!
interface FastEthernet0/0
 no ip address
 duplex auto
 speed auto
 ipv6 address 13::3/64
 ipv6 address FE80::3 link-local
 ipv6 rip R1R3 enable
!
ipv6 router rip R1R3

!
! R4
ipv6 unicast-routing
!
interface Loopback104
 no ip address
 ipv6 address 104::1/64
 ipv6 ospf 1 area 0
!
interface FastEthernet0/0
 no ip address
 duplex auto
 speed auto
 ipv6 address 24::4/64
 ipv6 address FE80::4 link-local
 ipv6 ospf 1 area 0
!
ipv6 router ospf 1
 router-id 4.4.4.4
 log-adjacency-changes



!#####################################################################
! Chapter 8 Example Dual Stack
!
! File: RTR.Ch8-ex.Dual.Stack-01
!
! Procedures:
!   1. Initial configuration on R1 & R2
!   2. Configuring and verifying dual stack
!
!   
! 1. Initial configuration on R1 & R2
!
! Initial configuration

! 2. Configuring and verifying dual stack
!
! R1
int f0/0
 ip add 10.10.10.1 255.255.255.0
 ipv add 2001:12::1/64

do sh ip int f0/0

do sh ipv int f0/0




!#####################################################################
! Chapter 8 Example Manual IPv6 Tunnel 
!
! File: RTR.Ch8-ex.Manual.IPv6.Tunnel-01
!
! Procedures:
!  1. Initial configuration on R1 ~ R2, IPv4 RIP
!  2. Confirming IPv4 connectivity between R1 & R2
!  3. Manual tunnel configuration on R1 & R2
!  4. Verifying manual tunel operation
!  5. Observing the manual tunnel
!  6. Configuring RIPng, including across the manual tunnel
!  7. Verifying RIPng across the manual tunnel
!
!
! 1. Initial configuration on R1 ~ R2. IPv4 RIP
!
! R1
ipv6 unicast-routing
!
interface Loopback101
 ip address 10.1.1.1 255.255.255.0
!
interface FastEthernet0/0
 no ip address
 duplex auto
 speed auto
 ipv6 address 13::1/64
!
interface Serial0/0
 ip address 172.16.12.1 255.255.255.0
 encapsulation ppp
 clock rate 2000000
!
router rip
 version 2
 network 10.0.0.0
 network 172.16.0.0
 no auto-summary

!
! R2
ipv6 unicast-routing
!
interface Loopback102
 ip address 10.2.2.2 255.255.255.0
!
interface FastEthernet0/0
 no ip address
 duplex auto
 speed auto
 ipv6 address 24::2/64
!
interface Serial0/0
 ip address 172.16.12.2 255.255.255.0
 encapsulation ppp
 clock rate 2000000
!         
router rip
 version 2
 network 10.0.0.0
 network 172.16.0.0
 no auto-summary

!
! R3
ipv6 unicast-routing
!
interface Loopback103
 no ip address
 ipv6 address 103::1/64
!
interface FastEthernet0/0
 no ip address
 duplex auto
 speed auto
 ipv6 address 13::3/64

!
! R4
ipv6 unicast-routing
!
interface Loopback104
 no ip address
 ipv6 address 104::1/64
!
interface FastEthernet0/0
 no ip address
 duplex auto
 speed auto
 ipv6 address 24::4/64


! 2. Confirming IPv4 connectivity between R1 & R2
!
! R1
do pi 10.2.2.2 so 10.1.1.1

do sh ip rou

! 3. Manual tunnel configuration on R1 & R2
!
! R1
int tun12
 no ip add
 ipv add 12::1/64
 tun sou lo101
 tun dest 10.2.2.2
 tun mode ?
 tun mode ipv6ip

!
! R2
int tun12
 no ip add
 ipv add 12::2/64
 tun sou lo102
 tun dest 10.1.1.1
 tun mode ipv6ip

! 4. Verifying manual tunel operation
!
! R1
do deb tun

do pi 12::2 re 1

do un all

do deb ip pack det

do pi 12::2 re 1

! 5. Observing the manual tunnel
!
! R1
do sh int tun12

! 6. Configuring RIPng, including across the manual tunnel
!
! R1 & R2
ex

ipv6 unicast

int tun12
 ipv rip RIPoTU en

int f0/0
 ipv rip RIPoTU en

! R3 & R4
ex

ipv uni

int f0/0
 ipv rip RIPoTU en


! 7. Verifying RIPng across the manual tunnel
!
! R4 & R2
do sh ipv rou rip

!
! R3
do pi 24::4

!
! Running Configuration
!
! R1
ipv6 unicast-routing
!
interface Loopback101
 ip address 10.1.1.1 255.255.255.0
!
interface Tunnel12
 no ip address
 ipv6 address 12::1/64
 ipv6 rip RIPoTU enable
 tunnel source Loopback101
 tunnel destination 10.2.2.2
 tunnel mode ipv6ip
!
interface FastEthernet0/0
 no ip address
 duplex auto
 speed auto
 ipv6 address 13::1/64
 ipv6 rip RIPoTU enable
!
interface Serial0/0
 ip address 172.16.12.1 255.255.255.0
 encapsulation ppp
 clock rate 2000000
!
router rip
 version 2
 network 10.0.0.0
 network 172.16.0.0
 no auto-summary

!
! R2
ipv6 unicast-routing
!
interface Loopback102
 ip address 10.2.2.2 255.255.255.0
!
interface Tunnel12
 no ip address
 ipv6 address 12::2/64
 ipv6 rip RIPoTU enable
 tunnel source Loopback102
 tunnel destination 10.1.1.1
 tunnel mode ipv6ip
!
interface FastEthernet0/0
 no ip address
 duplex auto
 speed auto
 ipv6 address 24::2/64
 ipv6 rip RIPoTU enable
!
interface Serial0/0
 ip address 172.16.12.2 255.255.255.0
 encapsulation ppp
 clock rate 2000000
!
router rip
 version 2
 network 10.0.0.0
 network 172.16.0.0
 no auto-summary

!
! R3
ipv6 unicast-routing
!
interface Loopback103
 no ip address
 ipv6 address 103::1/64
 ipv6 rip RIPoTU enable
!
interface FastEthernet0/0
 no ip address
 duplex auto
 speed auto
 ipv6 address 13::3/64
 ipv6 rip RIPoTU enable

!
! R4
ipv6 unicast-routing
!
interface Loopback104
 no ip address
 ipv6 address 104::1/64
 ipv6 rip RIPoTU enable
!
interface FastEthernet0/0
 no ip address
 duplex auto
 speed auto
 ipv6 address 24::4/64
 ipv6 rip RIPoTU enable



!#####################################################################
! Chapter 8 Example GRE IPv6 Tunnel 
!
! File: RTR.Ch8-ex.GRE.IPv6.Tunnel-01
!
! Procedures:
!  1. Initial configuration on R1 ~ R2, IPv4 RIP
!  2. GRE Tunnel Configuration on R1 and R2
!  3. Observing the GRE Tunnel
!  4. Verifying the GRE Tunnel Operation
!  5. Configuring RIPng, Including Across the GRE Tunnel
!  6. Verifying RIPng Across the GRE Tunnel
!  7. GRE IPv6 Tunnel Configuration on R3 and R4
!  8. Configuring OSPFv3 Across the GRE IPv6 Tunnel
!  9. Verifying OSPFv3 Across the GRE IPv6 Tunnel
!
! 1. Initial configuration on R1 ~ R2, IPv4 RIP
!
! Same as Example Manual IPv6 Tunnel

! 2. GRE Tunnel Configuration on R1 and R2
!
! R1
int tun12
 no ip add  ! default setting
 ipv add 12::1/64
 tun so lo101
 tun des 10.2.2.2

!
! R2
int tun12
 ipv add 12::2/64
 tun so lo102
 tun des 10.1.1.1

! 3. Observing the GRE Tunnel
!
! R2
do sh int tun12

! 4. Verifying the GRE Tunnel Operation
!
! R2
do deb ip pack det

do pi 12::1

! 5. Configuring RIPng, Including Across the GRE Tunnel
!
! R1 & R2
ex
ipv un

int tun12
 ipv rip RIPoTU en

int f0/0
 ipv rip RIPoTU en

!
! R3 & R4
ex
ipv uni

int f0/0
 ipv rip RIPoTU en

! 6. Verifying RIPng Across the GRE Tunnel
!
! R4
do pi 13::3

do tra 13::3


! 7. GRE IPv6 Tunnel Configuration on R3 and R4
!
! R3
int tun34
 ipv add 34::34:3/64
 tun so f0/0
 tun des 24::4
 tun mod gre ipv6

!
! R4
int tun34
 ipv add 34::34:4/64
 tun so f0/0
 tun des 13::3
 tun mod gre ipv6

! 8. Configuring OSPFv3 Across the GRE IPv6 Tunnel
!
! R4
ipv router osp 1
 router-id 4.4.4.4

int lo104
 ipv ospf 1 ar 44
 
int tun34
 ipv ospf 1 ar 0

! 
! R3
ipv router ospf 1
 router-id 3.3.3.3

int lo103
 ipv ospf 1 ar 33

int tun34
 ipv ospf 1 ar 0

! 9. Verifying OSPFv3 Across the GRE IPv6 Tunnel
!
! R4
do pi 103::1 source lo104

!
! Running Configuration
!
! R1
ipv6 unicast-routing
!
interface Loopback101
 ip address 10.1.1.1 255.255.255.0
!
interface Tunnel12
 no ip address
 ipv6 address 12::1/64
 ipv6 rip RIPoTU enable
 tunnel source Loopback101
 tunnel destination 10.2.2.2
!
interface FastEthernet0/0
 no ip address
 duplex auto
 speed auto
 ipv6 address 13::1/64
 ipv6 rip RIPoTU enable
!
interface Serial0/0
 ip address 172.16.12.1 255.255.255.0
 encapsulation ppp
 clock rate 2000000
!
router rip
 version 2
 network 10.0.0.0
 network 172.16.0.0
 no auto-summary

!
! R2
ipv6 unicast-routing
!
interface Loopback102
 ip address 10.2.2.2 255.255.255.0
!
interface Tunnel12
 no ip address
 ipv6 address 12::2/64
 ipv6 rip RIPoTU enable
 tunnel source Loopback102
 tunnel destination 10.1.1.1
!
interface FastEthernet0/0
 no ip address
 duplex auto
 speed auto
 ipv6 address 24::2/64
 ipv6 rip RIPoTU enable
!
interface Serial0/0
 ip address 172.16.12.2 255.255.255.0
 encapsulation ppp
 clock rate 2000000
!
router rip
 version 2
 network 10.0.0.0
 network 172.16.0.0
 no auto-summary

!
! R3
ipv6 unicast-routing
!
interface Loopback103
 no ip address
 ipv6 address 103::1/64
 ipv6 ospf 1 area 33
!
interface Tunnel34
 no ip address
 ipv6 address 34::34:3/64
 ipv6 ospf 1 area 0
 tunnel source FastEthernet0/0
 tunnel destination 24::4
 tunnel mode gre ipv6
!
interface FastEthernet0/0
 no ip address
 duplex auto
 speed auto
 ipv6 address 13::3/64
 ipv6 rip RIPoTU enable
!         
interface FastEthernet0/1
 no ip address
 shutdown
 duplex auto
 speed auto
!
!
ip forward-protocol nd
!
ipv6 router ospf 1
 router-id 3.3.3.3
 log-adjacency-changes
!
ipv6 router rip RIPoTU

!
! R4
ipv6 unicast-routing
!
interface Loopback104
 no ip address
 ipv6 address 104::1/64
 ipv6 ospf 1 area 44
!
interface Tunnel34
 no ip address
 ipv6 address 34::34:4/64
 ipv6 ospf 1 area 0
 tunnel source FastEthernet0/0
 tunnel destination 13::3
 tunnel mode gre ipv6
!
interface FastEthernet0/0
 no ip address
 duplex auto
 speed auto
 ipv6 address 24::4/64
 ipv6 rip RIPoTU enable
!         
interface FastEthernet0/1
 no ip address
 shutdown
 duplex auto
 speed auto
!
ip forward-protocol nd
!
ipv6 router ospf 1
 router-id 4.4.4.4
 log-adjacency-changes
!
ipv6 router rip RIPoTU


!#####################################################################
! Chapter 8 Example 6to4 Tunnel 
!
! File: RTR.Ch8-ex.6to4.Tunnel-01
!
! Procedures:
!  1. Initial configuration on R1 ~ R4, IPv4 RIP, RIPng
!  2. 6to4 Tunnel Configuration on R1 and R2
!  3. Verifying the 6to4 Tunnel Operation
!  4. Configuring Static Routes Between the 6to4 Tunnel Endpoints
!  5. Configuring Static Routes Across a 6to4 Tunnel
!  6. Configuring a Default Static Route Across a 6to4 Tunnel
!  
!
! 1. Initial configuration on R1 ~ R4, IPv4 RIP, RIPng
!
! R1
ipv6 unicast-routing
!
interface Loopback101
 ip address 172.16.101.1 255.255.255.0
!
interface FastEthernet0/0
 no ip address
 duplex auto
 speed auto
 ipv6 address 13::1/64
 ipv6 rip RIPoTU enable
!
interface Serial0/0
 ip address 172.16.12.1 255.255.255.0
 encapsulation ppp
 clock rate 2000000
!
router rip
 version 2
 network 172.16.0.0

!
! R2
ipv6 unicast-routing
!
interface Loopback102
 ip address 172.16.102.1 255.255.255.0
!
interface FastEthernet0/0
 no ip address
 duplex auto
 speed auto
 ipv6 address 24::2/64
 ipv6 rip RIPoTU enable
!
interface Serial0/0
 ip address 172.16.12.2 255.255.255.0
 encapsulation ppp
 clock rate 2000000
!
router rip
 version 2
 network 172.16.0.0

!
! R3
ipv6 unicast-routing
!
interface Loopback103
 no ip address
 ipv6 address 103::1/64
!
interface FastEthernet0/0
 no ip address
 duplex auto
 speed auto
 ipv6 address 13::3/64
 ipv6 rip RIPoTU enable

!
! R4
ipv6 unicast-routing
!
interface Loopback104
 no ip address
 ipv6 address 104::1/64
!
interface FastEthernet0/0
 no ip address
 duplex auto
 speed auto
 ipv6 address 24::4/64
 ipv6 rip RIPoTU enable

! 2. 6to4 Tunnel Configuration on R1 and R2
!
! R1
int tun12
 ipv add 2002:ac10:6501::/128
 tun so lo101
 tun mode ipv6ip 6to4

!
! R2
int tun12
 ipv add 2002:ac10:6601::/128
 tun so lo102
 tun mode ipv6ip 6to4

! 3. Verifying the 6to4 Tunnel Operation
!
! R2
do deb ipv pack det

do deb tun

do pi 2002:ac10:6501::

!
! R2
do sh ipv rou

! 4. Configuring Static Routes Between the 6to4 Tunnel Endpoints
!
! R1 & R2
ipv6 route 2002::/16 tun12

! R2
do deb ipv pack det

do deb tun

do pi 2002:ac10:6501::

! 5. Configuring Static Routes Across a 6to4 Tunnel
!
! R1
ipv6 route 24::/64 tun12

do pi 24::4

no ipv route 24::/64 tun12
ipv route 24::/64 2002:ac10:6610::

do pi 24::4

do sh ipv rou static

!
! NB: the ping does not work.  R4 received the ICMP packet and reply 
!   to address 2002:ac10:6501:: (R1 - tun12).  However, the routing 
!   table does not know where the packet should route to.  Presumely
!   the RIPng should propogate the R1-tun12 address to R4.  So far
!   not idea why RIPng does not cross the tunnel.  6to4 using static
!   route than dynamic. 
!
! Solution: redistribute static routes on R1 & R2
!
! R1 & R2
ipv router rip RIPoTU
 red static


! 6. Configuring a Default Static Route Across a 6to4 Tunnel
!
! R1
no ipv route 24::/64 2002:ac10:6601::
ipv route ::/0 2002:ac10::6601::

do pi 24::4

!
! Running Configuration
!
! R1
ipv6 unicast-routing
!
interface Loopback101
 ip address 172.16.101.1 255.255.255.0
!
interface Tunnel12
 no ip address
 no ip redirects
 ipv6 address 2002:AC10:6501::/128
 ipv6 rip RIPoTU enable
 tunnel source Loopback101
 tunnel mode ipv6ip 6to4
!
interface FastEthernet0/0
 no ip address
 duplex auto
 speed auto
 ipv6 address 13::1/64
 ipv6 rip RIPoTU enable
!
interface Serial0/0
 ip address 172.16.12.1 255.255.255.0
 encapsulation ppp
 clock rate 2000000
!
router rip
 version 2
 network 172.16.0.0
!
ipv6 route 2002::/16 Tunnel12
ipv6 route ::/0 2002:AC10:6601::
ipv6 router rip RIPoTU
 redistribute static

!
! R2
ipv6 unicast-routing
!
interface Loopback102
 ip address 172.16.102.1 255.255.255.0
!
interface Tunnel12
 no ip address
 no ip redirects
 ipv6 address 2002:AC10:6601::/128
 ipv6 rip RIPoTU enable
 tunnel source Loopback102
 tunnel mode ipv6ip 6to4
!
interface FastEthernet0/0
 no ip address
 duplex auto
 speed auto
 ipv6 address 24::2/64
 ipv6 rip RIPoTU enable
!
interface Serial0/0
 ip address 172.16.12.2 255.255.255.0
 encapsulation ppp
 clock rate 2000000
!
router rip
 version 2
 network 172.16.0.0
ipv6 route 24::/64 2002:AC10:6501::
ipv6 route 2002::/16 Tunnel12
ipv6 router rip RIPoTU
 redistribute static

!
! R3
ipv6 unicast-routing
!
interface Loopback103
 no ip address
 ipv6 address 103::1/64
!
interface FastEthernet0/0
 no ip address
 duplex auto
 speed auto
 ipv6 address 13::3/64
 ipv6 rip RIPoTU enable
!
ipv6 router rip RIPoTU

!
! R4
ipv6 unicast-routing
!
interface FastEthernet0/0
 no ip address
 duplex auto
 speed auto
 ipv6 address 24::4/64
 ipv6 rip RIPoTU enable
!
ipv6 router rip RIPoTU


!#####################################################################
! Chapter 8 Example IPv4-Compatible IPv6 Tunnels <- depredcated
!
! File: RTR.Ch8-ex.IPv4-Compatible.IPv6.Tunnel-01
!
! Procedures:
!  1. Initial configuration on R1 ~ R4, RIP, RIPng
!  2. IPv4-compatible IPv6 tunnel configuration on R1 & R2
!  3. Observing IPv4-compatible IPv6 tunnel interface
!  4. Configuring a static route across an IPv4-compatible IPv6 tunne
!
!  
! 1. Initial configuration on R1 ~ R4, IPv4 RIP, RIPng
!
!  Same as 6to4 Tunnel Configuration

! 2. IPv4-compatible IPv6 tunnel configuration on R1 & R2
!
! R1
int tun12
 tun so lo101
 tun mod ipv6ip auto-tunnel

! R2
int tun12
 tun so lo102
 tun mode ipv6ip auto-tunnel

! 3. Observing IPv4-compatible IPv6 tunnel interface
!
! R2
do sh int tun12

! 4. Configuring a static route across an IPv4-compatible IPv6 tunne
!
! R1
ipv route 24::/64 ::172.16.102.1

ipv router rip RIPoTU
 red stat
 red con

do ping 24::4

do deb tun

do pi 24::4

do un all

do tra 24::4

!
! NB: The tunnel address and static address must redistribute to R3 & R4

!
! RUnning Configuratin
!
! R1
ipv6 unicast-routing
!
interface Loopback101
 ip address 172.16.101.1 255.255.255.0
!
interface Tunnel12
 no ip address
 no ip redirects
 tunnel source Loopback101
 tunnel mode ipv6ip auto-tunnel
!
interface FastEthernet0/0
 no ip address
 duplex auto
 speed auto
 ipv6 address 13::1/64
 ipv6 rip RIPoTU enable
!
interface Serial0/0
 ip address 172.16.12.1 255.255.255.0
 encapsulation ppp
 clock rate 2000000
!
router rip
 network 172.16.0.0
 no auto-summary
!
ip forward-protocol nd
!
ipv6 route 24::/64 ::172.16.102.1
ipv6 router rip RIPoTU
 redistribute connected
 redistribute static

! 
! R2
ipv6 unicast-routing
!
interface Loopback102
 ip address 172.16.102.1 255.255.255.0
!
interface Tunnel12
 no ip address
 no ip redirects
 tunnel source Loopback102
 tunnel mode ipv6ip auto-tunnel
!
interface FastEthernet0/0
 no ip address
 duplex auto
 speed auto
 ipv6 address 24::2/64
 ipv6 rip RIPoTU enable
!
interface Serial0/0
 ip address 172.16.12.2 255.255.255.0
 encapsulation ppp
 clock rate 2000000
!
router rip
 network 172.16.0.0
 no auto-summary
!
ipv6 route 13::/64 ::172.16.101.1
ipv6 router rip RIPoTU
 redistribute connected
 redistribute static

!
! R3
ipv6 unicast-routing
!
interface Loopback103
 no ip address
 ipv6 address 103::1/64
!
interface FastEthernet0/0
 no ip address
 duplex auto
 speed auto
 ipv6 address 13::3/64
 ipv6 rip RIPoTU enable
!
ipv6 router rip RIPoTU

!
! R4
ipv6 unicast-routing
!
interface Loopback104
 no ip address
 ipv6 address 104::1/64
!
interface FastEthernet0/0
 no ip address
 duplex auto
 speed auto
 ipv6 address 24::4/64
 ipv6 rip RIPoTU enable
!
ipv6 router rip RIPoTU


!#####################################################################
! Chapter 8 Example ISATAP Tunnels Tunnels 
!
! File: RTR.Ch8-ex.ISATAP.Tunnel-01
!
! Procedures:
!  1. Initial configuration on R1 ~ R4, RIP, RIPng
!  2. ISATAP tunnel configuration on R1 and R2
!  3. Observing ISATAP tunnel interface
!  4. Verifying ISATAP tunnel operation
!  5. Configuring a static route across an ISATAP tunnel
!
!
! 1. Initial configuration on R1 & R2
!
!  Same as 6to4 Tunnel Configuration

! 2. ISATAP tunnel configuration on R1 and R2
!
! R1
int tun12
 ipv add 12:12::/64 eui-64
 tun so lo101
 tun mode ipv6ip isatap

! R2
int tun12
 ipv add 12:12::/64 eui-64
 tun sou lo102
 tun mod ipv6ip isatap

! 3. Observing ISATAP tunnel interface
!
! R1
do sh int tun12

do sh ipv int tun12

! 4. Verifying ISATAP tunnel operation
!
! R1
do deb tun

do pi 12:12::5efe:ac10:6601

do deb tun

do pi fe80::5effe:ac10:6601

! 5. Configuring a static route across an ISATAP tunnel
!
! R1
ipv route 24::/64 fe80::5efe:ac10:6601

ipv route 24::/64 tun12 fe80::5efe:ac10:6601

ipv router rip RIPoTU
 red stat
 red con

do pi 24::4

!
! Running Configuration
!
! R1
ipv6 unicast-routing
!
interface Loopback101
 ip address 172.16.101.1 255.255.255.0
!
interface Tunnel12
 no ip address
 no ip redirects
 ipv6 address 12:12::/64 eui-64
 tunnel source Loopback101
 tunnel mode ipv6ip isatap
!
interface FastEthernet0/0
 no ip address
 duplex auto
 speed auto
 ipv6 address 13::1/64
 ipv6 rip RIPoTU enable
!
interface Serial0/0
 ip address 172.16.12.1 255.255.255.0
 encapsulation ppp
 clock rate 2000000
!
router rip
 network 172.16.0.0
 no auto-summary
!
ipv6 route 24::/64 Tunnel12 FE80::5EFE:AC10:6601
ipv6 router rip RIPoTU
 redistribute connected
 redistribute static

!
! R2
ipv6 unicast-routing
!
interface Loopback102
 ip address 172.16.102.1 255.255.255.0
!
interface Tunnel12
 no ip address
 no ip redirects
 ipv6 address 12:12::/64 eui-64
 tunnel source Loopback102
 tunnel mode ipv6ip isatap
!
interface FastEthernet0/0
 no ip address
 duplex auto
 speed auto
 ipv6 address 24::2/64
 ipv6 rip RIPoTU enable
!
interface Serial0/0
 ip address 172.16.12.2 255.255.255.0
 encapsulation ppp
 clock rate 2000000
!
router rip
 network 172.16.0.0
 no auto-summary
!
ipv6 route 13::/64 Tunnel12 FE80::5EFE:AC10:6501
ipv6 router rip RIPoTU
 redistribute connected
 redistribute static

!
! R3
ipv6 unicast-routing
!
interface Loopback103
 no ip address
 ipv6 address 103::1/64
!
interface FastEthernet0/0
 no ip address
 duplex auto
 speed auto
 ipv6 address 13::3/64
 ipv6 rip RIPoTU enable
!
ipv6 router rip RIPoTU

!
! R4
ipv6 unicast-routing
!
interface Loopback104
 no ip address
 ipv6 address 104::1/64
!
interface FastEthernet0/0
 no ip address
 duplex auto
 speed auto
 ipv6 address 24::4/64
 ipv6 rip RIPoTU enable
!
ipv6 router rip RIPoTU


!#####################################################################
! Chapter 8 Example Static NAT-PT for IPv6
!
! File: RTR.Ch8-ex.NAT-PT.Static-01
!
! Procedures:
!  1. Initial configuration on R1 ~ R4, IPv4 RIP, & IPv6 RIPng
!  2. Configuring Static NAT-PT
!  3. Verification and Further Configuration of Static NAT-PT
!  4. Further Verification of Static NAT-PT
!  5. Verification of Static NAT-PT on R2
!
! 1. Initial configuration on R1 ~ R4, IPv4 RIP, & IPv6 RIPng
!
! Initial Configuration
!
! R1
ipv6 unicast-routing
!
interface FastEthernet0/0
 no ip address
 duplex auto
 speed auto
 ipv6 address 13::1/64
 ipv6 rip NAT-PT enable
!
interface Serial0/0
 no ip address
 encapsulation ppp
 ipv6 address 14::1/64
 ipv6 rip NAT-PT enable
 clock rate 2000000
!
interface Serial0/1
 ip address 172.16.123.1 255.255.255.0
 encapsulation ppp
 clock rate 2000000
!
router rip
 network 172.16.0.0
 no auto-summary
!
ipv6 router rip NAT-PT

!
! R2
interface Loopback102
 no ip address
 ipv6 address 102::1/64
!
interface Serial0/0
 ip address 172.16.123.2 255.255.255.0
 encapsulation ppp
 clock rate 2000000
!
router rip
 network 172.16.0.0
 no auto-summary

!
! R3
ipv6 unicast-routing
!
interface Loopback103
 no ip address
 ipv6 address 103::1/64
 ipv6 rip NAT-PT enable
!
interface FastEthernet0/0
 no ip address
 duplex auto
 speed auto
 ipv6 address 13::3/64
 ipv6 rip NAT-PT enable
!
ipv6 router rip NAT-PT

!
! R4
ipv6 unicast-routing
!
interface Loopback104
 no ip address
 ipv6 address 104::1/64
 ipv6 rip NAT-PT enable
!
interface Serial0/0
 no ip address
 encapsulation ppp
 ipv6 address 14::4/64
 ipv6 rip NAT-PT enable
 clock rate 2000000
!
ipv6 router rip NAT-PT


! 2. Configuring Static NAT-PT
!
! R1
int s0/0
 ipv nat

int s0/1
 ipv nat
ex

ipv nat v6v4 ?

ipv nat v6v4 source ?

ipv nat v6v4 source 14::4 172.16.123.100
ipv nat v4v6 source 172.16.123.2 1144::1

do deb ipv rou

ipv nat prefix 1144::/64

ipv nat prefix 1144::/32

ipv nat prefix 1144::/96

! 3. Verification and Further Configuration of Static NAT-PT
!
! R1
do sh ipv rou con

!
! R4
do sh ipv rou | i 1144

!
! R1
ipv router rip NAT-PT
 red con met 3

!
! R4
do sh ipv rou | i 1144

do sh ipv rou rip

! 4. Further Verification of Static NAT-PT
!
! R4
do pi 1144::1

!
! R1
do sh ipv nat tran

! 5. Verification of Static NAT-PT on R2
!
! R2
do deb ip icmp

!
! R4
do pi 1144::1


!
! Running Configuration
!
! R1
ipv6 unicast-routing
!         
interface FastEthernet0/0
 no ip address
 duplex auto
 speed auto
 ipv6 address 13::1/64
 ipv6 rip NAT-PT enable
!
interface Serial0/0
 no ip address
 encapsulation ppp
 ipv6 address 14::1/64
 ipv6 nat
 ipv6 rip NAT-PT enable
 clock rate 2000000
!         
interface Serial0/1
 ip address 172.16.123.1 255.255.255.0
 encapsulation ppp
 ipv6 nat
 clock rate 2000000
!
router rip
 network 172.16.0.0
 no auto-summary
!
ipv6 router rip NAT-PT
 redistribute connected metric 3
!
ipv6 nat v4v6 source 172.16.123.2 1144::1
ipv6 nat v6v4 source 14::4 172.16.123.100
ipv6 nat prefix 1144::/96

!
! R2
interface Loopback102
 no ip address
 ipv6 address 102::1/64
!
interface Serial0/0
 ip address 172.16.123.2 255.255.255.0
 encapsulation ppp
 clock rate 2000000
!
router rip
 network 172.16.0.0

!
! R3
!
ipv6 unicast-routing
!
interface Loopback103
 no ip address
 ipv6 address 103::1/64
 ipv6 rip NAT-PT enable
!
interface FastEthernet0/0
 no ip address
 duplex auto
 speed auto
 ipv6 address 13::3/64
 ipv6 rip NAT-PT enable
!
ipv6 router rip NAT-PT

!
! R4
ipv6 unicast-routing
!
interface Loopback104
 no ip address
 ipv6 address 104::1/64
 ipv6 rip NAT-PT enable
!
interface Serial0/0
 no ip address
 encapsulation ppp
 ipv6 address 14::4/64
 ipv6 rip NAT-PT enable
 clock rate 2000000
!
ipv6 router rip NAT-PT


!#####################################################################
! Chapter 8 Example Dynamic NAT-PT for IPv6
!
! File: RTR.Ch8-ex.NAT-PT.Dyanmic.6to4-01
!
! Procedures:
!  1. Initial configuration on R1 ~ R4, RIP, RIPng
!  2. Configuring Dynamic NAT-PT
!  3. Verifying Dynamic NAT-PT
!  4. Continuing Verification of Dynamic NAT-PT from R4 to R2
!  5. Continuing Verification of Dynamic NAT-PT from R4 to R1
!
! 1. Initial configuration on R1 ~ R4, RIP, RIPng
!
! R1
ipv6 unicast-routing
!
interface FastEthernet0/0
 no ip address
 duplex auto
 speed auto
 ipv6 address 13::1/64
 ipv6 rip NAT-PT enable
!
interface Serial0/0
 no ip address
 encapsulation ppp
 ipv6 address 14::1/64
 ipv6 rip NAT-PT enable
 clock rate 2000000
!
interface Serial0/1
 ip address 172.16.123.1 255.255.255.0
 encapsulation ppp
 clock rate 2000000
!
interface Serial0/2
 ip address 172.16.12.1 255.255.255.0
 encapsulation ppp
 clock rate 2000000
!
router rip
 version 2
 network 172.16.0.0
 no auto-summary
!
ipv6 router rip NAT-PT

!
! R2
interface Loopback102
 no ip address
 ipv6 address 102::1/64
!
interface Serial0/0
 ip address 172.16.123.2 255.255.255.0
 encapsulation ppp
 clock rate 2000000
!
interface Serial0/1
 ip address 172.16.12.2 255.255.255.0
 encapsulation ppp
 clock rate 2000000
!
router rip
 version 2
 network 172.16.0.0
 no auto-summary

!
! R3
ipv6 unicast-routing
!
interface Loopback103
 no ip address
 ipv6 address 103::1/64
 ipv6 rip RIP-PT enable
!
interface FastEthernet0/0
 no ip address
 duplex auto
 speed auto
 ipv6 address 13::3/64
 ipv6 rip RIP-PT enable
!         
ipv6 router rip RIP-PT

!
! R4
ipv6 unicast-routing
!
interface Loopback104
 no ip address
 ipv6 address 104::1/64
 ipv6 rip RIP-PT enable
!
interface Serial0/0
 no ip address
 encapsulation ppp
 ipv6 address 14::4/64
 ipv6 rip RIP-PT enable
 clock rate 2000000
!
ipv6 router rip RIP-PT


! 2. Configuring Dynamic NAT-PT
!
! R1
int f0/0
 ipv nat
 
int s0/0
 ipv nat
 
int s0/1
 ipv nat

int s0/2
 ipv nat

ipv nat v4v6 so 172.16.12.2 1144::2
ipv nat v4v6 so 172.16.123.2 1144::1

ipv nat v6v4 so list LOOPBACK pool POOL_12
ipv nat v6v4 so list PHYSICAL pool POOL_123

ipv nat v6v4 pool POOL_12 172.16.12.100 172.16.12.101 prefix-length 24
ipv nat v6v4 pool POOL_123 172.16.123.100 172.16.123.101 prefix-length 24
 

ipv access-list LOOPBACK
 per ipv 104::/64 any
 per ipv 103::/64 any

ipv access-list PHYSICAL
 per ipv 13::/64 any
 per ipv 14::/64 any

ipv nat prefix 1144::/96

ipv router rip NAT-PT
 red con met 1

! 3. Verifying Dynamic NAT-PT
!
! R2
service finger

!
! R1
do deb ipv nat

!
! R4
do telnet 1144::1 finger

do telnet 1144::1 finger /source-interface loopback 104


! 4. Continuing Verification of Dynamic NAT-PT from R4 to R2
!
! R4
do telnet 1144::2 finger

do telnet 1144::2 finger / source-interface loopback 104

! 5. Continuing Verification of Dynamic NAT-PT from R4 to R1
!
! R3
do telnet 1144::1 finger

do telnet 1144::2 finger

do telnet 1144::1 finger / source-interface loopbacl 103

do telnet 1144::2 finger / source-interface loopbacl 103


!
! Running Configuration
!
! R1
!
ipv6 unicast-routing
!
interface FastEthernet0/0
 no ip address
 duplex auto
 speed auto
 ipv6 address 13::1/64
 ipv6 nat
 ipv6 rip NAT-PT enable
!
interface Serial0/0
 no ip address
 encapsulation ppp
 ipv6 address 14::1/64
 ipv6 nat
 ipv6 rip NAT-PT enable
 clock rate 2000000
!
interface Serial0/1
 ip address 172.16.123.1 255.255.255.0
 encapsulation ppp
 ipv6 nat
 clock rate 2000000
!
interface Serial0/2
 ip address 172.16.12.1 255.255.255.0
 encapsulation ppp
 ipv6 nat
 clock rate 2000000
!
router rip
 version 2
 network 172.16.0.0
 no auto-summary
!
ipv6 router rip NAT-PT
 redistribute connected metric 1
!
ipv6 nat v4v6 source 172.16.12.2 1144::2
ipv6 nat v4v6 source 172.16.123.2 1144::1
ipv6 nat v6v4 source list LOOPBACK pool POOL_12
ipv6 nat v6v4 source list PHYSICAL pool POOL_123
ipv6 nat v6v4 pool POOL_12 172.16.12.100 172.16.12.101 prefix-length 24
ipv6 nat v6v4 pool POOL_123 172.16.123.100 172.16.123.101 prefix-length 24
ipv6 nat prefix 1144::/96
!         
ipv6 access-list LOOPBACK
 permit ipv6 104::/64 any
 permit ipv6 103::/64 any
!
ipv6 access-list PHYSICAL
 permit ipv6 13::/64 any
 permit ipv6 14::/64 any

!
! R2
ip finger
!
interface Loopback102
 no ip address
 ipv6 address 102::1/64
!
interface Serial0/0
 ip address 172.16.123.2 255.255.255.0
 encapsulation ppp
 clock rate 2000000
!
interface Serial0/1
 ip address 172.16.12.2 255.255.255.0
 encapsulation ppp
 clock rate 2000000
!
!
router rip
 version 2
 network 172.16.0.0
 no auto-summary

!
! R3
ipv6 unicast-routing
!
interface Loopback103
 no ip address
 ipv6 address 103::1/64
 ipv6 rip RIP-PT enable
!
interface FastEthernet0/0
 no ip address
 duplex auto
 speed auto
 ipv6 address 13::3/64
 ipv6 rip RIP-PT enable
!
ip forward-protocol nd
!
ipv6 router rip RIP-PT

!
! R4
ipv6 unicast-routing
!
interface Loopback104
 no ip address
 ipv6 address 104::1/64
 ipv6 rip RIP-PT enable
!
interface Serial0/0
 no ip address
 encapsulation ppp
 ipv6 address 14::4/64
 ipv6 rip RIP-PT enable
 clock rate 2000000
!
ipv6 router rip RIP-PT



!#####################################################################
! Chapter 8 Example IPv4-to-IPv6 Dyanmic NAT-PT
!
! File: RTR.Ch8-ex.NAT-PT.Dyanmic.4to6-01
!
! Procedures:
!  1. Initial configuration on R1 ~ R3
!  2. Confirming NAT-PT is Running on R1’s Interfaces
!  3. Configuring and Verifying IPv4 Connectivity
!  4. Configuring Dynamic NAT-PT
!  5. Verifying NAT-PT Configuration
!  6. Verifying Dynamic NAT-PT
!  7. NAT-PT Translation Table
!
! 1. Initial configuration on R1 ~ R3
!
!  Same initial configuration as Dynamic NAT-PT IPv6 to IPv4 but
!  with NAT enabled on all interfaces in R1 
!
! R1
int f0/0
 ipv nat
 
int s0/0
 ipv nat
 
int s0/1
 ipv nat

int s0/2
 ipv nat


! 2. Confirming NAT-PT is Running on R1’s Interfaces
!
! R1
do sh ipv nat statistics

! 3. Configuring and Verifying IPv4 Connectivity
!
! R1
int lo101
 ip add 172.16.101.1 255.255.255.0

router rip
 net 172.16.0.0

! R2
router rip
 net 172.16.0.0
 
do sh ip rou

! 4. Configuring Dynamic NAT-PT
!
! R1
ipv nat v6v4 so 13::3 172.16.101.100

ipv nat v4v6 so list IPV4 pool POOL_1144
ipv nat v4v6 pool POOL_1144 1144::1 1144::2 prefix-length 96

ip access-list standard IPV4
 per 172.16.123.0 0.0.0.255
 per 172.16.12.0 0.0.0.255
ex

ipv nat prefix 1144::/96

ipv router rip NAT-PT
 red con met 1

! 5. Verifying NAT-PT Configuration
!
! R3
do sh ipv rou rip

! R1
do sh ipv nat stat

do sh ipv nat translation

! 6. Verifying Dynamic NAT-PT
!
! R1
do deb ipv nat

! R2
do telnet 172.16.101.100 finger /source-interface s0/1

do telnet 172.16.101.100 finger /source-interface s0/0

! 7. NAT-PT Translation Table
!
! R1
do sh ipv nat trans

!
! Running Configuration
!
! R1
ipv6 unicast-routing
!
multilink bundle-name authenticated
!
interface Loopback101
 ip address 172.16.101.1 255.255.255.0
!
interface FastEthernet0/0
 no ip address
 duplex auto
 speed auto
 ipv6 address 13::1/64
 ipv6 nat
 ipv6 rip NAT-PT enable
!         
interface Serial0/0
 no ip address
 encapsulation ppp
 ipv6 address 14::1/64
 ipv6 nat
 ipv6 rip NAT-PT enable
 clock rate 2000000
!
interface Serial0/1
 ip address 172.16.123.1 255.255.255.0
 encapsulation ppp
 ipv6 nat
 clock rate 2000000
!
interface Serial0/2
 ip address 172.16.12.1 255.255.255.0
 encapsulation ppp
 ipv6 nat
 clock rate 2000000
!
router rip
 version 2
 network 172.16.0.0
 no auto-summary
!
ip access-list standard IPV4
 permit 172.16.123.0 0.0.0.255
 permit 172.16.12.0 0.0.0.255
!
ipv6 router rip NAT-PT
 redistribute connected metric 1
!
ipv6 nat v4v6 source list IPV4 pool POOL_1144
ipv6 nat v4v6 pool POOL_1144 1144::1 1144::2 prefix-length 96
ipv6 nat v6v4 source 13::3 172.16.101.100
ipv6 nat prefix 1144::/96

!
! R2
interface Loopback102
 no ip address
 ipv6 address 102::1/64
!
interface Serial0/0
 ip address 172.16.123.2 255.255.255.0
 encapsulation ppp
 clock rate 2000000
!
interface Serial0/1
 ip address 172.16.12.2 255.255.255.0
 encapsulation ppp
 clock rate 2000000
!
router rip
 version 2
 network 172.16.0.0
 no auto-summary

!
! R3
ipv6 unicast-routing
!
ip finger
!
interface Loopback103
 no ip address
 ipv6 address 103::1/64
 ipv6 rip RIP-PT enable
!
interface FastEthernet0/0
 no ip address
 duplex auto
 speed auto
 ipv6 address 13::3/64
 ipv6 rip RIP-PT enable
!
ipv6 router rip RIP-PT

!
! R4
ipv6 unicast-routing
!
interface Loopback104
 no ip address
 ipv6 address 104::1/64
 ipv6 rip RIP-PT enable
!
interface Serial0/0
 no ip address
 encapsulation ppp
 ipv6 address 14::4/64
 ipv6 rip RIP-PT enable
 clock rate 2000000
!
ipv6 router rip RIP-PT


! The configuration keeps having the folling error message

! Error message
Previous timer has bad forward linkage, timer = 660EDD40. -Process= "IPv6 NAT-PT Ager", ipl= 4, pid= 256,  -Traceback= 0x615CD104 0x62C690F8 0x62C6A0E8

! After googling, a web page provides the following troubleshooting technique
! https://supportforums.cisco.com/discussion/10870116/cisco-7507-got-rebooted-crashinfo-need-help
!
! Possible software fault. Upon reccurence, please collect 
! crashinfo, "show tech" and contact Cisco Technical Support.
!
! However, the result dumps hunderds or thousands of lines.
!
! Another technique is to redirect the output to a file with "tee" command
! For instance, 
!


